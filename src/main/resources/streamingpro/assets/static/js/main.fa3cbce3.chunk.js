(this["webpackJsonpmlsql-web-console"]=this["webpackJsonpmlsql-web-console"]||[]).push([[0],{10:function(e,t,a){"use strict";a.r(t),a.d(t,"ActionProxy",(function(){return m}));var n=a(2),r=a.n(n),s=a(6),o=a(8),c=a(83);class l{}l.USER_NAME="userName",l.USER_ID="userId",l.ADMIN_TOKEN="admin_token",l.LOGIN_TOKEN="access-token";class i{constructor(e,t,a){this.status=e,this.content=t,this.resp=a}}class u{constructor(e,t={}){this.url=e,this.url||(this.url=c.b),this.fetch_config=t}request(e,t,a="GET"){var n=this;return Object(s.a)(r.a.mark((function s(){var u,p,m,d,h,b,f,E,g,y,v;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(m in a=a.toUpperCase(),(u=sessionStorage.getItem(l.USER_NAME))&&(t[l.USER_NAME]=u),p=[],t)d=encodeURIComponent(m),h=encodeURIComponent(t[m]),p.push(d+"="+h);return b=n.url+e,p.length>0&&(b+="?"),"GET"===a?(b+=p.join("&"),p=void 0):p=p.join("&"),f={method:a,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(c.a)||""},body:p},E=Object(o.a)(Object(o.a)({},f),n.fetch_config),r.prev=10,r.next=13,fetch(b,E);case 13:if((g=r.sent).ok){r.next=19;break}return r.next=17,g.text();case 17:return y=r.sent,r.abrupt("return",new i(g.status,y));case 19:return r.next=21,g.json();case 21:return v=r.sent,r.abrupt("return",new i(200,v,g));case 25:return r.prev=25,r.t0=r.catch(10),r.abrupt("return",new i(500,r.t0,void 0));case 28:case"end":return r.stop()}}),s,null,[[10,25]])})))()}}var p=a(11);class m{constructor(){this.backend=new u}userName(){var e=this;return Object(s.a)(r.a.mark((function t(){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(p.default.USER_NAME,{});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()}runScript(e,t,a){var n=this;return Object(s.a)(r.a.mark((function s(){var o,c,l,i,u,m;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.userName();case 2:if(200===(o=r.sent).status){r.next=5;break}return r.abrupt("return",o);case 5:return c=o.content,l=c.userName,i=c.backendTags,u={sql:e,owner:l,jobName:t,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:i||""},Object.assign(u,a),r.next=10,n.post(p.default.RUN,u);case 10:return m=r.sent,r.abrupt("return",m);case 12:case"end":return r.stop()}}),s)})))()}get(e,t){var a=this;return Object(s.a)(r.a.mark((function n(){var s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.backend.request(e,t,c.c.GET);case 2:return s=n.sent,n.abrupt("return",s);case 4:case"end":return n.stop()}}),n)})))()}post(e,t){var a=this;return Object(s.a)(r.a.mark((function n(){var s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.backend.request(e,t,c.c.POST);case 2:return s=n.sent,n.abrupt("return",s);case 4:case"end":return n.stop()}}),n)})))()}}m.client=new m},1013:function(e,t,a){},1018:function(e,t,a){},1038:function(e,t,a){},1039:function(e,t,a){},104:function(e,t,a){"use strict";a.r(t),a.d(t,"SetStateActionHandler",(function(){return l})),a.d(t,"SetStateAction",(function(){return i}));var n=a(2),r=a.n(n),s=a(8),o=a(6);const c=a(12).a.buildHandler(function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(s.a)({},t.data)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=c.handler,i=c.action},1049:function(e,t,a){},1053:function(e,t,a){},1054:function(e,t,a){},1056:function(e,t,a){},11:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return n}));class n{}n.RUN="/api_v1/run/script",n.USER_NAME="/api_v1/user/userName",n.JOB_LIST="/api_v1/job/list",n.JOB_DETAIL="/api_v1/job",n.JOB_KILL="/api_v1/job/kill",n.SAVE_SCRIPT_FILE="/api_v1/script_file",n.ANALYSIS_TABLES="/api_v1/analysis/tables",n.ANALYSIS_TABLE_INFO="/api_v1/analysis/table/get",n.ANALYSIS_SAVE="/api_v1/analysis/tables/save",n.ANALYSIS_TABLE_DELETE="/api_v1/analysis/table/delete",n.APP_INFO="/api_v1/app",n.APP_SAVE="/api_v1/app/save",n.REGISTER="/api_v1/user/register",n.LOGIN="/api_v1/user/login",n.LOGOUT="/api_v1/user/logout",n.ENGINE_ADD="/api_v1/engine/add",n.ENGINE_REGISTER="/api_v1/engine/register",n.ENGINE_LIST="/api_v1/engine/list",n.ENGINE_REMOVE="/api_v1/engine/remove",n.SCRIPT_FILE_LIST="/api_v1/script_file",n.SCRIPT_FILE_GET="/api_v1/script_file/get",n.SCRIPT_FILE_REMOVE="/api_v1/script_file/remove",n.PLUGIN_LIST="/api_v1/plugin/list",n.PLUGIN_GET="/api_v1/plugin/get",n.ANALYSIS_PLUGIN_LIST="/api_v1/script_file/plugins",n.ANALYSIS_PLUGIN_GET="/api_v1/script_file/plugin/get",n.ANALYSIS_PLUGIN_PUBLISH="/api_v1/script_file/plugin/publish",n.SCRIPT_SHARE_PUBLIC="/api_v1/script_file/share",n.USER_EXTRA="/api_v1/user/extra/update",n.USER_CHANGE_PASSWORD="/api_v1/changepassword",n.APPLY_GET="/api_v1/analysis/apply",n.TEMA_LIST="/api_v1/team",n.DS_ADD="/api_v1/ds/add",n.DS_LIST="/api_v1/ds/list",n.DS_REMOVE="/api_v1/ds/remove",n.DS_MYSQL_DBS="/api_v1/ds/mysql/dbs",n.DS_MYSQL_CONNECT="/api_v1/ds/mysql/connect/get",n.DS_MYSQL_COLUMN_INFO="/api_v1/ds/mysql/column",n.CLOUD_CREATE_ENGINE="/api_v1/proxy/api/create_engine",n.CLOUD_DELETE_ENGINE="/api_v1/proxy/api/delete_engine",n.CLOUD_ENGINE_STATUS="/api_v1/proxy/api/status",n.CLOUD_ENGINE_LIST="/api_v1/proxy/api/list",n.INDEXER_LIST="/api_v1/indexer",n.MYSQL_INDEXER_CREATE="/api_v1/indexer/mysql/build",n.INDEXER_REMOVE="/api_v1/indexer/remove"},1106:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(19),o=a.n(s);a(555),a(556),a(557);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(2),l=a.n(c),i=a(6),u=a(7),p=(a(559),a(29)),m=a(12),d=a(10),h=a(11),b=a(83);const f=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("logout"!==t.data.currentPage){e.next=7;break}return a=new d.ActionProxy,e.next=4,a.post(h.default.LOGOUT,{});case 4:return sessionStorage.removeItem(b.a.name),sessionStorage.removeItem("user"),e.abrupt("return",{data:{currentPage:"admin",logined:!1}});case 7:return e.abrupt("return",{data:{currentPage:t.data.currentPage}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),E=f.handler,g=f.action;var y=a(8),v=a(277);var w=class{static setupLogin(e){const t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags},a=e.resp.headers.get(b.a.name);sessionStorage.setItem(b.a.name,a),sessionStorage.setItem("user",JSON.stringify(t));(new v.a).set(b.a.name,a,{path:"/"})}static updateUser(e){const t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags};sessionStorage.setItem("user",JSON.stringify(t))}static extraOption(){const e=sessionStorage.getItem("user");if(!e)return{};try{return JSON.parse(JSON.parse(e).extraOption)||{}}catch(t){return{}}}static isAdmin(){const e=sessionStorage.getItem("user");if(!e)return!1;return"admin"===JSON.parse(e).role}static logined(){return!!sessionStorage.getItem(b.a.name)}static formLayout2(){return{formItemLayout:{labelCol:{xs:{span:4},sm:{span:8}},wrapperCol:{xs:{span:4},sm:{span:8}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}static formLayout1(){return{formItemLayout:{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}};const k=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="console","register"!==t.__state.currentPage||w.logined()||(a="register"),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{logined:w.logined(),currentPage:a})});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x=k.handler,S=k.action;var O=a(104);class j{}j.SWITCH="switch",j.CHECK_LOGINED="checkLogined";const C={[j.SWITCH]:E,[j.CHECK_LOGINED]:x,setState:O.SetStateActionHandler};function T(e,t){switch(t.type){case j.SWITCH:return g(e,t.data);case j.CHECK_LOGINED:return S(e,t.data);case"setState":return Object(O.SetStateAction)(e,t.data);default:return e}}a(560);var N=a(62),_=a(1124),I=a(1136),P=a(1134),A=a(1133),D=a(1132),R=a(1131),L=a(1145),F=a(1130),M=a(164),q=a.n(M),V=a(1110);const B=N.a.SubMenu,G=r.a.createContext();function U(e){const t=e.currentPage,a=e.userLogined,s=e.isUserAdmin,o=e.appInfo,c=Object(n.useContext)($i).dispacher,l=Object(n.useState)(t),i=Object(u.a)(l,2),p=i[0],d=i[1],h=Object(n.useState)(a),b=Object(u.a)(h,2),f=b[0],E=b[1],g=Object(n.useState)(s),y=Object(u.a)(g,2),v=y[0],w=y[1],k=Object(n.useState)(void 0),x=Object(u.a)(k,2),S=x[0],O=x[1],C=Object(n.useState)(!1),T=Object(u.a)(C,2),M=(T[0],T[1],Object(n.useRef)());return Object(n.useEffect)(()=>{const t=e.currentPage,a=e.userLogined,n=e.isUserAdmin;d(t),E(a),w(n)},[e]),r.a.createElement(G.Provider,null,r.a.createElement(q.a,{title:"Confirm",visible:S||!1,onCancel:()=>{O(void 0)},onOk:()=>{O(void 0),d(M.current),c(m.a.buildEvent(j.SWITCH,{currentPage:M.current}))},cancelText:"Cancel",okText:"Leave"},r.a.createElement(_.a,{description:S,type:"info"})),r.a.createElement(N.a,{onClick:e=>{if("home"===e.key)return e.domEvent.preventDefault(),void e.domEvent.stopPropagation();f&&"workshop"===p&&"workshop"!==e.key?(M.current=e.key,O("Do you wanna leave workshop? Please make sure you have saved your work before you leave.")):(d(e.key),c(m.a.buildEvent(j.SWITCH,{currentPage:e.key})))},selectedKeys:[p],mode:"horizontal"},r.a.createElement(N.a.Item,{key:"home"},r.a.createElement("span",{style:{fontSize:32}},"MLSQL Web Console"),r.a.createElement("span",{style:{fontSize:11}},"(Build 20210712.181143)")),!f&&r.a.createElement(N.a.Item,{key:"login",icon:r.a.createElement(I.a,null)},r.a.createElement(V.a,{id:"login"})),!f&&r.a.createElement(N.a.Item,{key:"register",icon:r.a.createElement(P.a,null)},r.a.createElement(V.a,{id:"register"})),f&&o.enableConsole&&r.a.createElement(N.a.Item,{key:"console",icon:r.a.createElement(A.a,null)},r.a.createElement(V.a,{id:"console"})),f&&r.a.createElement(N.a.Item,{key:"workshop",icon:r.a.createElement(D.a,null)},r.a.createElement(V.a,{id:"analysis_workshop"})),f&&r.a.createElement(N.a.Item,{key:"indexer_manager",icon:r.a.createElement(D.a,null)},r.a.createElement(V.a,{id:"indexer_manager"})),f&&r.a.createElement(N.a.Item,{key:"settings",icon:r.a.createElement(R.a,null)},r.a.createElement(V.a,{id:"settings"})),f&&v&&r.a.createElement(N.a.Item,{key:"admin",icon:r.a.createElement(R.a,null)},r.a.createElement(V.a,{id:"admin"})),f&&r.a.createElement(B,{icon:r.a.createElement(L.a,null),title:r.a.createElement(V.a,{id:"more"})},r.a.createElement(N.a.Item,{key:"scriptPlugin"},"\u811a\u672c\u63d2\u4ef6"),r.a.createElement(N.a.Item,{key:"doc"},"\u4e2d\u6587\u6587\u6863"),r.a.createElement(N.a.Item,{key:"engine"},"Engine"),r.a.createElement(N.a.Item,{key:"logout",icon:r.a.createElement(F.a,null)},"Logout"))))}var J=a(1129),H=a(1118),K=a(524),Q=a(55);a(382);const W=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,n=a.userName,r=a.password,s=a.password2,r===s){e.next=3;break}return e.abrupt("return",{data:{error:"Passwords are not matched"}});case 3:return o=new d.ActionProxy,e.next=6,o.post(h.default.REGISTER,{userName:n,password:r});case 6:return c=e.sent,i={},200!==c.status?i={error:JSON.parse(c.content).msg}:(w.setupLogin(c),i={error:void 0,logined:!0,current:t.__state.current+1}),e.abrupt("return",{data:i});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),z=W.handler,Y=W.action,X=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.post(h.default.LOGIN,t.data);case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",{data:{logined:!1,error:JSON.parse(n.content).msg}});case 6:return w.setupLogin(n),e.abrupt("return",{data:{logined:!0}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),$=X.handler,Z=X.action;class ee{}ee.REGISTER="register",ee.LOGIN="login";const te={[ee.REGISTER]:z,[ee.LOGIN]:$};function ae(e,t){switch(t.type){case ee.REGISTER:return Y(e,t.data);case ee.LOGIN:return Z(e,t.data);default:return e}}var ne=a(76),re=a(72);function se(){const e=Object(ne.a)(["\n  width: 100%;    \n  margin: 0px 10px 10px 0px;\n"]);return se=function(){return e},e}const oe=re.a.div(se());var ce=function(e){return r.a.createElement(oe,null,r.a.createElement(_.a,Object.assign({},e,{closable:!0,type:e.type||"error",message:e.title||"Message",description:e.message})))};const le=r.a.createContext(),ie={logined:!1,error:void 0};function ue(){const e=Object(n.useContext)($i).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout,o=Object(p.useReducerAsync)(ae,ie,te),c=Object(u.a)(o,2),l=c[0],i=c[1],m=l.logined,d=l.error;return Object(n.useEffect)(()=>{e({type:j.CHECK_LOGINED,data:{}})},[m]),r.a.createElement(le.Provider,{value:{}},r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(J.a,{title:"Register"},d&&r.a.createElement(ce,{type:"error",message:d}),r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:e=>{i({type:ee.REGISTER,data:e})}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go"))))))}const pe={logined:!1,error:void 0},me=r.a.createContext();function de(){const e=w.formLayout1(),t=e.formItemLayout,a=e.tailLayout,s=Object(n.useContext)($i).dispacher,o=Object(p.useReducerAsync)(ae,pe,te),c=Object(u.a)(o,2),l=c[0],i=c[1],d=l.logined,h=l.error;return Object(n.useEffect)(()=>{s({type:j.CHECK_LOGINED,data:{logined:d}})},[d]),r.a.createElement(me.Provider,null,r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(J.a,{title:"Login"},h&&r.a.createElement(ce,{type:"error",message:h}),r.a.createElement(H.a,Object.assign({},t,{className:"login-form",onFinish:e=>{i(m.a.buildEvent(ee.LOGIN,e))}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,a,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go"))))))}a(728);var he=a(59),be=a.n(he),fe=a(1115),Ee=a(1122);const ge=a(212);class ye extends n.Component{constructor(e){super(e),this.setRender=(e,t)=>{const a=t[0][e.key];if(this.config&&this.config.render){const t=this.config.render[e.key];t&&(e.render=t)}else{try{if(n.Component.isPrototypeOf(a.type))return void(e.render=e=>n.createElement("span",null,e))}catch(r){}"html"!=e.key?"object"!==typeof a?"array"!==typeof a?"boolean"!==typeof a?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300)):e.render=e=>n.createElement("pre",null,e.substring(0,300))}},this.update=(e,t)=>{this.config=t;let a=[],n={},r=[];const s=this;e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),this.setState({columns:a,data:r})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1}},this.config={}}render(){const e=this;return n.createElement("div",{style:this.tableStyle},n.createElement(fe.a,{onRow:(t,a)=>({onDoubleClick:n=>{e.rowDoubleClick(t,a,n)}}),columns:this.state.columns,dataSource:this.state.data}),n.createElement(Ee.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(ge,{source:this.state.view.content||""})))}}var ve=a(1119),we=a(359),ke=a(528),xe=a(527),Se=a(490),Oe=a.n(Se);const je="/api_v1/run/script",Ce="get",Te="post",Ne=401,_e="access-token",Ie={width:200,height:200,borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5},Pe={borderStyle:"solid",borderColor:"#6c6",backgroundColor:"#eee"},Ae={borderStyle:"solid",borderColor:"#c66",backgroundColor:"#eee"},De={display:"flex"};class Re extends r.a.Component{constructor(){super(),this.onDrop=e=>{this.setState({files:e});const t=Oe.a.post("/api_v1/file/upload");t.set("Access-Token",sessionStorage.getItem(_e)||""),e.forEach(e=>{t.attach(e.path,e)}),t.end((t,a)=>{this.setState({files:[]}),t?(console.log(t),this.setState({msg:t.toString()+"\n Sometimes this caused by your upload space is not enough or backend fails"})):a.ok&&this.setState({msg:"total files:"+e.length+" are uploaded. \n You can check the files with command: !hdfs -ls /tmp/upload; "})})},this.state={files:[]}}render(){const e=this.state.files.map(e=>r.a.createElement("li",{key:e.name},e.path," - ",e.size," bytes"));return r.a.createElement("section",{style:De},r.a.createElement("div",null,r.a.createElement(ke.a,{onDrop:this.onDrop,getDataTransferItems:e=>Object(xe.a)(e)},({getRootProps:e,getInputProps:t,isDragActive:a,isDragAccept:n,isDragReject:s,acceptedFiles:o,rejectedFiles:c})=>{let l=Object(y.a)({},Ie);return l=a?Object(y.a)(Object(y.a)({},l),Pe):l,l=s?Object(y.a)(Object(y.a)({},l),Ae):l,r.a.createElement("div",Object.assign({},e(),{style:l}),r.a.createElement("input",t()),r.a.createElement("div",null,n?"Drop":"Drag"," files here..."),s&&r.a.createElement("div",null,"Unsupported file type..."))})),r.a.createElement("aside",null,r.a.createElement("h4",null,0===e.length?"":"Files"),r.a.createElement("ul",null,e)),r.a.createElement("div",null,this.state.msg?this.state.msg:""))}}var Le=a(34);const Fe=a(448),Me=()=>{let e=Fe();return"#000000"===e&&(e="#8884d8"),e};class qe{static render(e){let t=e[0].hasOwnProperty("z");e.hasOwnProperty("dataType")||e.forEach(e=>{e.dataType="default",t||(e.z=0)});const a=e.reduce((e,t)=>{t.x,t.y,t.z;const a=t.dataType,n=e.get(a);return n?n.push(t):e.set(a,[t]),e},new Map),n=e[0]._dash_config||{},s=[...a.keys()].map(e=>{const t=Object.assign({fill:Me(),shape:"triangle"},n[e]||{});return r.a.createElement(Le.g,Object.assign({key:e,name:e,data:a.get(e)},t))}),o=Object.assign({type:"number",dataKey:"x"},n.x||{}),c=Object.assign({type:"number",dataKey:"y"},n.y||{}),l=Object.assign({type:"number",dataKey:"z"},n.z||{});return r.a.createElement(Le.h,{width:400,height:400,margin:{top:20,right:20,bottom:20,left:20}},r.a.createElement(Le.c,null),r.a.createElement(Le.j,o),r.a.createElement(Le.k,c),t?r.a.createElement(Le.l,l):"",r.a.createElement(Le.i,{cursor:{strokeDasharray:"3 3"}}),r.a.createElement(Le.d,null),s)}}qe.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},qe.isShouldRender=e=>qe.basicCheck(e,e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&(e.hasOwnProperty("_dash_config")||e.hasOwnProperty("dash"))&&("scatter"===e.dash||"scatter"===(e._dash_config||{}).dash));const Ve=a(448),Be=()=>{let e=Ve();return"#000000"===e&&(e="#8884d8"),e};class Ge{static render(e){const t=e[0],a=[],n=t._dash_config||{};return"line"===t.dash||"line"===n.dash?(Object.keys(t).forEach(e=>{if("number"===typeof t[e]){const t=Object.assign({stroke:Be()},n[e]||{});a.push(r.a.createElement(Le.e,Object.assign({key:e,type:"monotone",dataKey:e},t)))}}),r.a.createElement(Le.f,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(Le.c,{strokeDasharray:"3 3"}),r.a.createElement(Le.j,{dataKey:"x"}),r.a.createElement(Le.k,null),r.a.createElement(Le.i,null),r.a.createElement(Le.d,null),a)):"bar"===t.dash||"bar"===n.dash?(Object.keys(t).forEach(e=>{if("number"===typeof t[e]){const t=Object.assign({fill:Be()},n[e]||{});a.push(r.a.createElement(Le.a,Object.assign({key:e,dataKey:e},t)))}}),r.a.createElement(Le.b,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(Le.c,{strokeDasharray:"3 3"}),r.a.createElement(Le.j,{dataKey:"x"}),r.a.createElement(Le.k,null),r.a.createElement(Le.i,null),r.a.createElement(Le.d,null),a)):void 0}}Ge.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},Ge.isShouldRender=e=>Ge.basicCheck(e,e=>e.hasOwnProperty("x")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config")));var Ue=a(265),Je=a.n(Ue);class He extends n.Component{constructor(e){super(e),this.renderStream=()=>{const e=this.state.data,t=[],a=[];e.forEach(e=>{const n=JSON.parse(e.value),r=Je.a.utc(n.timestamp).format("DD,h:mm:ss");t.push({x:r,inputRowsPerSecond:n.inputRowsPerSecond,processedRowsPerSecond:n.processedRowsPerSecond}),a.push({x:r,numInputRows:n.numInputRows})}),this.setState({dataForRender:t,dataForRender2:a})},this.queryApp=e.parent.parent,this.state={data:e.data,dataForRender:[],titleMap:{}}}componentDidMount(){this.renderStream()}render(){return 0===this.state.dataForRender.length?null:r.a.createElement("div",null,r.a.createElement(Le.f,{width:800,height:300,data:this.state.dataForRender},r.a.createElement(Le.e,{type:"monotone",dataKey:"inputRowsPerSecond",stroke:"#8884d8"}),r.a.createElement(Le.e,{type:"monotone",dataKey:"processedRowsPerSecond",stroke:"#82ca9d"}),r.a.createElement(Le.c,{stroke:"#ccc"}),r.a.createElement(Le.j,{dataKey:"x"}),r.a.createElement(Le.k,null),r.a.createElement(Le.d,null)),r.a.createElement(Le.f,{width:800,height:300,data:this.state.dataForRender2},r.a.createElement(Le.e,{type:"monotone",dataKey:"numInputRows",stroke:"#8884d8"}),r.a.createElement(Le.c,{stroke:"#ccc"}),r.a.createElement(Le.j,{dataKey:"x"}),r.a.createElement(Le.k,null),r.a.createElement(Le.d,null)))}}He.isStream=e=>{if(e.length<1)return!1;try{if(!JSON.parse(e[0].value).runId)return!1}catch(t){return!1}return!0},He.isShouldRender=e=>He.isStream(e),He.renderRawData=e=>{if(!He.isShouldRender(e))return"";const t=[];return e.forEach(e=>{const a=JSON.parse(e.value);t.push(JSON.stringify(a,null,2))}),t.join("\n")};var Ke=a(80);class Qe{static render(e){const t=e[0];return r.a.createElement(We,{data:t})}}Qe.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},Qe.isShouldRender=e=>Qe.basicCheck(e,e=>e.hasOwnProperty("html")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config")));class We extends r.a.Component{constructor(e){super(e),this.refresh=e=>{this.setState({data:e})},this.state={data:this.props.data}}render(){return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Ke.Resizable,{defaultSize:{height:"500px"}},r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"100%"},srcDoc:this.state.data.html,frameBorder:"0",scrolling:"yes",ref:e=>{this.ifr=e}})))}}class ze extends class{constructor(e){this.inner=e,this.session=this.inner.editor.session,this.editor=this.inner.editor}setText(e){return this.editor.setValue(e),this}append(e){return this.session.insert({row:this.session.getLength(),column:0},"\n"+e),this}insertAfterCursor(e){const t=this.editor.getCursorPosition();return this.session.insert(t,e),this.editor.focus(),this}}{constructor(e){super(e)}getText(){return this.editor.getValue()}getSelection(){let e=this.editor.getSelectionRange();return this.session.getTextRange(e)}}const Ye=a(110),Xe=new d.ActionProxy;class $e{static ls(e){return Object(i.a)(l.a.mark((function t(){var a,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new d.ActionProxy,t.next=3,a.runScript("!hdfs -ls -F ".concat(e,";"),Ye(),{queryType:"robot"});case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}static killJob(e){return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe.runScript("!kill "+e+";",Ye(),{queryType:"robot"});case 2:return a=t.sent,t.next=5,Xe.get(h.default.JOB_KILL,{jobName:e});case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))()}static runJob(e,t=!1){return Object(i.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Xe.runScript(e,Ye(),{async:t});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}}),a)})))()}static showFunctions(){return Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe.runScript("",Ye(),{executeMode:"sqlFunctions"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}static jobs(){return Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ye(),e.next=3,Xe.runScript("load _mlsql_.`jobs` as wow;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",{jobName:t,res:a});case 5:case"end":return e.stop()}}),e)})))()}static tablesInDeltaLake(){return Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ye(),e.next=3,Xe.runScript("!delta show tables;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))()}static tablesInWorkshop(){return Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe.get(h.default.ANALYSIS_TABLES,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}static tableInfo(e){return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe.get(h.default.ANALYSIS_TABLE_INFO,{tableName:e});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()}static jobProgress(e){return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe.runScript("load _mlsql_.`jobs/get/".concat(e,"` as wow;"),Ye(),{queryType:"robot"});case 2:if(a=t.sent,n={currentJobIndex:0,totalJobs:1},200!==a.status){t.next=17;break}if(r=a.content[0]){t.next=8;break}return t.abrupt("return",n);case 8:if(s=r.progress.currentJobIndex,1!==(o=r.progress.totalJob)){t.next=16;break}return t.next=13,Xe.runScript("load _mlsql_.`jobs/".concat(e,"` as wow;"),Ye(),{queryType:"robot"});case 13:c=t.sent,s=c.content[0].completedJobsNum,o=c.content[0].activeJobsNum+s;case 16:return t.abrupt("return",{currentJobIndex:s,totalJobs:o});case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}}),t)})))()}static currentSQL(e){return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe.runScript("load _mlsql_.`jobs/get/".concat(e,"` as wow;"),Ye(),{queryType:"robot"});case 2:if(a=t.sent,n={currentJobIndex:0,totalJobs:1,script:"",isFinish:!0},200!==a.status){t.next=14;break}if(r=a.content[0]){t.next=8;break}return t.abrupt("return",n);case 8:return s=r.progress.currentJobIndex,o=r.progress.totalJob,c=r.progress.script,t.abrupt("return",{currentJobIndex:s,totalJobs:o,script:c,isFinish:!1});case 14:return t.abrupt("return",n);case 15:case"end":return t.stop()}}),t)})))()}static jobProgress2(e){return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe.runScript("load _mlsql_.`jobs/v2/".concat(e,"` as wow;"),Ye(),{queryType:"robot"});case 2:return a=t.sent,t.abrupt("return",a.content[0]);case 4:case"end":return t.stop()}}),t)})))()}static resourceInfo(){return Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe.runScript("load _mlsql_.`resource` as output;",Ye(),{queryType:"robot"});case 2:return t=e.sent,a=t.content[0].totalCores,n=t.content[0].activeTasks,e.abrupt("return",{activeTasks:n,totalCores:a});case 6:case"end":return e.stop()}}),e)})))()}}class Ze extends r.a.Component{constructor(e){var t;super(e),t=this,this.toggleDetail=()=>{this.setState({showDetail:!this.state.showDetail})},this.toggleResponse=()=>{this.setState({showResponse:!this.state.showResponse})},this.cleanSQL=e=>{try{return e.split("\n").filter(e=>!e.includes("password")).join("\n")}catch(t){return e}},this.queryApp=e.parent.queryApp,this.client=new d.ActionProxy,this.state={showDetail:!1,executeAgainStatus:{}};let a=(e,a)=>r.a.createElement(Q.a,{type:"link",onClick:function(){var e=Object(i.a)(l.a.mark((function e(n){var r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.target.parentNode,s=r.parentNode.cellIndex,o="",e.t0=s,e.next=2===e.t0?6:4===e.t0?8:7===e.t0?10:12;break;case 6:return o="content",e.abrupt("break",12);case 8:return o="reason",e.abrupt("break",12);case 10:return o="response",e.abrupt("break",12);case 12:return console.log(s),e.next=15,t.showDetail(a.name,o);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e));this.renderConfig={render:{content:a,response:(e,a)=>r.a.createElement(Q.a,{type:"link",onClick:function(){var e=Object(i.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.showResponse(a.name);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e)),reason:a,status:e=>{let t="",a={};switch(e){case"fail":case"killed":t="danger";break;case"success":t="primary",a={backgroundColor:"green"};break;case"running":t="primary"}return r.a.createElement(Q.a,{type:t,style:a},e)},__command__:(e,a)=>{const n=a.name;return"running"!==a.status?r.a.createElement(Q.a,{type:"primary",key:n,loading:this.state.executeAgainStatus[n],onClick:function(){var e=Object(i.a)(l.a.mark((function e(r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state.executeAgainStatus[n]=!0,t.setState(t.state.executeAgainStatus),e.next=4,$e.runJob(a.content);case 4:t.reload();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Execute again"):r.a.createElement(Q.a,{key:n,onClick:function(){var e=Object(i.a)(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e.killJob(n);case 2:e.sent,t.reload();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Kill")}}}}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({executeAgainStatus:{}}),t.next=3,e.client.get(h.default.JOB_LIST,{});case 3:200==(a=t.sent).status&&e.display&&e.display.update(e.processData(a.content),e.renderConfig);case 5:case"end":return t.stop()}}),t)})))()}processData(e){return e.map(e=>{const t="running"===e.status?e.jobName:"";return Object.assign(e,{__command__:t})})}showDetail(e,t){var a=this;return Object(i.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.client.get(h.default.JOB_DETAIL,{jobName:e});case 2:r=n.sent,a.setState({showDetail:!0,detailConsoleMessage:r.content[t]});case 4:case"end":return n.stop()}}),n)})))()}showResponse(e){var t=this;return Object(i.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.client.get(h.default.JOB_DETAIL,{jobName:e});case 2:n=a.sent,t.setState({showResponse:!0}),t.respDisplay&&t.respDisplay.update(JSON.parse(n.content.response));case 5:case"end":return a.stop()}}),a)})))()}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(Ee.a,{title:"View",visible:this.state.showDetail,onCancel:this.toggleDetail,onOk:this.toggleDetail,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(be.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.cleanSQL(this.state.detailConsoleMessage)||""})),r.a.createElement(Ee.a,{title:"View",visible:this.state.showResponse,onCancel:this.toggleResponse,onOk:this.toggleResponse,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(ye,{style:{overflow:"scroll"},ref:e=>{this.respDisplay=e},parent:this})),r.a.createElement("div",{style:{marginBottom:16}},r.a.createElement(Q.a,{type:"primary",onClick:()=>{this.reload()}},"Reload")),r.a.createElement(ye,{ref:e=>{this.display=e},parent:this}))}}var et=a(1120);a(1013);class tt extends n.Component{constructor(e){super(e),this.enter=e=>{},this.exit=()=>{},this.queryPanel=e.parent,this.state={percent:0}}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$e.resourceInfo();case 2:return a=t.sent,n=a.activeTasks,r=a.totalCores,t.next=7,$e.jobs();case 7:s=t.sent,o=s.jobName,c=s.res,i=c.content.filter(e=>e.jobName!==o).length,e.setState({percent:n/r*100,totalCores:r,activeTasks:n,jobNum:i});case 12:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"rp-main"},n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"CPU Usage(total cores:",this.state.totalCores,"): "),n.createElement(et.a,{percent:this.state.percent,style:{maxWidth:"300px"}})),n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"Jobs Running: ",n.createElement("span",null,this.state.jobNum))))}}const at=ve.a.Panel,nt=we.a.TabPane;function rt(e){}class st extends n.PureComponent{constructor(e){super(e),this.isNormalXY=e=>st.basicCheck(e,e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&"number"===typeof e.y),this.xYRender=e=>r.a.createElement(Le.a,{height:200,title:"Bar",data:e}),this.renderDash=()=>{const e=this.state.data;return He.isShouldRender(e)?r.a.createElement(He,{data:e,parent:this}):qe.isShouldRender(e)?qe.render(e):this.isNormalXY(e)?this.xYRender(e):Ge.isShouldRender(e)?Ge.render(e):Qe.isShouldRender(e)?Qe.render(e):r.a.createElement("div",null)},this.queryApp=e.parent,this.state={data:[],dataForRender:[],titleMap:{}}}refresh(){try{const e=this.queryApp.queryResData||[];this.setState({data:e})}catch(e){}}render(){return r.a.createElement(ve.a,{onChange:rt},r.a.createElement(at,{header:"Tools/Dashboard",key:"0"},r.a.createElement(we.a,{defaultActiveKey:"0",onChange:rt,onTabClick:e=>{"0"===e&&this.resourceProgressRef.reload()}},r.a.createElement(nt,{tab:"Cluster Info",key:"0"},r.a.createElement(tt,{ref:e=>this.resourceProgressRef=e,parent:this})),r.a.createElement(nt,{tab:"Upload",key:"1"},r.a.createElement(Re,null)),r.a.createElement(nt,{tab:"Dashboard",key:"2"},this.renderDash()),r.a.createElement(nt,{tab:"RawData",key:"3"},r.a.createElement("pre",null,He.renderRawData(this.state.data))),r.a.createElement(nt,{tab:"History",key:"4"},r.a.createElement(Ze,{ref:e=>this.queryHistory=e,parent:this})))))}}st.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0};a(189),a(326),a(449),a(327),a(328);const ot=a(10).ActionProxy,ct=a(11).default;class lt{static getSuggestList(e,t,a){return Object(i.a)(l.a.mark((function n(){var r,s,o;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new ot,n.next=3,r.post(ct.RUN,{executeMode:"autoSuggest",sql:e,lineNum:t+1,columnNum:a,isDebug:!1,queryType:"robot"});case 3:if(!(s=n.sent)||200!==s.status){n.next=9;break}return o=s.content,n.abrupt("return",o);case 9:return n.abrupt("return",[]);case 10:case"end":return n.stop()}}),n)})))()}}a(450);var it=a(1111);class ut{isLogin(){return null!==sessionStorage.getItem(_e)}userName(e){new ht("/api_v1/user/userName").request(Ce,{},t=>{t.status===Ne?sessionStorage.removeItem(_e):t.content.then(t=>{e(JSON.parse(t).userName)}).catch(e=>{})},e=>{console.log(e)})}user(e){new ht("/api_v1/user/userName").request2({},t=>{e(t)},e=>{})}login(e,t,a,n){this.registerOrLogin("/api_v1/user/login",e,t,a,n)}logout(){sessionStorage.removeItem(_e)}register(e,t,a,n){this.registerOrLogin("/api_v1/user/register",e,t,a,n)}registerOrLogin(e,t,a,n,r){const s={userName:t,password:a};new ht(e).request(Te,s,e=>{if(e.accessToken){sessionStorage.setItem(_e,e.accessToken);(new v.a).set(_e,e.accessToken,{path:"/"})}n(e)},e=>{r(e)})}}const pt=a(110);class mt{constructor(e){this.value=e}}class dt{constructor(e,t,a){this.json=(e,t)=>{this.content.then(a=>{try{const t=JSON.parse(a);e(t)}catch(n){console.log(n),t(a)}})},this.status=e,this.content=t,this.accessToken=a}}class ht{constructor(e){this.url=e}request2(e,t,a){this.request(Te,e,e=>{e.json(e=>{t(e)},e=>{a(e)})},e=>{try{e.value().content(e=>{let t=e;try{t=JSON.parse(e).msg}catch(n){}a(t)})}catch(t){a(e?e.toString():"result is null")}})}runScript(e,t,a,n){const r=new ut,s=pt(),o=this;r.user(r=>{const c=r.userName,l=r.backendTags,i={sql:t,owner:c,jobName:s,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""};Object.assign(i,e);(e.background||!1)&&Object.assign(i,{async:!0,callback:""}),o.request(Te,i,e=>{if(200===e.status)e.json(e=>{a(e)},e=>{n(e)});else try{e.content.then(t=>{let a=t;try{a=JSON.parse(t).msg}catch(r){}n("backend status:"+e.status+"\n"+a)})}catch(t){n("backend status:"+e.status)}},e=>{try{e.value().content(e=>{let t=e;try{t=JSON.parse(e).msg}catch(a){}n(t)})}catch(t){n(e?e.toString():"result is null")}})})}request(e,t,a,n){e=e.toUpperCase();let r=[];for(let o in t){let e=encodeURIComponent(o),a=encodeURIComponent(t[o]);r.push(e+"="+a)}let s=this.url;return"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&"),fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(_e)||""},body:r}).then(e=>{a(new dt(e.status,e.text(),e.headers.get(_e)))}).catch(e=>{n(new mt(e))})}newRunScript(e,t,a,n){const r=new ut,s=pt(),o=this;r.user(r=>{const c=r.userName,l=r.backendTags;if(!l)return void n("\n                \n                ---------------Warning--------------------\n                \n                Please make sure you have backend configured. \n                If not, please contact admin;\n                \n                ------------------------------------------\n                ");const i={sql:t,owner:c,jobName:s,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""};Object.assign(i,e);(e.background||!1)&&Object.assign(i,{async:!0,callback:""}),o.new_request(Te,i,a,n)})}new_request(e,t,a,n){e=e.toUpperCase();let r=[];for(let c in t){let e=encodeURIComponent(c),a=encodeURIComponent(t[c]);r.push(e+"="+a)}let s=this.url;"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&");let o=0;return fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(_e)||""},body:r}).then(e=>(o=e.status,200===o&&e.json().then(e=>{a(e)}),e)).then(e=>{const t=()=>{e.text().then(e=>{try{n(JSON.parse(e).msg)}catch(t){n(e)}})};switch(o){case 201:break;case 400:case 500:t();break;default:console.log("unhandled")}}).catch(e=>{n(e.message)})}}class bt{constructor(){this.makeSQL=e=>"JobList"===e?"load _mlsql_.`jobs` as output;":"ConnectMySQL"===e?'connect jdbc where\n url="jdbc:mysql://127.0.0.1:3306/wow?characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false"\n and driver="com.mysql.jdbc.Driver"\n and user=""\n and password=""\n as db_1;':"ShowResource"===e?"load _mlsql_.`resource` as output;":""}}var ft=a(203);const Et=a(110);class gt{constructor(e){this.enterLoading=()=>{this.commandGroupRef.setState({loading:!0})},this.exitLoading=()=>{this.commandGroupRef.setState({loading:!1})},this.queryPanel=e,this.client=new d.ActionProxy,this.jobName=Et(),this.editorOp=this.queryPanel.getEditorOp(),this.consoleOp=this.queryPanel.getConsoleOp();const t=this.editorOp.getSelection();this.sql=t||this.editorOp.getText(),this.commandGroupRef=this.queryPanel.commandGroup.current,this.jobProgressRef=this.queryPanel.jobProgressRef,this.taskProgressRef=this.queryPanel.taskProgressRef.current,this.displayRef=this.queryPanel.queryApp.display.current,this.dashRef=this.queryPanel.queryApp.dash.current,this.timeout=this.commandGroupRef.state.timeout,this.logInfo={},this.closed=!1}log(e){return this.consoleOp.append(e),this}prepare(){this.enterLoading(),this.consoleOp.setText(""),this.displayRef.update(JSON.parse("[]"))}measureTime(e){this.exitLoading();return(new Date).getTime()-e}saveFile(e){var t=this;return Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.queryPanel.state.scriptId){e.next=4;break}return t.log("No file are opened, cannot execute save action"),e.abrupt("return");case 4:return e.next=6,t.client.post(h.default.SAVE_SCRIPT_FILE,{id:a,content:t.editorOp.getText()});case 6:return 200!==(n=e.sent).status&&t.log(n.content),200===n.status&&t.log("File[".concat(a,"] have been saved.")),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))()}run(e){var t=this;return Object(i.a)(l.a.mark((function a(){var n,r;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.prepare(),n=(new Date).getTime(),a.next=4,t.client.runScript(t.sql,t.jobName,Object.assign(e,{jobName:t.jobName,async:!0,timeout:t.timeout,engineName:t.queryPanel.engineName}));case 4:if(200===(r=a.sent).status){a.next=8;break}return t.log("Fail to submit job\nTime cost:"+t.measureTime(n)+"ms"),a.abrupt("return",[]);case 8:return t.intervalTimer=setInterval(Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.monitorJob();case 2:return e.next=4,t.monitorLog();case 4:case"end":return e.stop()}}),e)}))),1e3),t.dashRef.queryHistory&&t.dashRef.queryHistory.reload(),t.jobProgressRef.enter(),a.abrupt("return",r);case 12:case"end":return a.stop()}}),a)})))()}cancelMonitor(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.intervalTimer&&(clearInterval(e.intervalTimer),e.intervalTimer=null),e.jobProgressRef.exit();case 2:case"end":return t.stop()}}),t)})))()}monitorJob(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.client.get(h.default.JOB_DETAIL,{jobName:e.jobName,queryType:"robot"});case 2:a=t.sent,3===(n=a.content).status&&(e.closed=!0,e.cancelMonitor(),e.exitLoading(),e.jobProgressRef.exit(),e.log(n.reason)),2===n.status&&(e.closed=!0,e.cancelMonitor(),e.exitLoading(),e.jobProgressRef.exit(),r=JSON.parse(n.response),e.displayRef.update(r),e.queryPanel.queryApp.setData(r));case 6:case"end":return t.stop()}}),t)})))()}monitorLog(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Et(),t.next=3,e.client.runScript("load _mlsql_.`log/".concat(e.logInfo.offset||-1,'` where filePath="engine_log" as output;'),a,{queryType:"robot"});case 3:if(200===(n=t.sent).status){t.next=6;break}return t.abrupt("return");case 6:(r=n.content[0]).value&&r.value.length>0&&e.log(r.value.map(e=>e.split("__MMMMMM__")[1]).join("\n")),e.logInfo.offset=r.offset;case 9:case"end":return t.stop()}}),t)})))()}killJob(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jobName){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,$e.killJob(e.jobName);case 4:a=t.sent;try{e.log(a.content[0].description)}catch(n){e.log(a.content)}e.closed=!0,e.jobName=null,e.cancelMonitor(),e.exitLoading();case 10:case"end":return t.stop()}}),t)})))()}}var yt=a(285),vt=a.n(yt);class wt extends n.Component{constructor(e){var t;super(e),t=this,this.enter=e=>{this.setState({loading:!0,jobs:{},dataSource:[],currentSQL:{},totalTime:"0s",currentJobGroup:""}),this.intervalTimer=setInterval(Object(i.a)(l.a.mark((function e(){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.queryPanel.executor.jobName,e.next=3,$e.currentSQL(t.state.currentJobGroup||a);case 3:return n=e.sent,e.next=6,$e.jobProgress2(t.state.currentJobGroup||a);case 6:(r=e.sent).activeJobs&&0!==r.activeJobs.length&&(t.state.currentJobGroup||t.setState({currentJobGroup:r.groupId}),t.makeProgress(r,n));case 8:case"end":return e.stop()}}),e)}))),1e3)},this.exit=()=>{this.intervalTimer&&(setTimeout(()=>{clearInterval(this.intervalTimer),this.intervalTimer=null},3e3),this.finalTime=this.state.totalTime,this.setState({loading:!1}))},this.makeProgress=(e,t)=>{if(e.activeJobs){const a=e.activeJobs.map(e=>({jobId:e.jobId,duration:e.duration,total:e.numTasks-e.numSkippedTasks,numKilledTasks:e.numKilledTasks,skipped:e.numSkippedTasks,failed:e.numFailedTasks,completed:e.numCompletedIndices,started:e.numActiveTasks})).map(t=>{const a=parseInt(t.completed/t.total*100+"");let n="";0===t.failed&&0===t.skipped&&t.started>0&&(n+="(".concat(t.started," running)")),t.failed>0&&(n+="(".concat(t.failed," failed)")),t.skipped>0&&(n+="(".concat(t.skipped," skipped)")),t.numKilledTasks>0&&(n+="(".concat(t.numKilledTasks," killed)"));let r=t.duration+" ms";return t.duration>1e3&&(r=parseInt(t.duration/1e3+"")+" s"),{title:"".concat(t.jobId,"(").concat(e.groupId,")"),duration:r,tasks:"".concat(t.completed,"/").concat(t.total).concat(n),progress:a}});let n=t;if(t.isFinish&&(n=this.state.currentSQL,n.currentJobIndex=n.totalJobs),this.timer){const e=(this.timer.getTime()/1e3).toFixed(2)+"s";return void this.setState({dataSource:a,currentSQL:n,totalTime:e})}this.setState({dataSource:a,currentSQL:n})}},this.showSQL=()=>this.state.currentSQL.currentJobIndex&&n.createElement("h3",null,"sql: [",this.state.currentSQL.currentJobIndex,"/",this.state.currentSQL.totalJobs,": ",this.state.currentSQL.script,"]"),this.queryPanel=e.parent,this.state={loading:!1,jobs:{},dataSource:[],currentSQL:{},totalTime:"0s",currentJobGroup:""},this.columns=[{title:"Job Id(Job Group)",dataIndex:"title",key:"title"},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Tasks(for all stages)\uff1a Succeeded/Total",dataIndex:"tasks",key:"tasks",render:(e,t,a)=>{const r=2*t.progress;return n.createElement("div",null,n.createElement("div",{style:{position:"relative",width:"200px",height:"30px",backgroundColor:"yellow"}},n.createElement("div",{style:{position:"relative",top:"0px",right:"0px",width:r+"px",height:"100%",backgroundColor:"rgba(27,163,232,100)"}}),n.createElement("div",{style:{position:"absolute",top:"4px",textAlign:"center",width:"100%"}},e)))}}]}render(){return this.state.loading?n.createElement("div",null,n.createElement(Q.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost:",n.createElement(vt.a,{ref:e=>this.timer=e},n.createElement(vt.a.Minutes,{formatValue:e=>"".concat(e," m. ")}),n.createElement(vt.a.Seconds,{formatValue:e=>"".concat(e," s. ")}))),n.createElement("div",null,n.createElement(ve.a,{defaultActiveKey:["1"]},n.createElement(ve.a.Panel,{header:this.showSQL(),key:"1"},n.createElement(fe.a,{dataSource:this.state.dataSource,columns:this.columns}))))):this.finalTime?n.createElement("div",null,n.createElement(Q.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost: ",this.finalTime),n.createElement("div",null,n.createElement(ve.a,{defaultActiveKey:["1"]},n.createElement(ve.a.Panel,{header:this.showSQL(),key:"1"},n.createElement(fe.a,{dataSource:this.state.dataSource,columns:this.columns}))))):n.createElement("div",null)}}function kt(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=(a[0],a[1],Object(n.useState)([])),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)(!1),b=Object(u.a)(m,2),f=(b[0],b[1]),E=Object(n.useState)(void 0),g=Object(u.a)(E,2),y=g[0],v=g[1];Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),t=new d.ActionProxy,e.next=4,t.get(h.default.ENGINE_LIST,{});case 4:a=e.sent,p(a.content.data),n=w.extraOption().backend,a.content.data.length>0&&!n&&v(a.content.data[0].name),f(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(()=>{e.useEngine(y)},[y,e]);return r.a.createElement(ft.a,{onChange:e=>{v(e)},style:{width:"120px"}},c.map(e=>r.a.createElement(ft.a.Option,{value:e.name,key:e.id},e.name)))}const xt=ft.a.Option;a(110);class St extends n.Component{constructor(e){var t;super(e),t=this,this.text=(e,t)=>{this.setState({value:e,scriptId:t},()=>{this.aceEditorRef.current.editor.setValue(e,1)})},this.executeSave=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new gt(t),e.next=3,a.saveFile({});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),this.getAllText=()=>this.getAceEditor().getValue(),this.getSelection=()=>this.getEditorOp().getSelection(),this.appendToEditor=e=>this.getEditorOp().insertAfterCursor(e),this.getEditorOp=()=>new ze(this.aceEditorRef.current),this.getConsoleOp=()=>new ze(this.queryApp.messageBox.current),this.getAceEditor=()=>this.getEditorOp().editor,this.getMessageBoxAceEditor=()=>this.getConsoleOp().editor,this.appendLog=e=>this.getConsoleOp().append(e),this.getDashBoard=()=>this.queryApp.dash.current,this.getDisplay=()=>this.queryApp.display.current,this.enterLoading=e=>{this.commandGroup.current.setState({loading:!0}),this.resourceProgressRef.current.enter({jobName:e}),this.jobProgressRef.enter({jobName:e})},this.exitLoading=()=>{this.commandGroup.current.setState({loading:!1}),this.jobProgressRef.exit(),this.resourceProgressRef.current.exit()},this.etOver=e=>{const t=this.queryApp.etRef.current,a=t.getData("eventName"),n=t.getData("popName"),r=t.getData("processType"),s=t.getData("pathAlias"),o=t.getData("tableHidden"),c=t.getData("pathHidden"),l=t.getData("outputTableHidden"),i=t.getData("outputTableAlias"),u=t.getData("tableAlias");"direct"===r?this.appendToEditor((new bt).makeSQL(a)):t.setState({etPop:!0,eventName:a,popName:n,processType:r,pathAlias:s,tableHidden:o,pathHidden:c,outputTableHidden:l,outputTableAlias:i,tableAlias:u})},this.language=this.props.language||"sql",this.queryApp=this.props.parent,this.aceEditorRef=n.createRef(),this.commandGroup=n.createRef(),this.taskProgressRef=n.createRef(),this.cancelQuery=this.cancelQuery.bind(this),this.executeQuery=this.executeQuery.bind(this),this.state={value:"",loading:!1}}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this);var e={getCompletions:function(){var e=Object(i.a)(l.a.mark((function e(t,a,n,r,s){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.getSuggestList(t.getValue(),n.row,n.column);case 2:o=e.sent,s(null,o.map((function(e){let t="";return"desc"in e.extra&&(t=e.extra.desc),{caption:e.name,value:e.name,meta:t}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()};this.getAceEditor().completers=[e]}onChange(e){}executeQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.executor||e.executor.closed){t.next=4;break}return e.log("Job ".concat(e.jobName," is still running.")),e.log("Try to kill this job or wait it to finish"),t.abrupt("return");case 4:return e.executor=new gt(e),t.next=7,e.executor.run({});case 7:return a=t.sent,e.executor.closed||(e.executor.closed=!0),t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)})))()}cancelQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.executor&&e.executor.killJob();case 1:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:e=>e.preventDefault(),onDrop:this.etOver},n.createElement(Ke.Resizable,{defaultSize:{height:"500px"},onResize:()=>{this.aceEditorRef.current.editor.resize()}},n.createElement(be.a,{ref:this.aceEditorRef,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(Ot,{ref:this.commandGroup,parent:this}),n.createElement(wt,{ref:e=>{this.jobProgressRef=e},parent:this}),n.createElement(jt,{ref:this.taskProgressRef,parent:this}))}}class Ot extends n.Component{constructor(e){super(e),this.onChange=e=>{this.setState({timeout:e})},this.state={loading:!1,timeout:"-1"},this.parent=e.parent}render(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(Q.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(Q.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(Q.a,{onClick:this.parent.executeSave},"Save"),"Job Timeout:",n.createElement(ft.a,{onChange:this.onChange,style:{width:"120px"}},n.createElement(xt,{value:"10000"},"10s"),n.createElement(xt,{value:"30000"},"30s"),n.createElement(xt,{value:"60000"},"60s"),n.createElement(xt,{value:"1800000"},"30m"),n.createElement(xt,{value:"7200000"},"2h"),n.createElement(xt,{value:"28800000"},"8h"),n.createElement(xt,{value:"-1"},"unlimited")),n.createElement(it.a,{type:"vertical"}),"Engine:",n.createElement(kt,{useEngine:e=>{this.parent.engineName=e}}))}}class jt extends n.Component{constructor(e){super(e),this.enter=e=>{const t=this;this.setState({mark:!0}),setTimeout(()=>{t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(()=>{if("loading"===t.taskCompute)return;t.taskCompute="loading";const a=new ht(je);((e,t)=>{if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}})(e.hasOwnProperty("jobName"),"jobName is required");const n=e.jobName;a.runScript({},"load _mlsql_.`jobs/".concat(n,"` as output;"),e=>{t.taskCompute="loaded";const a=e[0],n={numTasks:0,numActiveTasks:0,numCompletedTasks:0};a.activeJobs.forEach(e=>{n.numTasks+=e.numTasks,n.numActiveTasks+=e.numActiveTasks,n.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:n.numActiveTasks/n.numTasks*100,successPercent:n.numCompletedTasks/n.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(n.numCompletedTasks,"/").concat(n.numTasks,"(").concat(n.numActiveTasks," running)")})},e=>{t.taskCompute="loaded";try{t.parent.appendLog(e)}catch(a){console.log(a)}})},1e3))},1e3)},this.exit=()=>{this.taskCompute="loaded",this.resourceCompute="loaded",this.setState({loading:!1,percent:0,successPercent:0,mark:!1}),this.intervalTimer&&clearInterval(this.intervalTimer)},this.state={loading:!1,percent:0,successPercent:0,mark:!1},this.parent=e.parent}render(){return this.state.loading?n.createElement("div",null,this.state.title,n.createElement(et.a,{percent:this.state.percent,successPercent:this.state.successPercent})):n.createElement("div",null)}}var Ct=St,Tt=a(202);class Nt extends r.a.Component{constructor(e){super(e),this.originalEditor=()=>this.editor.editor,this.changeValue=Object(Tt.debounce)(e=>{(0,this.props.onChangeEditorValue)(e)},500)}componentDidMount(){this.originalEditor().container.style.lineHeight=3}render(){return r.a.createElement(be.a,{maxLines:1/0,width:"100%",ref:e=>{this.editor=e},value:this.props.initialCode,mode:"sql",theme:"github",onChange:this.changeValue})}}var _t=a(1112),It=a(1159),Pt=a(1158),At=a(1157),Dt=a(1156);class Rt extends r.a.Component{constructor(e){super(e),this.evtExecute=()=>{this.setState({isExecute:!0}),this.executeUnit.execute()},this.cancelExecute=()=>{this.setState({isExecute:!1})},this.state={isExecute:!1},this.executeUnit=e.executeUnit,this.notebook=e.executeUnit.notebook}render(){const e=this.props,t=e.onAddCell,a=e.onRemoveCell,n=e.disableDelete;return r.a.createElement("div",null,r.a.createElement(_t.a,null,this.state.isExecute?r.a.createElement("span",{onClick:this.cancelExecute},r.a.createElement(It.a,null)):r.a.createElement("span",{onClick:this.evtExecute},r.a.createElement(Pt.a,null)),r.a.createElement(Q.a,{type:"text",icon:r.a.createElement(At.a,null),onClick:t}),r.a.createElement(Q.a,{type:"text",disabled:n,icon:r.a.createElement(Dt.a,null),onClick:a})))}}const Lt=a(110);class Ft{constructor(e){this.run=(e,t,a)=>{const n=Lt();new ht(je).newRunScript({jobName:n,timeout:this.timeout},e,t,a)},this.saveFile=(e,t,a)=>{new ht("/api_v1/script_file").request(Te,{id:t,content:e},e=>{200!=e.status?e.json(e=>{a(e.msg)},e=>{a(e)}):a("saved")},e=>{a(e)})},this.timeout=e}}const Mt=a(212);class qt extends n.Component{constructor(e){super(e),this.setRender=(e,t,a)=>{const r=t[0][e.key];if(a&&a.render){const t=this.state.config.render[e.key];t&&(e.render=t)}else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=e=>n.createElement("span",null,e))}catch(s){}"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300))}},this.parseData=(e,t)=>{let a=[],n={},r=[];const s=this;return e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),[a,r]},this.refresh=(e,t)=>{const a=this.parseData(e,t),n=Object(u.a)(a,2),r=n[0],s=n[1];this.setState({columns:r,rows:s,config:t})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})};const t=this.parseData(e.data||[],e.config||{}),a=Object(u.a)(t,2),r=a[0],s=a[1];this.state={columns:r,rows:s,view:{enabled:!1}}}render(){const e=this;return n.createElement("div",null,n.createElement(fe.a,{onRow:(t,a)=>({onDoubleClick:n=>{e.rowDoubleClick(t,a,n)}}),columns:e.state.columns,dataSource:e.state.rows}),n.createElement(Ee.a,{title:"View",visible:e.state.view.enabled,onCancel:e.disablePreview,onOk:e.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Mt,{source:e.state.view.content||""})))}}class Vt extends r.a.Component{constructor(e){super(e),this.refresh=e=>{if(this.setState({displayData:e,errorMsg:""}),this.displayTableRef&&this.displayTableRef.refresh(this.state.displayData,{}),this.displayDashRef){const e=this.state.displayData[0];this.displayDashRef.refresh(e)}},this.fail=e=>{this.setState({errorMsg:e}),this.editor&&this.editor.editor.setValue(e)},this.displayDash=()=>{if(this.state.displayData&&Qe.isShouldRender(this.state.displayData)){const e=this.state.displayData[0];return r.a.createElement(We,{data:e,ref:e=>this.displayDashRef=e})}return r.a.createElement("div",null)},this.displayError=()=>this.state.errorMsg?r.a.createElement("div",null,r.a.createElement(be.a,{maxLines:1/0,width:"100%",ref:e=>{this.editor=e},value:this.state.errorMsg,mode:"text",theme:"ace/theme/textmate"})):r.a.createElement("div",null),this.displayTable=()=>this.state.displayData?this.state.displayData&&Qe.isShouldRender(this.state.displayData)?void 0:r.a.createElement(r.a.Fragment,null,r.a.createElement(ve.a,{style:{margin:"20px 0px",padding:"0px 0px"},defaultActiveKey:"1"},r.a.createElement(ve.a.Panel,{header:"Result",key:"1"},r.a.createElement(qt,{data:this.state.displayData,ref:e=>this.displayTableRef=e})))):r.a.createElement("div",null),this.state={errorMsg:""}}render(){return r.a.createElement("div",null,this.displayError(),this.displayTable(),this.displayDash())}}a(1018);class Bt extends r.a.Component{constructor(e){super(e),this.execute=()=>{const e=this.codeBlock.originalEditor().getValue(),t=new Ft(3e5);this.props.saveNoteBook(),t.run(e,e=>{this.displayGroup.refresh(e),this.commandGroup.setState({isExecute:!1})},e=>{this.displayGroup.fail(e),this.commandGroup.setState({isExecute:!1})})},this.codeBlockIsEmpty=()=>""===this.getCodeStr(),this.getCodeStr=()=>this.codeBlock.originalEditor().getValue(),this.notebook=e.parent}render(){const e=this.props,t=e.initialCode,a=e.onAddCell,n=e.onRemoveCell,s=e.disableDelete;return r.a.createElement("div",{className:"mb5"},r.a.createElement(Nt,{initialCode:t,ref:e=>{this.codeBlock=e},executeUnit:this,onChangeEditorValue:this.props.onChangeEditorValue}),r.a.createElement(Rt,{ref:e=>{this.commandGroup=e},executeUnit:this,onAddCell:a,onRemoveCell:n,disableDelete:s}),r.a.createElement(Vt,{ref:e=>this.displayGroup=e}))}}const Gt="set notebooksplitter='notebooksplitter';";class Ut extends r.a.Component{constructor(e){super(e),this.saveNoteBook=()=>{const e=this.state.excuteList.map(e=>e.content).join(Gt);this.engine.saveFile(e,this.scriptId,e=>{})},this.handleChangeEditorValue=(e,t)=>{let a=Object(Tt.cloneDeep)(this.state.excuteList);const n=a.findIndex(t=>t.id===e.id);a[n].content=t,this.setState({excuteList:a})},this.text=(e,t)=>{if(this.scriptId=t,this.initialCode=e,e){const e=this.initialCode.split(Gt).map((e,t)=>({content:e,id:t}));this.setState({excuteList:e})}},this.executeUnitRefs=[],this.state={executeUnits:this.executeUnits,excuteList:[{id:"1",content:""}]},this.engine=new Ft(3e5),this.addCell=this.addCell.bind(this),this.removeCell=this.removeCell.bind(this)}addCell(e){const t=Math.max(...this.state.excuteList.map(e=>e.id))+1,a=Object(Tt.cloneDeep)(this.state.excuteList);a.splice(e+1,0,{content:"",id:t}),this.setState({excuteList:a})}removeCell(e){const t=this.state.excuteList.filter(t=>t.id!==e.id);this.setState({excuteList:t})}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}render(){const e=this.state.excuteList;return r.a.createElement("div",{className:"notebook"},e.map((t,a)=>r.a.createElement(Bt,{key:t.id,initialCode:t.content,id:t.id,onAddCell:()=>this.addCell(a),disableDelete:1===e.length,onRemoveCell:()=>this.removeCell(t),saveNoteBook:()=>this.saveNoteBook(t),onChangeEditorValue:e=>this.handleChangeEditorValue(t,e)})))}}const Jt=a(110);class Ht{constructor(e){this.appendLog=e,this.log={}}cancelQueryLog(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.intervalTimer&&(clearInterval(e.intervalTimer),e.intervalTimer=null);case 1:case"end":return t.stop()}}),t)})))()}queryLog(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.cancelQueryLog(),e.intervalTimer=setInterval(Object(i.a)(l.a.mark((function t(){var a,n,r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Jt(),n=new d.ActionProxy,t.next=4,n.runScript("load _mlsql_.`log/".concat(e.log.offset||-1,'` where filePath="engine_log" as output;'),a,{});case 4:r=t.sent,(s=r.content[0]).value.length>0&&e.appendLog(s.value.map(e=>e.split("__MMMMMM__")[1]).join("\n")),e.log.offset=s.offset;case 8:case"end":return t.stop()}}),t)}))),2e3);case 2:case"end":return t.stop()}}),t)})))()}}ft.a.Option;const Kt=a(110);class Qt extends n.Component{constructor(e){super(e),this.text=(e,t)=>{this.setState({value:e,scriptId:t},()=>{this.aceEditorRef.editor.setValue(e,1)})},this.executeSave=()=>{const e=new ht("/api_v1/script_file"),t=this,a=this.getMessageBoxAceEditor();t.state.scriptId?e.request(Te,{id:t.state.scriptId,content:t.getAceEditor().getValue()},e=>{200!=e.status?e.json(e=>{t.appendLog(e.msg)},e=>{t.appendLog(e)}):t.appendLog("saved")},e=>{t.appendLog(e)}):a.setValue("no file are opened, cannot executeSave")},this.getAllText=()=>this.getAceEditor().getValue(),this.getSelection=()=>{let e=this.getAceEditor().getSelectionRange();return this.getAceEditor().session.getTextRange(e)},this.appendToEditor=e=>{const t=this.getAceEditor(),a=t.getCursorPosition();t.session.insert(a,e),t.focus()},this.getAceEditor=()=>this.aceEditorRef.editor,this.getMessageBoxAceEditor=()=>this.queryApp.messageBox.current.editor,this.appendLog=e=>{const t=this.getMessageBoxAceEditor().session;t.insert({row:t.getLength(),column:0},"\n"+e)},this.getDashBoard=()=>this.queryApp.dash.current,this.getDisplay=()=>this.queryApp.display.current,this.language=this.props.language||"sql",this.queryApp=this.props.parent.queryApp,this.state={value:"",loading:!1},this.executeQuery=this.executeQuery.bind(this),this.cancelQuery=this.cancelQuery.bind(this),this.logMonitor=new Ht(this.appendLog),this.log={}}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}onChange(e){}executeQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.commandGroup.setState({loading:!0}),e.jobName=Kt(),a=new d.ActionProxy,(n=e).getMessageBoxAceEditor().setValue(""),n.getDisplay().update(JSON.parse("[]")),r=n.getSelection(),s=n.getAllText(),""!==r&&(s=r),o=n.state.scriptId,e.logMonitor.queryLog(),t.next=13,a.runScript(s,e.jobName,{scriptId:o,runMode:"python",executeMode:"python"});case 13:if(200===(c=t.sent).status){t.next=19;break}return e.logMonitor.cancelQueryLog(),e.appendLog(c.content),e.commandGroup.setState({loading:!1}),t.abrupt("return");case 19:try{e.appendLog(c.content.join("\n"))}catch(l){e.appendLog(c.content.msg)}e.logMonitor.cancelQueryLog(),e.commandGroup.setState({loading:!1});case 22:case"end":return t.stop()}}),t)})))()}cancelQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jobName){t.next=2;break}return t.abrupt("return");case 2:return a=Kt(),n=new d.ActionProxy,t.next=6,n.runScript("!kill "+e.jobName+";",a,{});case 6:r=t.sent;try{e.appendLog(r.content[0].description)}catch(s){e.appendLog(r.content)}e.jobName=null,e.logMonitor.cancelQueryLog();case 10:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:e=>e.preventDefault(),onDrop:this.etOver},n.createElement(Ke.Resizable,{defaultSize:{height:"500px"},onResize:()=>{this.aceEditorRef.current.editor.resize()}},n.createElement(be.a,{ref:e=>this.aceEditorRef=e,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(Wt,{ref:e=>this.commandGroup=e,parent:this}))}}class Wt extends n.Component{constructor(e){super(e),this.onChange=e=>{this.setState({timeout:e})},this.state={loading:!1,timeout:"-1"},this.parent=e.parent}render(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(Q.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(Q.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(Q.a,{onClick:this.parent.executeSave},"Save"))}}var zt=Qt;class Yt extends r.a.Component{constructor(e){super(e),this.addRef=e=>{e&&(this.editor=e)},this.text=(e,t)=>{this.editor.text(e,t)},this.queryApp=this.props.parent}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}render(){return r.a.createElement("div",null,r.a.createElement(zt,{parent:this,ref:e=>this.addRef(e),language:"python"}))}}const Xt=we.a.TabPane;class $t extends n.Component{constructor(e){super(e),this.pushRef=e=>{this.myRefs.push(e)},this.getCurrentEditor=()=>{const e=this.state.activeKey;let t=null;return this.myRefs.forEach(a=>{a.activeKey===e&&(t=a)}),t},this.onChange=e=>{let t=null;this.state.panes.forEach(a=>{a.key===e&&(t=a)}),t&&!t.title.endsWith(".mlsql")?this.parent.setState({displayEditor:"normal"}):t&&!t.title.endsWith(".nb")?this.parent.setState({displayEditor:"notebook"}):this.parent.setState({displayEditor:"pythoneditor"}),this.setState({activeKey:e})},this.onEdit=(e,t)=>{this[t](e)},this.addFull=(e,t)=>{const a=e.name,r=e.id,s=this.state.panes,o="newTab".concat(this.newTabIndex++);s.push({title:a||"MLSQL "+this.newTabIndex,content:(e=>a.endsWith(".mlsql")?n.createElement(Ct,{parent:this.parent,parentCallback:a=>{this.pushRef({ref:a,activeKey:e}),t&&t({ref:a,activeKey:e})},activeKey:e}):a.endsWith(".nb")?n.createElement(Ut,{id:r,name:a,parent:this.parent,parentCallback:a=>{this.pushRef({ref:a,activeKey:e}),t&&t({ref:a,activeKey:e})},activeKey:e}):a.endsWith(".py")?n.createElement(Yt,{parent:this.parent,parentCallback:a=>{this.pushRef({ref:a,activeKey:e}),t&&t({ref:a,activeKey:e})},activeKey:e}):void 0)(o),key:o,id:r}),this.setState({panes:s,activeKey:o})},this.add=()=>{this.addFull("MLSQL "+(this.newTabIndex+1),e=>{})},this.getPaneIndexByActiveKey=e=>{let t;return this.state.panes.forEach((a,n)=>{a.key===e&&(t=n-1)}),t},this.remove=e=>{let t=this.state.activeKey,a=this.getPaneIndexByActiveKey(e);const n=this.state.panes.filter(t=>t.key!==e);n.length&&t===e&&(t=a>=0?n[a].key:n[0].key);const r=this.myRefs.filter(t=>t.activeKey===e);this.myRefs=this.myRefs.filter(t=>t.activeKey!==e),this.parent.closeEditor(r[0]),this.setState({panes:n,activeKey:t})},this.parent=e.parent,this.myRefs=[],this.newTabIndex=0;const t=[{title:"MLSQL 1",content:n.createElement(Ct,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:"newTab0"})},activeKey:"newTab0"}),key:"newTab0"}];this.state={activeKey:t[0].key,panes:t},this.newTabIndex++}render(){return n.createElement(we.a,{onChange:this.onChange,activeKey:this.state.activeKey,type:"editable-card",onEdit:this.onEdit},this.state.panes.map(e=>n.createElement(Xt,{tab:e.title,key:e.key,closable:e.closable},e.content)))}}var Zt=a(185),ea=a(99);const ta=K.a.Group;class aa extends n.Component{constructor(e){super(e),this.etPopLoad=e.parent,this.state={}}render(){return n.createElement("div",null,n.createElement("span",null,"parameters:"),n.createElement(ta,{compact:!0},this.state.dataForRender))}}const na=a(110);class ra{static keyPath(e,t,a){let n=e;a(n),"object"===typeof t&&Object.keys(t).forEach(e=>{ra.keyPath("".concat(n,"['").concat(e,"']"),t[e],a)})}}ra.getTempTableName=()=>(na()+"").replace(/-/g,""),ra.getJobName=()=>na()+"",ra.escapeQuote=e=>e?e.replace(/[\""]/g,'\\"'):e,ra.quote=e=>e?'"'.concat(ra.escapeQuote(e),'"'):e,ra.unQuote=e=>"string"!==typeof e?e:e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,e.length-1):e.startsWith("'''")&&e.endsWith("'''")?e.slice(3,e.length-3):e,ra.visitDown=(e,t)=>{t(e),e.children&&e.children.map(e=>{ra.visitDown(e,t)})},ra.visitUp=(e,t)=>{e.children&&e.children.map(e=>{ra.visitUp(e,t)}),t(e)},ra.robotFetchParam=()=>({queryType:"robot",fetchType:"take",includeSchema:!0,outputSize:200}),ra.robotFetchParamWithCollect=()=>({queryType:"robot",includeSchema:!0}),ra.getField=e=>e.startsWith("`")&&e.endsWith("`")?e:"`".concat(e,"`"),ra.distinct=(e,t)=>{if(!t)return[...new Set(e)];const a={};return e.filter(e=>!(e[t]in a)&&(a[e[t]]=e[t],!0))},ra.fastCompareObject=(e,t)=>JSON.stringify(e)===JSON.stringify(t),ra.deepCompareObject=(e,t)=>function e(t,a){var n;if(isNaN(t)&&isNaN(a)&&"number"===typeof t&&"number"===typeof a)return!0;if(t===a)return!0;if("function"===typeof t&&"function"===typeof a||t instanceof Date&&a instanceof Date||t instanceof RegExp&&a instanceof RegExp||t instanceof String&&a instanceof String||t instanceof Number&&a instanceof Number)return t.toString()===a.toString();if(!(t instanceof Object&&a instanceof Object))return!1;if(t.isPrototypeOf(a)||a.isPrototypeOf(t))return!1;if(t.constructor!==a.constructor)return!1;if(t.prototype!==a.prototype)return!1;if((void 0).indexOf(t)>-1||(void 0).indexOf(a)>-1)return!1;for(n in a){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof a[n]!==typeof t[n])return!1}for(n in t){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof a[n]!==typeof t[n])return!1;switch(typeof t[n]){case"object":case"function":if((void 0).push(t),(void 0).push(a),!e(t[n],a[n]))return!1;(void 0).pop(),(void 0).pop();break;default:if(t[n]!==a[n])return!1}}return!0}(e,t);const sa=K.a.Group,oa=ft.a.Option;class ca extends n.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=Object(i.a)(l.a.mark((function e(){var a,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t,a=new d.ActionProxy,e.next=4,a.runScript("load _mlsql_.`datasources` as output;",ra.getJobName(),ra.robotFetchParamWithCollect());case 4:r=e.sent,s=ra.distinct(r.content.data,"name"),o=[],s.forEach(e=>{o.push(n.createElement(oa,{key:e.name,value:e.name},e.name))}),t.setState({datasourcesRender:o});case 9:case"end":return e.stop()}}),e)}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.sourceType=(e,t)=>{this.data.sourceTypeV=e;const a=this;new ht(je).runScript({},"load _mlsql_.`datasources/params/".concat(e,"` as output;"),e=>{const t=[];e.forEach(e=>{t.push(n.createElement(Zt.a,{key:"row-".concat(e.param)},n.createElement(ea.a,null,n.createElement(K.a,{key:"input-".concat(e.param),style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description}))))}),a.loadParamsRef.current.setState({dataForRender:t})},e=>{})},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.makeMLSQL=()=>{let e=[];for(let a in this.data.params){let t=this.data.params[a];if(t){let n='"'+t+'"';"code"!==a&&"fitParam.[group].code"!==a||(n="'''"+t+"'''"),e.push(a.replace(/\[group\]/g,"0")+"="+n)}}let t="";return e.length>0&&(t="where"),"load ".concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` ").concat(t," ").concat(e.join("and\\n ")," as ").concat(this.data.tableNameV,";")},this.etpop=e.parent,this.data={params:{}},this.state={datasourcesRender:[]},this.loadParamsRef=n.createRef()}render(){return n.createElement("div",null,n.createElement(sa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,"soureType:",n.createElement(ft.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.datasourcesRender)))),n.createElement("br",null),this.props.ignorePath?n.createElement("div",null):n.createElement(sa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{onChange:this.path,type:"text",label:"Path",addonBefore:"Path",placeholder:"File path or tableName"})))),n.createElement("br",null),this.props.ignoreTableName?n.createElement("div",null):n.createElement(sa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"tableName"})))),n.createElement("br",null),n.createElement(aa,{parent:this,ref:this.loadParamsRef}))}}const la=K.a.Group,ia=(ft.a.Option,K.a.TextArea);class ua extends n.Component{constructor(e){super(e),this.renderParam=e=>"keepVersion"===e.param&&"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(Zt.a,null,n.createElement(ea.a,null,e.param,":",n.createElement(ia,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",rows:10}))):n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",addonBefore:e.param,placeholder:e.description}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.makeMLSQL=()=>{let e=[];for(let t in this.data.params){let a=this.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+a+'"')}return 0==e.length&&e.push('keepVersion="true"'),"train ".concat(this.data.tableNameV," as ").concat(this.name,".`").concat(this.data.pathV,"` where \n").concat(e.join(" and\n "),";")},this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[]}}componentDidMount(){const e=this;new ht(je).runScript({},"load modelParams.`".concat(e.name,"` as output;"),t=>{const a=[];t.forEach(e=>{const t=this.renderParam(e);null!==t&&(a.push(t),a.push(n.createElement("br",null)))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement("span",null,"Training data and model path:"),n.createElement(la,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:"tableName",placeholder:"the table of training data"})))),n.createElement("br",null),n.createElement(la,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{onChange:this.path,type:"text",size:"large",addonBefore:"Model save path",placeholder:"the location you save you model"})))),n.createElement("br",null),n.createElement("span",null,"Algorithm parameters:"),n.createElement(la,{compact:!0},this.state.dataForRender))}}const pa=K.a.Group,ma=ft.a.Option;class da extends n.Component{constructor(e){super(e),this.sourceType=(e,t)=>{this.data.sourceTypeV=e},this.saveMode=(e,t)=>{this.data.saveModeV=e},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.partitionBy=e=>{this.data.partitionByV=e.target.value},this.fileNum=e=>{this.data.fileNumV=e.target.value},this.makeMLSQL=()=>{let e="";this.data.partitionByV&&(e="partitionBy "+this.data.partitionByV);let t='key="value"';return this.data.fileNumV&&(t='fileNum="'.concat(this.data.fileNumV,'"')),"save ".concat(this.data.saveModeV," ").concat(this.data.tableNameV," as ").concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` \n where ").concat(t," ").concat(e,";")},this.etpop=e.parent,this.data={},this.state={datasourcesRender:[]}}componentDidMount(){const e=this;new ht(je).runScript({},"load _mlsql_.`datasources` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(ma,{key:e.name,value:e.name},e.name))}),e.setState({datasourcesRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(pa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,"soureType:",n.createElement(ft.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.datasourcesRender)))),n.createElement("br",null),n.createElement(pa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,"SaveMode:",n.createElement(ft.a,{onChange:this.saveMode,showSearch:!0,style:{width:200},placeholder:"Choose save mode type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ma,{key:"overwrite",value:"overwrite"},"overwrite"),n.createElement(ma,{key:"append",value:"append"},"append"),n.createElement(ma,{key:"errorIfExists",value:"errorIfExists"},"errorIfExists"),n.createElement(ma,{key:"ignore",value:"ignore"},"ignore"))))),n.createElement("br",null),n.createElement(pa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"the tableName will be saved"})))),n.createElement("br",null),n.createElement(pa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{onChange:this.path,type:"text",addonBefore:"Target Path",placeholder:"File path or tableName"})))),n.createElement("br",null),n.createElement(pa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.partitionBy,addonBefore:"partitionBy",placeholder:"partitionBy"})))),n.createElement("br",null),n.createElement(pa,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.fileNum,addonBefore:"fileNum",placeholder:"fileNum"})))),n.createElement("br",null))}}const ha=K.a.Group,ba=(ft.a.Option,K.a.TextArea);class fa extends n.Component{constructor(e){super(e),this.renderParam=e=>"keepVersion"===e.param||"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(Zt.a,null,n.createElement(ea.a,null,e.param,":",n.createElement(ba,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",rows:10}))):n.createElement(Zt.a,{key:e.param},n.createElement(ea.a,null,n.createElement(K.a,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",addonBefore:e.param,placeholder:e.description}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.outputTableName=e=>{this.data.outputTableNameV=e.target.value},this.showTableName=()=>"true"!==this.state.tableHidden?n.createElement(ha,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:this.state.tableAlias?this.state.tableAlias:"Input table",placeholder:""})))):null,this.showOutputTableName=()=>"true"!==this.state.outputTableHidden?n.createElement(ha,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{type:"text",onChange:this.outputTableName,size:"large",addonBefore:this.state.outputTableAlias?this.state.outputTableAlias:"Output table",placeholder:""})))):null,this.pathNameForRender=()=>this.state.pathAlias?this.state.pathAlias:"Save path",this.showPathName=()=>"true"!==this.state.pathHidden?n.createElement(ha,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{onChange:this.path,type:"text",size:"large",addonBefore:this.pathNameForRender(),placeholder:""})))):"",this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden,outputTableHidden:e.outputTableHidden,outputTableAlias:e.outputTableAlias,tableAlias:e.tableAlias}}componentDidMount(){const e=this;new ht(je).runScript({},"load modelParams.`".concat(e.name,"` as output;"),t=>{const a=[];t.forEach(e=>{const t=this.renderParam(e);null!==t&&(a.push(t),a.push(n.createElement("br",null)))}),e.setState({dataForRender:a})},e=>{})}_makeMLSQL(){let e=[];for(let n in this.data.params){let t=this.data.params[n],a='"'+t+'"';"code"!==n&&"fitParam.[group].code"!==n||(a="'''"+t+"'''"),e.push(n.replace(/\[group\]/g,"0")+"="+a)}let t="";e.length>0&&(t="where");let a="";return this.data.outputTableNameV&&(a="as ".concat(this.data.outputTableNameV)),"run ".concat(this.data.tableNameV||"command"," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(t," ").concat(e.join("and\n ")," ").concat(a,";")}_render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(ha,{compact:!0},this.state.dataForRender))}}class Ea extends fa{constructor(e){super(e),this.makeMLSQL=()=>super._makeMLSQL()}render(){return super._render()}}const ga=K.a.Group;ft.a.Option;class ya extends Ea{constructor(...e){super(...e),this.makeMLSQL=()=>{let e=[];for(let t in this.data.params){let a=this.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+a+'"')}return 0==e.length&&e.push('keepVersion="true"'),"run command as ".concat(this.name,".`` where \n").concat(e.join(" and\n "),";")}}render(){return n.createElement("div",null,n.createElement(ga,{compact:!0},this.state.dataForRender))}}a(1019),a(1020),a(1021);var va=a(501),wa=a.n(va);const ka=ft.a.Option,xa=K.a.TextArea;class Sa extends n.Component{constructor(e){super(e),this.udfName=e=>{this.data.udfNameV=e.target.value},this.dataType=e=>{this.data.dataTypeV=e.target.value},this.udfType=e=>{this.udfTypeV=e},this.code=e=>{this.codeV=e},this.langSelect=e=>{this.lang=e,this.codeCheckRef.current.checked=!1,this.setState({dataType:!1}),"python"===this.lang&&this.setState({dataType:!0}),this.setState({codeLang:e})},this.setCodeExample=e=>{e?this.codeRef.current.editor.setValue(this.codeExample()):this.codeRef.current.editor.setValue("")},this.codeExample=()=>{const e=this.state.codeLang||"scala";return"scala"===e?"def apply(a:Double,b:Double)={\n   a + b\n}":"python"===e?"def apply(self,m):\n    return m":"java"===e?"import java.util.HashMap;\nimport java.util.Map;\npublic class UDF {\n  public Map<String, Integer[]> apply(String s) {\n    Map<String, Integer[]> m = new HashMap<>();\n    Integer[] arr = {1};\n    m.put(s, arr);\n    return m;\n  }\n}":null},this.showDataType=()=>this.state.dataType?n.createElement(Zt.a,null,n.createElement(ea.a,null,"dataType:",n.createElement(xa,{style:{marginBottom:"10px"},name:"dataType",rows:10,onChange:this.dataType,type:"text",addonBefore:"dataType",placeholder:"This is not required when lang is scala\nAs we know python is not strongly typed language, so\nwe should manually spcify the return type.\nmap(string,string) means a map with key is string type,value also is string type.\narray(string) means a array with string type element.\nnested is support e.g. array(array(map(string,array(string))))\n\n"}))):null,this.showCode=()=>n.createElement("div",null,n.createElement(Zt.a,null,n.createElement(ea.a,null,"code:",n.createElement(be.a,{ref:this.codeRef,mode:this.state.codeLang||"scala",theme:"github",width:"400px",height:"300px",name:"code",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,onChange:this.code,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}}))),n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(ea.a,{span:8},"Show CodeExample:",n.createElement(wa.a,{ref:this.codeCheckRef,onChange:this.setCodeExample}))))),this.makeMLSQL=()=>{let e=[];return e.push('lang="'.concat(this.lang,'"')),e.push("code='''".concat(this.codeV,"'''")),e.push('udfType="'.concat(this.udfTypeV,'"')),this.dataTypeV&&e.push("dataType='''".concat(this.dataTypeV,"'''")),"register ScriptUDF.`` as ".concat(this.data.udfNameV," where \n").concat(e.join("\nand "),";")},this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[]},this.codeRef=n.createRef(),this.codeCheckRef=n.createRef()}componentDidMount(){}render(){return n.createElement("div",null,n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{onChange:this.udfName,type:"text",size:"large",addonBefore:"UDF Name",placeholder:"the name of udf"}))),n.createElement("br",null),n.createElement(Zt.a,null,n.createElement(ea.a,{span:4},n.createElement("span",null,"udfType:")),n.createElement(ea.a,{span:20},n.createElement(ft.a,{showSearch:!0,onChange:this.udfType,style:{width:200},placeholder:"Select udf type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ka,{value:"udf"},"udf"),n.createElement(ka,{value:"udaf"},"udaf")))),n.createElement("br",null),n.createElement(Zt.a,null,n.createElement(ea.a,{span:4},n.createElement("span",null,"Lang:")),n.createElement(ea.a,{span:20},n.createElement(ft.a,{showSearch:!0,style:{width:200},placeholder:"Select language type",optionFilterProp:"children",onChange:this.langSelect,filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ka,{value:"java"},"java"),n.createElement(ka,{value:"scala"},"scala"),n.createElement(ka,{value:"python"},"python")))),n.createElement("br",null),this.showDataType(),n.createElement("br",null),this.showCode(),n.createElement("br",null),n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{style:{marginBottom:"10px"},name:"methodName",onChange:this.params,type:"text",addonBefore:"methodName",placeholder:"methodName"}))))}}K.a.Group;const Oa=ft.a.Option;class ja extends n.Component{constructor(e){super(e),this.etName=e=>{this.etName=e},this.makeMLSQL=()=>"load modelExample.`".concat(this.etName,"` as output;"),this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden}}componentDidMount(){const e=this;new ht(je).runScript({},"load model.`list` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(Oa,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(Zt.a,null,n.createElement(ea.a,null,"ET:",n.createElement(ft.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}K.a.Group;const Ca=ft.a.Option;class Ta extends Ea{constructor(...e){super(...e),this.makeMLSQL=()=>"register ".concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` as ").concat(this.data.outputTableNameV,";"),this.etName=e=>{this.data.sourceTypeV=e}}componentDidMount(){const e=this;new ht(je).runScript({},"load model.`list` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(Ca,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Zt.a,null,n.createElement(ea.a,null,"ET:",n.createElement(ft.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}const Na=K.a.Group;class _a extends fa{constructor(e){super(e),this.makeMLSQL=()=>{let e="";this.data.outputTableNameV&&(e="as ".concat(this.data.outputTableNameV));const t=super._makeMLSQL().replace(e,""),a="predict ".concat(this.data.tableNameV," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(e,";");return"".concat(t,"\n        ").concat(a,"\n        register ").concat(this.name,".`").concat(this.data.pathV||"","` as ").concat(this.data.functionNameV,"; \n        ").stripMargin()},this.functionName=e=>{this.data.functionNameV=e.target.value}}render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Na,{compact:!0},n.createElement(Zt.a,null,n.createElement(ea.a,null,n.createElement(K.a,{onChange:this.functionName,type:"text",size:"large",addonBefore:"functionName",placeholder:"A function you can use to convert String to number or number to String"})))),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(Na,{compact:!0},this.state.dataForRender))}}class Ia extends fa{constructor(e){super(e),this.makeMLSQL=()=>{const e="/api_v1/public/file/download?fileName=".concat(encodeURIComponent(this.data.pathV)),t=document.createElement("a");return t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),""}}componentDidMount(){}render(){return super._render()}}K.a.Group;const Pa=ft.a.Option;class Aa extends n.Component{constructor(e){super(e),this.etName=e=>{this.etName=e},this.makeMLSQL=()=>"load _mlsql_.`progress/".concat(this.etName,"` as output;"),this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden}}componentDidMount(){const e=this;new ht(je).runScript({},"load _mlsql_.`jobs` as output;",t=>{const a=t.filter(e=>"stream"===e.jobType).map(e=>n.createElement(Pa,{key:e.jobName,value:e.jobName},e.jobName));e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(Zt.a,null,n.createElement(ea.a,null,"Stream Jobs:",n.createElement(ft.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose Stream Name",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}class Da extends n.Component{constructor(e){super(e),this.disableEtModalVisible=()=>{this.et.setState({etPop:!1,etModalVisible:!1})},this.enableEtModalVisible=()=>{const e=this.popChild.current.makeMLSQL();this.et.makeMLSQL(e),this.et.setState({etPop:!1,etModalVisible:!1})},this.renderContent=()=>"load"===this.et.state.eventName?n.createElement(ca,{parent:this,ref:this.popChild}):"save"===this.et.state.eventName?n.createElement(da,{name:this.et.state.eventName,ref:this.popChild}):"DownloadExt"===this.et.state.eventName?n.createElement(ya,{name:this.et.state.eventName,ref:this.popChild}):"StringIndex"===this.et.state.eventName?n.createElement(_a,{name:this.et.state.eventName,ref:this.popChild}):"DownloadFile"===this.et.state.eventName?n.createElement(Ia,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):"ETExample"===this.et.state.eventName?n.createElement(ja,{name:this.et.state.eventName,ref:this.popChild}):"ETStreamProgress"===this.et.state.eventName?n.createElement(Aa,{name:this.et.state.eventName,ref:this.popChild}):"ScriptUDF"===this.et.state.eventName?n.createElement(Sa,{name:this.et.state.eventName,ref:this.popChild}):"register"===this.et.state.eventName?n.createElement(Ta,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):"tool"===this.et.state.processType?n.createElement(Ea,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):n.createElement(ua,{name:this.et.state.eventName,ref:this.popChild}),this.et=e.parent,this.popChild=n.createRef(),this.state={etModalVisible:!0,title:e.title},this.data={}}render(){return n.createElement("div",null,n.createElement(q.a,{title:this.state.title,visible:this.state.etModalVisible,onCancel:this.disableEtModalVisible,onOk:this.enableEtModalVisible,okText:"Ok",cancelText:"Cancel"},this.renderContent()))}}var Ra=a(44),La=a.n(Ra);const Fa=ve.a.Panel;we.a.TabPane;class Ma extends n.Component{constructor(e){super(e),this.setData=(e,t)=>{this.itemData[e]=t},this.getData=e=>this.itemData[e],this.onDragStart=e=>{const t=e.target.getAttribute("processtype");this.setData("eventName",e.target.getAttribute("name")),this.setData("popName",e.target.getAttribute("help")),this.setData("processType",t),this.setData("pathAlias",e.target.getAttribute("pathalias")||""),this.setData("outputTableAlias",e.target.getAttribute("outputtablealias")||""),this.setData("tableAlias",e.target.getAttribute("tablealias")||""),this.setData("tableHidden",e.target.getAttribute("tablehidden")||!1),this.setData("pathHidden",e.target.getAttribute("pathhidden")||!1),this.setData("outputTableHidden",e.target.getAttribute("outputtablehidden")||!1)},this.makeMLSQL=e=>{this.queryApp.getCurrentEditor().ref.appendToEditor(e)},this.renderPop=()=>this.state.etPop?n.createElement(Da,{parent:this,title:this.state.popName}):null,this.etDoubleClick=e=>{this.onDragStart(e),this.queryApp.getCurrentEditor().ref.etOver(e)},this.queryApp=e.parent,this.state={},this.itemData={}}componentDidMount(){}render(){return n.createElement("div",null,n.createElement(ve.a,{style:{margin:"0px 0px",padding:"0px 0px"}},n.createElement(Fa,{header:"Quick Menu",key:"1"},n.createElement(Zt.a,{gutter:16},n.createElement(ea.a,{span:8},n.createElement(J.a,{title:"Load/Save Data"},n.createElement(La.a,{tyle:{marginBottom:"10px"},title:"Load/Save Data",onDragStart:this.onDragStart,name:"load",help:"Load file/db as table",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Load data"),n.createElement(La.a,{tyle:{marginBottom:"10px"},title:"Save Data",onDragStart:this.onDragStart,name:"save",help:"Save table into file/db ",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Save data"))),n.createElement(ea.a,{span:8},n.createElement(J.a,{title:"Algorithms"},n.createElement(La.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"TfIdfInPlace",help:"Use TfIdfInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"TfIdf"),n.createElement(La.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Word2VecInPlace",help:"Use Word2VecInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Word2vec"),n.createElement(La.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RandomForest",help:"Use RandomForest to train a model",draggable:!0,color:"magenta"},"RandomForest"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonAlg",help:"Run python lib to train",draggable:!0,color:"magenta"},"Python Algorithm"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"BigDLClassifyExt",help:"Use BigDL to develop deep learning algorithm",draggable:!0,color:"magenta"},"Deep Learning"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"NaiveBayes",help:"Use NaiveBayes",draggable:!0,color:"magenta"},"NaiveBayes"))),n.createElement(ea.a,{span:8},n.createElement(J.a,{title:"Python"},n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonEnvExt",processtype:"tool",help:"Create Python Env",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Create Python Env"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonParallelExt",processtype:"tool",help:"Run python project",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Run python project")))),n.createElement("br",null),n.createElement(Zt.a,{gutter:16},n.createElement(ea.a,{span:8},n.createElement(J.a,{title:"Register model as Function"},n.createElement(La.a,{onDragStart:this.onDragStart,name:"ScriptUDF",processtype:"tool",onDoubleClick:this.etDoubleClick,help:"Use ScriptUDF create udf",draggable:!0,color:"magenta"},"Create UDF"),n.createElement(La.a,{onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"register",help:"Register model to function ",pathalias:"Model saved path",outputtablealias:"Function name",tablealias:"Function name",tablehidden:"true",pathhidden:"false",outputtablehidden:"false",draggable:!0,color:"magenta"},"Register Model As Function"))),n.createElement(ea.a,{span:8},n.createElement(J.a,{title:"Jobs"},n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"JobList",onDoubleClick:this.etDoubleClick,processtype:"direct",draggable:!0,color:"magenta"},"Show jobs"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Kill",onDoubleClick:this.etDoubleClick,processtype:"tool",pathalias:"groupId or jobName",tablehidden:"true",help:"Kill your job",draggable:!0,color:"magenta"},"Kill job"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETStreamProgress",processtype:"",help:"Show Progress of Stream",draggable:!0,color:"magenta"},"Show Stream Job Progress"))),n.createElement(ea.a,{span:8},n.createElement(J.a,{title:"Tools"},n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadExt",processtype:"tool",help:"Use DownloadExt to download files you have uploaded",draggable:!0,color:"magenta"},"Download uploaded file"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ImageLoaderExt",processtype:"tool",help:"Use ImageLoaderExt to load images",pathalias:"",tablehidden:"true",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Load images"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ConnectMySQL",processtype:"direct",help:"",draggable:!0,color:"magenta"},"Connect MySQL"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"JDBC",processtype:"tool",pathalias:"DB name in connect",tablehidden:"false",help:"Run DLL on MySQL",draggable:!0,color:"magenta"},"MySQL DDL"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"TreeBuildExt",processtype:"tool",pathalias:"",tablehidden:"false",pathhidden:"true",help:"Build tree from parent-child",draggable:!0,color:"magenta"},"Parent-Child"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETExample",processtype:"",help:"Show Example of ET",draggable:!0,color:"magenta"},"Show ET Example"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RepartitionExt",processtype:"tool",help:"Change Table Partition Num",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Repartition table"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"SendMessage",processtype:"tool",help:"Send email",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Send Mail"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"CacheExt",processtype:"tool",help:"Cache table",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Cache Table"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"StringIndex",processtype:"tool",help:"Convert String to number",pathalias:"Mapping path",tablehidden:"false",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Convert String to number"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadFile",processtype:"tool",help:"Download File",pathalias:"Target file",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Download File to computer"),n.createElement(La.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ShowResource",processtype:"direct",draggable:!0,color:"magenta"},"Cluster Resource")))))),this.renderPop())}}var qa=a(1127),Va=a(260),Ba=a(1154);const Ga=qa.a.TreeNode,Ua=qa.a.DirectoryTree;class Ja extends n.Component{constructor(e){super(e),this.state={dbs:{},loading:!1}}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.next=3,$e.tablesInDeltaLake();case 3:200===(a=t.sent).status&&(n={},a.content.forEach(e=>{n[e.database]?n[e.database].push(e.table):n[e.database]=[e.table]}),e.setState({dbs:n})),e.setState({loading:!1});case 6:case"end":return t.stop()}}),t)})))()}show(){return Object.entries(this.state.dbs).map(([e,t])=>n.createElement(Ga,{title:e,key:e},t.map(t=>n.createElement(Ga,{icon:n.createElement(Ba.a,null),title:t,key:"".concat(e,".").concat(t),isLeaf:!0}))))}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return n.createElement(Va.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Ua,null,this.show()))}}const Ha=qa.a.TreeNode,Ka=qa.a.DirectoryTree;class Qa extends n.Component{constructor(e){var t;super(e),t=this,this.getFileList=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e.ls(a);case 2:if(200!==(n=e.sent).status||n.content[0]._corrupt_record){e.next=6;break}return r=n.content.map(e=>(e.is_dir=t.isDir(e),e.key=e.path,e.title=e.path.split("/").slice(-1)[0],e.isLeaf=!e.is_dir,e)),e.abrupt("return",r);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isDir=e=>e.permission.startsWith("d"),this.onLoadData=function(){var e=Object(i.a)(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getFileList(a.props.dataRef.path);case 2:a.props.dataRef.children=e.sent,t.setState({root:[...t.state.root]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.renderTreeNodes=e=>e.map(e=>e.children?n.createElement(Ha,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e},this.renderTreeNodes(e.children)):n.createElement(Ha,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e})),this.state={root:[],loading:!1}}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.next=3,e.getFileList("/");case 3:a=t.sent,e.setState({loading:!1,root:a});case 5:case"end":return t.stop()}}),t)})))()}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",null,n.createElement(Va.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Ka,{loadData:this.onLoadData},this.renderTreeNodes(this.state.root))))}}a(453);var Wa=a(1151),za=a(1150),Ya=a(1149),Xa=a(1148),$a=a(1147);const Za=a(104),en={setState:Za.SetStateActionHandler},tn={setState:Za.SetStateAction},an=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new d.ActionProxy,n=t.data,r=n.node,s=n.consoleApp,r.isDir){e.next=10;break}return e.next=5,a.get(h.default.SCRIPT_FILE_GET,{id:r.id});case 5:if(200===(o=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to get file ".concat(r.label,". Reason: ").concat(o.content)}});case 8:c=o.content,s.openExistsOrNewEditor({id:r.id,content:c.content,name:c.name});case 10:return e.abrupt("return",{data:{}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),nn=an.handler,rn=an.action,sn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,u,p,m,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new d.ActionProxy,n=t.data,r=n.createType,n.consoleApp,s=n.form,o=n.scriptContent,c=void 0===o?"":o,i=s.getFieldValue(),u=i.fileName){e.next=5;break}return e.abrupt("return",{data:{createFileError:"Please input the file name"}});case 5:p=t.__state.node,m=!1,e.t0=r,e.next="file"===e.t0?10:"folder"===e.t0?14:16;break;case 10:if(m=!1,u.endsWith(".mlsql")||u.endsWith(".nb")||u.endsWith(".py")){e.next=13;break}return e.abrupt("return",{data:{createFileError:"fileName should end with .mlsql or .nb or .py"}});case 13:return e.abrupt("break",16);case 14:return m=!0,e.abrupt("break",16);case 16:return b={fileName:u,isDir:m,content:c,parentId:p.id},e.next=19,a.post(h.default.SAVE_SCRIPT_FILE,b);case 19:return e.sent,e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{reloading:ra.getJobName()})});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),on=sn.handler,cn=sn.action,ln=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.expandedKeys,n=t.__state.expandedKeys,r=a.filter(e=>!n.includes(e)),s=n.filter(e=>!a.includes(e)),o=new d.ActionProxy,console.log(r,s),r.forEach(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.forEach(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!1});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{data:{expandedKeys:a}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),un=ln.handler,pn=ln.action,mn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.node,e.next=3,d.ActionProxy.client.post(h.default.SCRIPT_FILE_REMOVE,{id:a.id});case 3:return e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{reloading:ra.getTempTableName()})});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),dn=mn.handler,hn=mn.action,bn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new d.ActionProxy,n=t.data,r=n.node,n.consoleApp,r.isDir){e.next=8;break}return e.next=5,a.post(h.default.ANALYSIS_PLUGIN_PUBLISH,{id:r.id});case 5:if(200===(s=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to publish file ".concat(r.label,". Reason: ").concat(s.content)}});case 8:return e.abrupt("return",{data:{}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),fn=bn.handler,En=bn.action,gn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,n=t.data,r=n.node,n._,e.next=4,a.post(h.default.SCRIPT_SHARE_PUBLIC,{id:r.id});case 4:if(200===(s=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:"Fail to share ".concat(r.label,". Reason: ").concat(s.content)}});case 7:return e.abrupt("return",{data:{}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),yn=gn.handler,vn=gn.action;class wn{}wn.openScriptFile="openScriptFile",wn.createScriptFile="createScriptFile",wn.deleteScriptFile="deleteScriptFile",wn.publishPlugin="publishPlugin",wn.sharePublic="publishPlugin",wn.expand="expand";const kn=Object(y.a)(Object(y.a)({},en),{},{[wn.openScriptFile]:nn,[wn.createScriptFile]:on,[wn.expand]:un,[wn.deleteScriptFile]:dn,[wn.publishPlugin]:fn,[wn.sharePublic]:yn}),xn=Object(y.a)(Object(y.a)({},tn),{},{[wn.openScriptFile]:rn,[wn.createScriptFile]:cn,[wn.expand]:pn,[wn.deleteScriptFile]:hn,[wn.publishPlugin]:En,[wn.sharePublic]:vn});function Sn(e,t){return xn[t.type](e,t.data)}var On=a(1153),jn=a(1152);a(1107);var Cn=class{constructor(){this.build=e=>{let t,a,n={},r=[];for(a=0;a<e.length;a+=1)n[e[a].id]=a,e[a].childNodes=[];for(a=0;a<e.length;a+=1)if(t=e[a],0!==t.parentId)try{e[n[t.parentId]].childNodes.push(t)}catch(s){console.log(t),console.log(n[t.parentId])}else r.push(t);return r},this.convert=e=>(e.childNodes&&e.childNodes.length>0&&(e.children=e.childNodes,e.children.map(e=>this.convert(e))),e.id=String(e.id),e.key=e.id,e.title=r.a.createElement("span",null,e.label),e.isLeaf=!e.isDir,e.isExpand=!e.isExpanded,e.isDir?e.icon=r.a.createElement(On.a,null):e.icon=r.a.createElement(jn.a,null),e)}};function Tn(){const e=Object(ne.a)(["\n  width: 100%; \n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 30px 30px;\n"]);return Tn=function(){return e},e}const Nn=re.a.div(Tn());var _n=function(){return r.a.createElement(Nn,null,r.a.createElement(Va.a,{tip:"Loading...."}))};const In=({contextMenuRef:e,dispacher:t,onRender:a})=>{const s=Object(n.useState)(void 0),o=Object(u.a)(s,2),c=o[0],l=o[1];return{onRightClick:Object(n.useCallback)(t=>{const a=t.event,n=t.node;let r=a.clientX,s=a.clientY;const o=t=>{if(!e.current)return;!e.current.contains(t.target)&&l(void 0)};document.addEventListener("click",o);const c=()=>{l(void 0)};return document.addEventListener("scroll",c),l({pageX:r,pageY:s,id:n.id||n.key}),()=>{document.removeEventListener("click",o),document.removeEventListener("scroll",c)}},[l]),ui:Object(n.useCallback)(()=>{if(!c)return;const n=Object(y.a)({},c),s=n.pageX,o=n.pageY,i=(n.id,{zIndex:1e4,position:"fixed",left:"".concat(s,"px"),top:"".concat(o,"px"),borderRadius:"3px",boxShadow:"0 0 0 1px rgba(16, 22, 26, 0.1), 0 2px 4px rgba(16, 22, 26, 0.2), 0 8px 24px rgba(16, 22, 26, 0.2)"});return r.a.createElement("div",{ref:e,style:i},a({rightClickNodeTreeItem:c,setRightClickNodeTreeItem:l,dispacher:t}))},[c])}},Pn=qa.a.DirectoryTree,An={nodes:[],error:void 0,createFileError:void 0,createType:void 0,createTitle:void 0,operateModal:!1,reloading:void 0,loading:!0,expandedKeys:[]},Dn=r.a.createContext();function Rn(e){const t=e.consoleApp,a=Object(p.useReducerAsync)(Sn,An,kn),s=Object(u.a)(a,2),o=s[0],c=s[1],m=o.loading,b=o.nodes,f=o.error,E=o.createFileError,g=o.createType,y=o.operateModal,v=o.createTitle,w=o.reloading,k=o.expandedKeys,x=new d.ActionProxy,S=Object(n.useRef)(),O=H.a.useForm(),j=Object(u.a)(O,1)[0];Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get(h.default.SCRIPT_SHARE_PUBLIC,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,x.get(h.default.SCRIPT_FILE_LIST,{});case 7:if(200===(a=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:n=new Cn,s=n.build(a.content).sort((e,t)=>t.id-e.id),t.content.map(e=>{e[0].parentId=0,e[0].label=r.a.createElement("span",{style:{color:"green"}},e[0].label+"(shared by others)");const t=n.build(e);return s[0].childNodes=s[0].childNodes.concat(t[0]),e}),o=s.map(e=>n.convert(e)),ra.visitDown(o[0],e=>{e.isExpanded&&k.push(e.id)}),c({type:"setState",data:{nodes:o,loading:!1,expandedKeys:k}});case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[w]);const C=In({contextMenuRef:S,dispacher:c,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;let s=void 0;return ra.visitDown(b[0],e=>{e.id===n&&(s=e)}),n===b[0].id?r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(Wa.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"folder",createTitle:"Create Project",operateModal:!0}})}},"Create Project")):s.isDir?r.a.createElement(N.a,null,s.parentId==b[0].id&&r.a.createElement(N.a.Item,{icon:r.a.createElement(za.a,null),onClick:()=>{a({type:wn.sharePublic,data:{node:s}}),t(void 0)},key:0},"Share Public"),r.a.createElement(N.a.Item,{icon:r.a.createElement(Ya.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"file",createTitle:"Create File",operateModal:!0}}),t(void 0)},key:1},"Create Script"),r.a.createElement(N.a.Item,{icon:r.a.createElement(Wa.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"folder",createTitle:"Create Folder",operateModal:!0}}),t(void 0)},key:2},"Create Folder"),r.a.createElement(N.a.Item,{icon:r.a.createElement(Xa.a,null),onClick:()=>{a({type:wn.deleteScriptFile,data:{node:s}}),t(void 0)},key:3},"Delete")):r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{onClick:()=>{a({type:wn.publishPlugin,data:{node:s}}),t(void 0)},key:0},"Publish As Plugin To Analysis"),r.a.createElement(N.a.Item,{onClick:()=>{a({type:wn.deleteScriptFile,data:{node:s}}),t(void 0)},key:1},"Delete"))}}),T=C.onRightClick,_=C.ui;return r.a.createElement(Dn.Provider,{value:{dispacher:c}},_(),r.a.createElement(Ee.a,{title:v,visible:y,onCancel:()=>{c({type:"setState",data:{operateModal:!1}})},onOk:()=>{c({type:wn.createScriptFile,data:{operateModal:!1,consoleApp:t,createType:g,form:j}})},cancelText:"Cancel",OkText:"Ok"},E&&r.a.createElement(ce,{message:E}),r.a.createElement(H.a,{form:j},r.a.createElement(H.a.Item,{name:"fileName",label:"File Name"},r.a.createElement(K.a,null)))),f&&r.a.createElement(ce,{message:f}),m&&r.a.createElement(_n,null),!m&&r.a.createElement(Pn,{height:700,onExpand:e=>{c({type:wn.expand,data:{expandedKeys:e}})},onDoubleClick:(e,a)=>{c({type:wn.openScriptFile,data:{consoleApp:t,node:a}})},defaultExpandedKeys:k,expandAction:"click",onRightClick:T,switcherIcon:r.a.createElement($a.a,null),treeData:b}))}const Ln=we.a.TabPane;class Fn extends n.Component{constructor(e){super(e),this.queryApp=e.parent}render(){return n.createElement(we.a,{defaultActiveKey:"1",style:{maxWidth:"350px"},onTabClick:e=>{"2"===e&&this.deltaLakeTreeRef&&this.deltaLakeTreeRef.reload()}},n.createElement(Ln,{tab:"Script",key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(Rn,{consoleApp:this.queryApp}))),n.createElement(Ln,{tab:"DeltaLake",key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Ja,{ref:e=>this.deltaLakeTreeRef=e}))),n.createElement(Ln,{tab:"FileSystem",key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Qa,{ref:e=>this.fileSystemTreeRef=e}))))}}a(454);class Mn extends n.Component{constructor(e){super(e),this.openExistsOrNewEditor=e=>{const t=this;if(this.fileToEditorMap.hasOwnProperty(e.id)){const t=this.fileToEditorMap[e.id];t.ref.text(e.content,e.id),this.editorGroup.current.onChange(t.activeKey)}else this.editorGroup.current.addFull(e,a=>{a.ref.text(e.content,e.id),t.fileToEditorMap[e.id]=a});e.name.endsWith(".nb")?t.setState({displayEditor:"notebook"}):e.name.endsWith(".py")?t.setState({displayEditor:"pythoneditor"}):t.setState({displayEditor:"normal"})},this.closeEditor=e=>{const t=Object.keys(this.fileToEditorMap).filter(t=>this.fileToEditorMap[t].activeKey!==e.activeKey).reduce((e,t)=>(e[t]=this.fileToEditorMap[t],e),{});this.fileToEditorMap=t},this.getCurrentEditor=()=>this.editorGroup.current.getCurrentEditor(),this.setData=e=>{this.queryResData=e,this.dash.current.refresh()},this.tableAndDash=()=>{if("notebook"!==this.state.displayEditor||"pythoneditor"!==this.state.displayEditor)return r.a.createElement("div",null,r.a.createElement(Ke.Resizable,{defaultSize:{height:"300px"},onResize:()=>{this.messageBox.current.editor.resize()}},r.a.createElement(be.a,{height:"100%",width:"100%",ref:this.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(st,{ref:this.dash,parent:this})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(ye,{ref:this.display,parent:this})))},this.state={sqlContent:"",displayEditor:"normal"},this.editorGroup=r.a.createRef(),this.messageBox=r.a.createRef(),this.display=r.a.createRef(),this.dash=r.a.createRef(),this.etRef=r.a.createRef(),this.fileToEditorMap={}}render(){return r.a.createElement("div",{className:"ws-app"},r.a.createElement("div",{className:"ws-left-pane"},r.a.createElement(Ke.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},r.a.createElement(Fn,{ref:e=>this.leftTreePaneRef=e,parent:this}))),r.a.createElement("div",{className:"ws-right-pane"},r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(Ma,{ref:this.etRef,parent:this})),r.a.createElement($t,{ref:this.editorGroup,parent:this}),this.tableAndDash()))}}var qn=Mn,Vn=a(1128);class Bn{constructor(e){this.superclass=e}with(...e){return e.reduce((e,t)=>t(e),this.superclass)}}var Gn=e=>new Bn(e);const Un=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.toggleNewSession=()=>{this.setState({showNewSession:!this.state.showNewSession})},this.showNewSession=e=>{if(!e.node.props.table)return;const t={table:e.node.props.table,db:e.node.props.db};this.setState({showNewSession:!0,currentTable:t})},this.currentTableName=()=>this.state.currentTable?this.state.currentTable.db+"."+this.state.currentTable.table:"",this.showTable=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({showNewSession:!1}),n=t.state.currentTable,r=n.db,s=n.table,t.workshop.newSession(a,r,s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},Jn=(qa.a.TreeNode,qa.a.DirectoryTree);class Hn extends(Gn(Qa).with(Un)){constructor(e){var t;super(e),t=this,this.showNewSession=e=>{const t={table:e.node.props.dataRef.path,db:""};this.setState({showNewSession:!0,currentTable:t})},this.showTable=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({showNewSession:!1}),s=t.state.currentTable,s.db,o=s.table,t.workshop.newSession(a,n,o,r);case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.render=()=>n.createElement("div",null,n.createElement(Ee.a,{title:"Open Table: [".concat(this.currentTableName(),"]?"),visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:()=>{this.showTable("file",this.loadPopRef.data.sourceTypeV,this.loadPopRef.data.params)},cancelText:"Cancel",OkText:"Ok"},n.createElement(ca,{key:this.currentTableName(),ignorePath:!0,ignoreTableName:!0,ref:e=>this.loadPopRef=e,parent:this})),n.createElement(Va.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Jn,{height:700,loadData:this.onLoadData,expandAction:"doubleClick",onRightClick:this.showNewSession},this.renderTreeNodes(this.state.root)))),this.workshop=e.parent.workshop}}const Kn=qa.a.TreeNode,Qn=qa.a.DirectoryTree;class Wn extends(Gn(Ja).with(Un)){constructor(e){super(e),this.tableClick=e=>{this.setState({rightClickNodeTreeItem:{pageX:e.event.pageX,pageY:e.event.pageY,table:e.node.props.table,db:e.node.props.db}})},this.workshop=e.parent.workshop}show(){return Object.entries(this.state.dbs).map(([e,t])=>n.createElement(Kn,{title:e,key:e},t.map(t=>n.createElement(Kn,{icon:n.createElement(Ba.a,null),title:t,table:t,db:e,key:"".concat(e,".").concat(t),isLeaf:!0}))))}render(){return n.createElement("div",null,n.createElement(Ee.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:()=>{this.showTable("delta")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Va.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Qn,{onRightClick:this.showNewSession},this.show())))}}const zn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e.tablesInWorkshop();case 2:if(200!==(a=e.sent).status){e.next=7;break}return n={},a.content.forEach(e=>{n[e.sessionId]?n[e.sessionId].push(e.tableName):n[e.sessionId]=[e.tableName]}),e.abrupt("return",{data:Object(y.a)({dbs:n},t.data)});case 7:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Yn=zn.handler,Xn=zn.action,$n=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.openTable,a.workshop.newSession("temp","",n),e.abrupt("return",{data:{}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Zn=$n.handler,er=$n.action,tr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.id,n=new d.ActionProxy,e.next=4,n.get(h.default.ANALYSIS_TABLE_DELETE,{tableName:a});case 4:return e.abrupt("return",{data:{reloading:ra.getJobName()}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ar=tr.handler,nr=tr.action,rr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,u,p,m,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.targetPath,r=a.workshop,s=t.__state.exportTable,o=s.name,c=s.type,e.next=5,r.buildLoadSQL("temp","",o);case 5:i=e.sent,u=i.sql,p=i.tableName,m=e=>{h.runScript("\n             ".concat(u,"\n             save ignore ").concat(p," as ").concat(e,".`").concat(n,"`;\n            "),ra.getJobName(),{async:!0})},h=new d.ActionProxy,e.t0=c,e.next="hive"===e.t0?13:"file"===e.t0?15:"delta"===e.t0?17:19;break;case 13:return m("hive"),e.abrupt("break",19);case 15:return m("parquet"),e.abrupt("break",19);case 17:return m("delta"),e.abrupt("break",19);case 19:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),sr=rr.handler,or=rr.action;class cr{}cr.LOAD="load",cr.OPEN="open",cr.DELETE="delete",cr.EXPORT_TO="exportTo";const lr=Object(y.a)(Object(y.a)({},en),{},{[cr.LOAD]:Yn,[cr.OPEN]:Zn,[cr.DELETE]:ar,[cr.EXPORT_TO]:sr}),ir=Object(y.a)(Object(y.a)({},tn),{},{[cr.LOAD]:Xn,[cr.OPEN]:er,[cr.DELETE]:nr,[cr.EXPORT_TO]:or});function ur(e,t){return ir[t.type](e,t.data)}var pr=a(1144),mr=a(1143),dr=a(1142);const hr=qa.a.TreeNode,br=qa.a.DirectoryTree,fr=N.a.SubMenu,Er={dbs:{},loading:!1,openTable:void 0,confirm:!1,reloading:void 0,exportTo:!1,exportTable:{name:void 0,type:void 0}},gr=r.a.createContext();function yr(e){const t=e.workshop,a=e.reload,s=Object(p.useReducerAsync)(ur,Er,lr),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.dbs,m=c.loading,d=c.openTable,h=c.confirm,b=c.reloading,f=c.exportTo,E=c.exportTable,g=Object(n.useRef)(),y=H.a.useForm(),v=Object(u.a)(y,1)[0],w=In({contextMenuRef:g,dispacher:l,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:a,dispacher:n})=>{const s=e.id;return r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(pr.a,null),onClick:()=>{n({type:cr.OPEN,data:{openTable:s,workshop:t}}),n({type:"setState",data:{confirm:!1}}),a(void 0)},key:1},"Open Table"),r.a.createElement(fr,{icon:r.a.createElement(mr.a,null),title:"Export"},r.a.createElement(N.a.Item,{icon:r.a.createElement(dr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"hive"},exportTo:!0,workshop:t}}),a(void 0)},key:1.1},"to Hive"),r.a.createElement(N.a.Item,{icon:r.a.createElement(dr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"delta"},exportTo:!0}}),a(void 0)},key:1.2},"to Delta"),r.a.createElement(N.a.Item,{icon:r.a.createElement(dr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"file"},exportTo:!0}}),a(void 0)},key:1.3},"to FileSystem")),r.a.createElement(N.a.Item,{onClick:()=>{n({type:cr.DELETE,data:{id:s}}),a(void 0)},key:2,icon:r.a.createElement(Xa.a,null)},"Delete"))}}),k=w.onRightClick,x=w.ui;return Object(n.useEffect)(()=>{l({type:"setState",data:{loading:!0}}),l({type:cr.LOAD,data:{loading:!1}})},[b,a]),r.a.createElement(gr.Provider,{value:{dispacher:l}},r.a.createElement(Ee.a,{title:"Export to ".concat(E.type),visible:f,onCancel:()=>{l({type:"setState",data:{exportTo:!1}})},onOk:()=>{const e=v.getFieldsValue().targetPath;v.resetFields(),l({type:cr.EXPORT_TO,data:{exportTo:!1,targetPath:e,workshop:t}})},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(H.a,{form:v},r.a.createElement(H.a.Item,{rules:[{required:!0,message:"Target is required."}],label:"Target",name:"targetPath"},r.a.createElement(K.a,null)))),r.a.createElement(Ee.a,{title:"Open Table",visible:h,onCancel:()=>{l({type:"setState",data:{confirm:!1}})},onOk:()=>{l({type:"dispatch",data:{openTable:d}})},cancelText:"Cancel",OkText:"Ok"},"Open ".concat(d,"?")),r.a.createElement(Va.a,{tip:"Loading...",spinning:m},x(),r.a.createElement(br,{height:700,onDoubleClick:(e,a)=>{l({type:cr.OPEN,data:{openTable:a.id,workshop:t}}),l({type:"setState",data:{confirm:!1}})},onRightClick:k},Object.entries(i).flatMap(([e,t])=>t.map(t=>r.a.createElement(hr,{icon:r.a.createElement(Ba.a,null),id:t,table:t,db:e,title:t,key:t,isLeaf:!0}))))))}const vr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,r,s,o,c,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,r=a.dbName,a.node,s=new d.ActionProxy,r){e.next=9;break}return e.next=5,s.runScript('!profiler sql "show databases";',ra.getJobName(),ra.robotFetchParam());case 5:if(200!==(o=e.sent).status){e.next=9;break}return c=o.content.data.map(e=>(e.key=e.databaseName||e.namespace,e.title=e.key,e.isLeaf=!1,e.children=[],e)),e.abrupt("return",{data:Object(y.a)({dbs:c},t.data)});case 9:if(!r){e.next=20;break}return e.next=12,s.runScript('!profiler sql "use '.concat(r,'";'),ra.getJobName(),ra.robotFetchParam());case 12:return e.next=14,s.runScript('!profiler sql "show tables";',ra.getJobName(),ra.robotFetchParam());case 14:if(200!==(o=e.sent).status){e.next=20;break}return i=o.content.data.filter(e=>(e.database||e.namespace)===r).map(e=>(e.key="".concat(r,".").concat(e.tableName),e.title=e.tableName,e.isLeaf=!0,e.icon=n.createElement(Ba.a,null),e)),c=t.__state.dbs,u=c.map(e=>(e.key===r&&(e.children=i),e)),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{dbs:u})});case 20:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),wr=vr.handler,kr=vr.action,xr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,p,m,d,h,b,f,E,g;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.openTable,r=a.workshop,s=a.partitionValues,o=a.partitionColumn,c=n.split("."),i=Object(u.a)(c,2),p=i[0],m=i[1],d=s.tableRandom,h=s.tableStart,b=s.tableEnd,f=o&&ra.getField(o),o&&d?(E=f+" in ("+d.map(e=>'"'.concat(ra.escapeQuote(e),'"')).join(",")+")",r.newSession("hive",p,m,{__where__:E})):o&&h&&b?(g="".concat(f," >= ").concat(ra.quote(h)," and ").concat(ra.quote(b)," >= ").concat(f,"  "),r.newSession("hive",p,m,{__where__:g})):r.newSession("hive",p,m),e.abrupt("return",{data:{}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Sr=xr.handler,Or=xr.action,jr=(e,t)=>e.map(e=>{const a=e.title.indexOf(t),n=e.title.substr(0,a),s=e.title.substr(a+t.length),o=a>-1?r.a.createElement("span",null,n,r.a.createElement("span",{className:"site-tree-search-value"},t),s):r.a.createElement("span",null,e.title);return e.children?Object(y.a)(Object(y.a)({},e),{},{title:o,children:jr(e.children,t)}):Object(y.a)(Object(y.a)({},e),{},{title:o})}),Cr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.dbs,n=t.data.searchValue){e.next=4;break}return e.abrupt("return",{data:{expandedKeys:[],search_dbs:a}});case 4:return r=[],s=a.flatMap(e=>{var t;const a=(null===(t=e.children)||void 0===t?void 0:t.map(t=>t.title.indexOf(n)>-1?e.key:null).filter(e=>e))||[];return e.title.indexOf(n)>-1&&r.push(e.key),a}),s=ra.distinct(s),o=jr(a,n).filter(e=>s.includes(e.key)||r.includes(e.key)),e.abrupt("return",{data:{expandedKeys:s,search_dbs:o}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Tr=Cr.handler,Nr=Cr.action;class _r{}_r.LOAD="load",_r.OPEN="open",_r.SEARCH="search";const Ir=Object(y.a)(Object(y.a)({},en),{},{[_r.LOAD]:wr,[_r.OPEN]:Sr,[_r.SEARCH]:Tr}),Pr=Object(y.a)(Object(y.a)({},tn),{},{[_r.LOAD]:kr,[_r.OPEN]:Or,[_r.SEARCH]:Nr});function Ar(e,t){return Pr[t.type](e,t.data)}qa.a.TreeNode;const Dr=qa.a.DirectoryTree,Rr={dbs:[],loading:!1,openTable:void 0,confirm:!1,reloading:void 0,expandedKeys:[]},Lr=r.a.createContext();function Fr(e){const t=Ul.workshop,a=e.reload,s=Object(p.useReducerAsync)(Ar,Rr,Ir),o=Object(u.a)(s,2),c=o[0],m=o[1],h=c.dbs,b=c.loading,f=c.openTable,E=c.confirm,g=c.reloading,y=c.search_dbs,v=c.expandedKeys,w=function(){const e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(!1),c=Object(u.a)(o,2),p=c[0],m=c[1],h=Object(n.useState)([]),b=Object(u.a)(h,2),f=b[0],E=b[1],g=Object(n.useState)(void 0),y=Object(u.a)(g,2),v=y[0],w=y[1],k=Object(n.useState)(void 0),x=Object(u.a)(k,2),S=x[0],O=x[1],j=Object(n.useState)(!1),C=Object(u.a)(j,2),T=C[0],N=C[1],I=H.a.useForm(),P=Object(u.a)(I,1)[0],A=new d.ActionProxy;Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return t=a.split("."),n=Object(u.a)(t,2),r=n[0],s=n[1],m(!0),e.next=6,A.runScript("!profiler sql 'show partitions ".concat(r,".").concat(s,"';"),ra.getJobName(),ra.robotFetchParam());case 6:200===(o=e.sent).status?(c=o.content.data.map(e=>{const t=e.partition.split("/")[0].split("="),a=Object(u.a)(t,2),n=a[0],r=a[1];return S||O(n),{column:n,value:r}}),E(c),N(!1),0===c.length&&N(!0)):(E([]),N(!0)),m(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[a]);const D=f.reverse().map(e=>r.a.createElement(ft.a.Option,{value:e.value},e.value));return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(Va.a,{spinning:p},v&&r.a.createElement(_.a,{style:{marginBottom:"30px"},type:"error",message:v}),T&&r.a.createElement(V.a,{id:"no_partition_msg"}),!T&&r.a.createElement(H.a,{form:P},r.a.createElement(H.a.Item,{name:"tableStart",label:r.a.createElement(V.a,{id:"table_start"})},r.a.createElement(ft.a,{showSearch:!0},D)),r.a.createElement(H.a.Item,{name:"tableEnd",label:r.a.createElement(V.a,{id:"table_end"})},r.a.createElement(ft.a,{showSearch:!0},D)),r.a.createElement(it.a,null),r.a.createElement(H.a.Item,{name:"tableRandom",label:r.a.createElement(V.a,{id:"table_random"})},r.a.createElement(ft.a,{mode:"tags"},D))))),form:P,setOpenTable:s,setError:w,partitionColumn:S,noPartition:T}}(),k=w.ui,x=w.form,S=w.setOpenTable,O=w.setError,j=w.partitionColumn,C=w.noPartition,T=Object(n.useRef)(),I=In({contextMenuRef:T,dispacher:m,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;return console.log(n),r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(pr.a,null),onClick:()=>{a({type:"setState",data:{confirm:!0,openTable:n}}),t(void 0)},key:1},"Open Table"))}}),P=I.onRightClick,A=I.ui;return Object(n.useEffect)(()=>{m({type:"setState",data:{loading:!0}}),m({type:_r.LOAD,data:{loading:!1}})},[g,a]),Object(n.useEffect)(()=>{S(f)},[S,f]),r.a.createElement(Lr.Provider,{value:{dispacher:m}},r.a.createElement(Ee.a,{title:r.a.createElement(V.a,{id:"analysis_range"}),visible:E,onCancel:()=>{m({type:"setState",data:{confirm:!1}}),x.resetFields()},onOk:()=>{const e=x.getFieldsValue();C||e.tableRandom||e.tableStart&&e.tableEnd?(m({type:_r.OPEN,data:{openTable:f,workshop:t,partitionValues:e,partitionColumn:j}}),m({type:"setState",data:{confirm:!1}}),x.resetFields()):O("Partitions is required.")},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(k,null)),r.a.createElement(Va.a,{tip:"Loading...",spinning:b},A(),r.a.createElement(K.a,{style:{marginBottom:8},placeholder:"Search",onChange:e=>{m({type:_r.SEARCH,data:{searchValue:e.target.value}})}}),r.a.createElement(Dr,{height:700,expandedKeys:v,treeData:y||h,loadData:function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m({type:"setState",data:{loading:!0}}),m({type:_r.LOAD,data:{dbName:t.key,node:t,loading:!1}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),expandAction:"click",onExpand:e=>{m({type:"setState",data:{expandedKeys:e}})},onDoubleClick:(e,t)=>{t.isLeaf&&m({type:"setState",data:{confirm:!0,openTable:t.key}})},onRightClick:({event:e,node:t})=>{t.isLeaf&&P({event:e,node:t})}})))}const Mr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,p,m,b,f,E,g,v,w,k,x;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.partitionValues,r=a.openTable,s=a.partitionNumValue,o=a.workshop,c=r.split("."),i=Object(u.a)(c,2),p=i[0],m=i[1],b=n.partitionColumn,f=n.lowerBound,E=n.upperBound,g=new d.ActionProxy,e.next=6,g.get(h.default.DS_MYSQL_CONNECT,{name:p});case 6:return v=e.sent,w=ra.getTempTableName(),k="",b&&(k='where partitionColumn="'.concat(b,'" \n        and lowerBound="').concat(f,'" \n        and upperBound="').concat(E,'"\n        and numPartitions="').concat(s,'"\n        ')),x="\n      ".concat(v.content.connect,"\n      load jdbc.`").concat(r,"` ").concat(k," as ").concat(w,";    \n    "),o.newSession("jdbc",p,m,{__sql__:x,__tableName__:w}),e.abrupt("return",{data:Object(y.a)({},t.data)});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qr=Mr.handler,Vr=Mr.action;class Br{}Br.OPEN="open";const Gr=Object(y.a)(Object(y.a)({},en),{},{[Br.OPEN]:qr}),Ur=Object(y.a)(Object(y.a)({},tn),{},{[Br.OPEN]:Vr});function Jr(e,t){return Ur[t.type](e,t.data)}var Hr=a(1116),Kr=a(1138);function Qr(e){const t=Object(n.useState)(e.initialValue||10),a=Object(u.a)(t,2),s=a[0],o=a[1];return{ui:()=>r.a.createElement(Zt.a,null,r.a.createElement(ea.a,{span:12},r.a.createElement(Hr.a,{min:e.min||10,max:e.max||300,onChange:e=>{o(e)},value:s})),r.a.createElement(ea.a,{span:4},r.a.createElement(Kr.a,{min:e.min||10,max:e.max||300,style:{margin:"0 16px"},value:s,onChange:e=>{o(e)}}))),value:s}}function Wr(){const e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(!1),c=Object(u.a)(o,2),p=c[0],m=(c[1],Object(n.useState)([])),b=Object(u.a)(m,2),f=b[0],E=b[1],g=Object(n.useState)(""),v=Object(u.a)(g,2),w=v[0],k=v[1],x=Object(n.useState)(""),S=Object(u.a)(x,2),O=S[0],j=S[1],C=H.a.useForm(),T=Object(u.a)(C,1)[0],N=new d.ActionProxy,I=Qr({initialValue:10,min:2,max:100}),P=I.ui,A=I.value;Object(n.useEffect)(()=>{if(a){const e=a.split("."),t=Object(u.a)(e,2),n=t[0],r=(t[1],ra.getTempTableName());(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.runScript("                \n                load jdbc.`".concat(a,"` as ").concat(r,";\n                !desc ").concat(r,";\n               "),ra.getJobName(),Object(y.a)(Object(y.a)({},ra.robotFetchParam()),{},{__connect__:n}));case 2:200===(t=e.sent).status?E(t.content.data):E([]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[a]),Object(n.useEffect)(()=>{if(O){(function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.split("."),n=Object(u.a)(t,2),r=n[0],s=n[1],e.next=3,N.get(h.default.DS_MYSQL_COLUMN_INFO,{dbName:r,tableName:s,columnName:O});case 3:200===(o=e.sent).status&&T.setFieldsValue({lowerBound:o.content.min,upperBound:o.content.max});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[O,a]);const D=f.filter(e=>"string"!==e.data_type).map(e=>r.a.createElement(ft.a.Option,{value:e.col_name},e.col_name));return{ui:()=>0===D.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(V.a,{id:"no_mysql_parallel"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(Va.a,{spinning:p},w&&r.a.createElement(_.a,{style:{marginBottom:"30px"},type:"error",message:w}),r.a.createElement(H.a,{form:T},r.a.createElement(H.a.Item,{name:"partitionColumn",label:r.a.createElement(V.a,{id:"partitionColumn"})},r.a.createElement(ft.a,{onChange:e=>{j(e)}},D)),r.a.createElement(H.a.Item,{name:"lowerBound",label:r.a.createElement(V.a,{id:"lowerBound"})},r.a.createElement(K.a,null)),r.a.createElement(it.a,null),r.a.createElement(H.a.Item,{name:"upperBound",label:r.a.createElement(V.a,{id:"upperBound"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"numPartitions",label:r.a.createElement(V.a,{id:"numPartitions"})},P())))),form:T,setOpenTable:s,setError:k,partitionNumValue:A}}const zr=qa.a.DirectoryTree,Yr={dbs:[],loading:!1,confirm:!1,openTable:void 0,error:void 0},Xr=r.a.createContext();function $r(){const e=Ul.workshop,t=Object(p.useReducerAsync)(Jr,Yr,Gr),a=Object(u.a)(t,2),s=a[0],o=a[1],c=s.dbs,m=s.loading,b=s.confirm,f=s.openTable,E=(s.error,Wr()),g=E.ui,y=E.form,v=E.setOpenTable,w=E.setError,k=E.partitionNumValue,x=Object(n.useRef)(),S=In({contextMenuRef:x,dispacher:o,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;return r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(pr.a,null),onClick:()=>{a({type:"setState",data:{confirm:!0,openTable:n}}),t(void 0)},key:1},"Open Table"))}}),O=S.onRightClick,j=S.ui;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o({type:"setState",data:{loading:!0}}),t=new d.ActionProxy,e.next=4,t.get(h.default.DS_MYSQL_DBS,{});case 4:200===(a=e.sent).status&&(n=a.content.data.map(e=>(e.key=e.name,e.title=e.name,e.isLeaf=!1,e.children=e.tables.map(t=>({id:"".concat(e.name,".").concat(t.name),key:"".concat(e.name,".").concat(t.name),title:t.name+(t.options.indexer?"(\u5df2\u88ab\u7d22\u5f15)":""),isLeaf:!0,icon:r.a.createElement(Ba.a,null)})),e)),o({type:"setState",data:{dbs:n}})),o({type:"setState",data:{loading:!1}});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(()=>{v(f)},[f,v]),r.a.createElement("div",{className:"leftview-box"},r.a.createElement(Xr.Provider,{value:{dispacher:o}},r.a.createElement(Ee.a,{title:r.a.createElement(V.a,{id:"mysql_parallel"}),visible:b,onCancel:()=>{o({type:"setState",data:{confirm:!1}}),y.resetFields()},onOk:()=>{const t=y.getFieldsValue(),a=t.partitionColumn,n=t.lowerBound,r=t.upperBound;!a||n&&(r||!k)?(o({type:Br.OPEN,data:{openTable:f,workshop:e,partitionValues:t,partitionNumValue:k}}),o({type:"setState",data:{confirm:!1}}),y.resetFields()):w("lowerBound/upperBound/partitionNumValue should not be empty.")},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(g,null)),r.a.createElement(Va.a,{tip:"Loading...",spinning:m},j(),r.a.createElement(zr,{height:700,treeData:c,expandAction:"click",onDoubleClick:(e,t)=>{t.isLeaf&&o({type:"setState",data:{confirm:!0,openTable:t.key}})},onRightClick:({event:e,node:t})=>{t.isLeaf&&O({event:e,node:t})}}))))}const Zr=we.a.TabPane;class es extends n.Component{constructor(e){super(e),this.workshop=e.parent,this.state={reloaWorkshop:void 0}}render(){return n.createElement(we.a,{defaultActiveKey:"1",onTabClick:e=>{"3"===e&&this.deltaLakeTreeRef&&this.deltaLakeTreeRef.reload(),"4"===e&&this.fileSystemTreeRef&&this.fileSystemTreeRef.reload()}},n.createElement(Zr,{tab:n.createElement(V.a,{id:"table_workshop"}),key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(yr,{reload:this.state.reloaWorkshop,workshop:this.workshop}))),n.createElement(Zr,{tab:n.createElement(V.a,{id:"hive"}),key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Fr,null))),n.createElement(Zr,{tab:n.createElement(V.a,{id:"delta_lake"}),key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Wn,{ref:e=>this.deltaLakeTreeRef=e,parent:this}))),n.createElement(Zr,{tab:n.createElement(V.a,{id:"file_system"}),key:"4"},n.createElement("div",{className:"leftview-box"},n.createElement(Hn,{ref:e=>this.fileSystemTreeRef=e,parent:this}))),n.createElement(Zr,{tab:n.createElement(V.a,{id:"mysql"}),key:"5"},n.createElement($r,null)))}}a(110);const ts=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.newSession=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r,s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.showTable(a,n,r,s),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.buildLoadSQL=function(){var e=Object(i.a)(l.a.mark((function e(t,a,n,r){var s,o,c,i,u,p,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=ra.getTempTableName(),"".concat(a,"."),a||"",o="where ",r?"where "===(o+=Object.keys(r).filter(e=>"__where__"!==e&&"__sql__"!==e&&"__tableName__"!==e).map(e=>{const t=r[e];return"".concat(e.replace(/\[group\]/g,"0"),"='''").concat(t,"'''")}).join(" and "))&&(o=""):o="",c="load ".concat(t,".`").concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";"),"delta"===t&&(c="load delta.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";")),"jdbc"===t&&(c=r.__sql__||"load jdbc.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";"),s=r.__tableName__||s),"temp"!==t){e.next=14;break}return e.next=11,$e.tableInfo(n);case 11:i=e.sent,u=i.content,c=200===u.status?"load parquet.`/__persisted__/".concat(u.tableName,"`  as ").concat(ra.getField(u.tableName),";\n                select * from ").concat(ra.getField(u.tableName)," as ").concat(s,";"):"".concat(u.content," \n                select * from ").concat(ra.getField(u.tableName)," as ").concat(s,";");case 14:return"file"===t&&(c="load ".concat(a,".`").concat(n,"` ").concat(o,"  as ").concat(s,";")),"hive"===t&&(p="where ",r&&r.__where__?p+=r.__where__:p="",m=ra.getTempTableName(),c="load hive.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(m,";"),c+="select * from ".concat(m," ").concat(p," as ").concat(s,";")),e.abrupt("return",{sql:c,tableName:s});case 17:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.showTable=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r,s){var o,c,i,u,p,m,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.sqls=[],e.next=3,t.buildLoadSQL(a,n,r,s);case 3:return o=e.sent,c=o.tableName,i=o.sql,t.sqls.push({tableName:c,sql:i}),t.setState({loadingTable:!0}),e.next=10,t.client.runScript(i,ra.getJobName(),ra.robotFetchParam());case 10:if(u=e.sent,t.setState({loadingTable:!1}),200===u.status){e.next=15;break}return t.toggleMessage("Fail to load ".concat(c,": ").concat(u.content)),e.abrupt("return");case 15:p=u.content,m=p.schema,d=p.data,t.setCurrentTable("","",c,m,d),t.sessionId=ra.getJobName(),t.setState({sessionId:t.sessionId});case 19:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.setCurrentTable=(e,t,a,n,r)=>{this.currentTable={prefix:e,db:t,table:a,schema:n,data:r},this.updateDisplay(r,n)}}},as=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.getLastApplyTable=()=>this.sqls[this.sqls.length-1],this.rollback=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.sqls.length<2)){e.next=3;break}return t.toggleMessage("No apply to rollback."),e.abrupt("return");case 3:return t.sqls.pop(),n=t.sqls.pop(),e.next=7,t.client.get(h.default.APPLY_GET,{name:n.tableName});case 7:if(200!==(r=e.sent).status){e.next=14;break}return s=JSON.parse(r.content.response),o=s.data,c=s.schema,e.next=12,t.apply(Object(y.a)(Object(y.a)({},n),{},{_data:o,_schema:c}));case 12:e.next=16;break;case 14:return e.next=16,t.apply(n);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.runSQLAtCurrentTable=function(){var e=Object(i.a)(l.a.mark((function e(a,n){var r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sqls.map(e=>e.sql).join(""),e.next=3,t.client.runScript("".concat(r,"\n          ").concat(a),ra.getJobName(),Object(y.a)(Object(y.a)({},ra.robotFetchParam()),n));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.apply=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s,o,c,i,u,p,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.tableName,r=a.sql,s=a._data,o=a._schema,t.sqls.push({tableName:n,sql:r}),!s||!o){e.next=5;break}return t.setCurrentTable("","",n,o,s),e.abrupt("return",200);case 5:return c=t.sqls.map(e=>e.sql).join(""),e.prev=6,e.next=9,t.client.runScript(c,ra.getJobName(),Object(y.a)(Object(y.a)({},ra.robotFetchParam()),{},{queryType:"analysis_workshop_apply_action",analysis_workshop_table_name:n,analysis_workshop_sql:JSON.stringify(t.sqls)}));case 9:if(200===(i=e.sent).status){e.next=14;break}return t.sqls.pop(),t.toggleMessage(i.content),e.abrupt("return",500);case 14:return u=i.content,p=u.data,m=u.schema,t.setCurrentTable("","",n,m,p),e.abrupt("return",200);case 19:return e.prev=19,e.t0=e.catch(6),t.toggleMessage("Execute job fail;(Job is killed)"),e.abrupt("return",500);case 23:case"end":return e.stop()}}),e,null,[[6,19]])})));return function(t){return e.apply(this,arguments)}}(),this.save=function(){var e=Object(i.a)(l.a.mark((function e(a,n){var r,s,o,c,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.sqls.length){e.next=3;break}return t.toggleMessage("Sorry, current session have no applies."),e.abrupt("return",500);case 3:if(r="select * from ".concat(ra.getField(t.getLastApplyTable().tableName)," as ").concat(ra.getField(a),";"),t.sqls.push({tableName:a,sql:r}),s=t.sqls.map(e=>e.sql).join("\n"),o=ra.getJobName(),c={status:5},!n){e.next=13;break}return i="".concat(s,"\n         save overwrite ").concat(a," as parquet.`/__persisted__/").concat(a,"`;"),e.next=12,t.client.runScript(i,o,{persistJobName:o,async:!0});case 12:c={jobName:o,status:1};case 13:return e.next=15,t.client.post(h.default.ANALYSIS_SAVE,Object.assign({tableName:a,sql:s,sessionId:t.sessionId,schema:JSON.stringify(t.currentTable.schema)},c));case 15:return u=e.sent,e.abrupt("return",u.status);case 17:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}};a(1038);var ns=a(1117),rs=a(1113);a(1039);N.a.SubMenu;class ss extends n.Component{constructor(e){super(e),this.enter=()=>{this.setState({applyLoading:!0}),this.workshop.setState({tableLoading:!0})},this.exit=()=>{this.setState({applyLoading:!1}),this.workshop.setState({tableLoading:!1})},this.showSaveDiagram=()=>{this.toggle()},this.toggle=()=>{this.setState({saveDiagram:!this.state.saveDiagram})},this.handleTableInput=()=>{},this.handlePersit=()=>{},this.props=e,this.state={applyLoading:!1,saveDiagram:!1},this.workshop=e.parent.workshop}render(){return n.createElement("div",{style:this.props.style,className:this.props.className||"aos-box"},n.createElement(Ee.a,{title:"View",visible:this.state.saveDiagram,onCancel:this.toggle,onOk:this.props.onSave,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(H.a,{className:"login-form"},n.createElement(H.a.Item,null,n.createElement(K.a,{addonBefore:"tableName",onChange:this.props.handleTableInput||this.handleTableInput,placeholder:""})),n.createElement(H.a.Item,{label:"Persist table(take more space):"},n.createElement(rs.a,{onChange:this.props.handlePersit||this.handlePersit})))),n.createElement("div",{className:"aos-button"},n.createElement(Q.a,{loading:this.state.applyLoading,onClick:this.props.onApply,type:"primary"},"Apply")),n.createElement("div",{className:"aos-button"},n.createElement(Q.a,{disabled:this.state.applyLoading,onClick:this.toggle,type:"primary"},"Save As")),n.createElement("div",{className:"aos-button"},n.createElement(Q.a,{disabled:this.state.applyLoading,onClick:this.props.onRollback},"Rollback")))}}const os=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.onSave=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.workshop.save(t.tableNameForSave,t.persistForSave);case 2:200===e.sent&&(t.workshop.refreshOperateStation(),t.workshop.refreshTableWorkshop());case 4:case"end":return e.stop()}}),e)}))),this.onRollback=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ApplyOrSaveRef.enter(),e.next=3,t.workshop.rollback();case 3:200===e.sent&&(t.workshop.refreshOperateStation(),t.workshop.refreshTableWorkshop()),t.ApplyOrSaveRef.exit();case 6:case"end":return e.stop()}}),e)}))),this.handleTableInput=e=>{this.tableNameForSave=e.target.value},this.handlePersit=e=>{this.persistForSave=e}}};a(455);const cs=ft.a.Option;class ls extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.joinStation.joinInfo.currentTable.schema,e.next=3,$e.tableInfo(t.joinTable);case 3:200===(n=e.sent).status&&t.setState({currentTableFields:a.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.next=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,e),this.joinStation.next()},this.render=()=>n.createElement(H.a,{className:"login-form",onFinish:this.next},n.createElement(H.a.Item,{name:"leftField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(ft.a,{label:"Current Table",showSearch:!0,style:{width:200},placeholder:this.currentTable,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.currentTableFields.map(e=>n.createElement(cs,{key:e.name,value:e.name},e.name)))),n.createElement(H.a.Item,{name:"rightField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(ft.a,{label:"Join Table",showSearch:!0,style:{width:200},placeholder:this.joinTable,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.joinTableFields.map(e=>n.createElement(cs,{key:e.name,value:e.name},e.name)))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Next"))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.currentTable=this.joinStation.joinInfo.currentTable.table,this.joinTable=this.joinStation.joinInfo.joinTable,this.state={currentTableFields:[],joinTableFields:[]}}}var is=a(1125);class us extends n.Component{constructor(e){super(e),this.filterOption=(e,t)=>t.title.indexOf(e)>-1,this.handleChange=e=>{this.setState({targetKeys:e}),this.props.handleChange&&this.props.handleChange({targetKeys:e})},this.getSelectFields=()=>this.state.targetKeys||[],this.workshop=e.parent.workshop,this.state=this.wow(e)}wow(e){return{data:e.schemaFields.map(e=>({title:e.name,key:e.name})),targetKeys:[]}}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)))}render(){return n.createElement("div",{style:{marginBottom:"30px"}},n.createElement(is.a,{listStyle:{width:400,height:300},dataSource:this.state.data,showSearch:!0,filterOption:this.filterOption,targetKeys:this.state.targetKeys,onChange:this.handleChange,render:e=>e.title}))}}class ps extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.joinStation.joinInfo.currentTable.schema,e.next=3,$e.tableInfo(t.joinTable);case 3:200===(n=e.sent).status&&t.setState({currentTableFields:a.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.handleLeft=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,{leftProjectFields:e.targetKeys})},this.handleRight=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,{rightProjectFields:e.targetKeys})},this.reset=()=>{this.joinStation.parent.reload()},this.render=()=>n.createElement(H.a,{labelCol:{span:6}},n.createElement(H.a.Item,{name:"leftProjectFields",label:"currentTable"},n.createElement(us,{handleChange:this.handleLeft,schemaFields:this.state.currentTableFields,ref:e=>this.leftProjectFields=e,parent:this})),n.createElement(H.a.Item,{name:"rightProjectFields",label:this.joinTable+""},n.createElement(us,{handleChange:this.handleRight,schemaFields:this.state.joinTableFields,ref:e=>this.rightProjectFields=e,parent:this})),n.createElement(H.a.Item,null,n.createElement(H.a.Item,null," ",n.createElement(Q.a,{danger:!0},"Reset")))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.currentTable=this.joinStation.joinInfo.currentTable.table,this.joinTable=this.joinStation.joinInfo.joinTable,this.state={currentTableFields:[],joinTableFields:[]}}}const ms=ft.a.Option;class ds extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e.tablesInWorkshop();case 2:a=e.sent,n=[],200===a.status&&(n=a.content.map(e=>({name:e.tableName,value:e.tableName}))),t.setState({tables:n});case 6:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.next=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,e),this.joinStation.next()},this.render=()=>n.createElement(H.a,{className:"login-form",onFinish:this.next},n.createElement(H.a.Item,{name:"joinType",rules:[{required:!0,message:"Please select join type!"}]},n.createElement(ft.a,{showSearch:!0,style:{width:200},placeholder:"Select Join Type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ms,{key:"inner",value:"inner join"},"Inner Join"),n.createElement(ms,{key:"left",value:"left join"},"Left Join"),n.createElement(ms,{key:"right",value:"right join"},"Right Join"),n.createElement(ms,{key:"full",value:"full join"},"Full Join"))),n.createElement(H.a.Item,{name:"joinTable",rules:[{required:!0,message:"Please select join table!"}]},n.createElement(ft.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.tables.map(e=>n.createElement(ms,{key:e.name,value:e.value},e.name)))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Next"))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.state={tables:[]}}}function hs(){const e=Object(ne.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\ntext-align: center;\npadding-top: 80px;\nwidth: 100%;\n"]);return hs=function(){return e},e}const bs=ns.a.Step,fs=re.a.div(hs());class Es extends(Gn(n.Component).with(os)){constructor(e){var t;super(e),t=this,this.onApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o,c,i,u,p,m,d,h,b,f,E,g,y,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.workshop.currentTable.table,n=t.joinInfo,r=n.joinTable,s=n.joinType,o=n.leftField,c=n.rightField,i=n.leftProjectFields,u=n.rightProjectFields,i||u){e.next=5;break}return t.workshop.toggleMessage("Fields are not selected."),e.abrupt("return");case 5:return t.ApplyOrSaveRef.enter(),e.next=8,$e.tableInfo(r);case 8:return p=e.sent,m=p.content,d=i&&i.map(e=>"".concat(a,".`").concat(e,"`")).join(","),h=u&&u.map(e=>"".concat(r,".`").concat(e,"`")).join(","),b="".concat(a,".`").concat(o,"`"),f="".concat(r,".`").concat(c,"`"),E="".concat(s," ").concat(r," on ").concat(b," = ").concat(f),g="",d&&h&&(g=d+","+h),d&&!h&&(g=d),!d&&h&&(g=h),y=ra.getTempTableName(),v="".concat(m.content," \n select ").concat(g," from ").concat(a," ").concat(E," as ").concat(y,";"),console.log(v),e.next=24,t.workshop.apply({tableName:y,sql:v});case 24:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 26:case"end":return e.stop()}}),e)}))),this.next=()=>{this.setState({currentStep:this.state.currentStep+1})},this.preview=()=>{this.setState({currentStep:this.state.currentStep-1})},this.workshop=e.parent.workshop,this.joinInfo={currentTable:this.workshop.currentTable},this.state={currentStep:0,steps:[n.createElement(ds,{parent:this}),n.createElement(ls,{parent:this}),n.createElement(ps,{parent:this})]}}render(){return n.createElement("div",{className:"join-app"},n.createElement("div",{className:"station-menu"},n.createElement(ss,{parent:this,onRollback:this.onRollback,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}})),n.createElement("div",null,n.createElement(ns.a,{current:this.state.currentStep},n.createElement(bs,{key:0,title:"Table",description:"Choose the table you wanna join from workshop"}),n.createElement(bs,{key:1,title:"Join Condition ",description:"Choose the join condition in both tables"}),n.createElement(bs,{key:2,title:"Fields",description:"Choose the fields you want from both tables"}))),n.createElement("div",{className:"join-app-form"}," ",n.createElement(fs,null,this.state.steps[this.state.currentStep])))}}var gs=Es;const ys=a(212);class vs extends n.Component{constructor(e){super(e),this.setRender=(e,t)=>{const a=t[0][e.key];if(this.config&&this.config.render)Object.keys(this.config).map(t=>{const a=this.config[t][e.key];a&&(e[t]=a)});else{try{if(n.Component.isPrototypeOf(a.type))return void(e.render=e=>n.createElement("span",null,e))}catch(r){}"html"!=e.key?"object"!==typeof a?"array"!==typeof a?"boolean"!==typeof a?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300)):e.render=e=>n.createElement("pre",null,e.substring(0,300))}},this.update=(e,t)=>{this.config=t;let a=[],n={},r=[];const s=this;e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),this.setState({columns:a,data:r})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1}},this.config={},this.workshop=e.parent}render(){return n.createElement("div",{style:this.tableStyle},n.createElement(fe.a,{pagination:{pageSize:6},size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(Ee.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(ys,{source:this.state.view.content||""})))}}const ws=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.enableGroupByField=(e,t)=>{const a=t.field;e?this.groupByFields.push(a):this.groupByFields=this.groupByFields.filter(e=>e.name!==a)},this.generateProjectField=(e,t)=>{this.aggFields.push({name:e,newName:t})},this.onApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ApplyOrSaveRef.enter(),a=ra.getTempTableName(),n=t.aggFields.map(e=>"".concat(e.name," as `").concat(e.newName,"`")),r="",0!==t.groupByFields.length&&(r="group by ".concat(t.groupByFields.map(e=>"`".concat(e,"`")).join(",")),n=t.groupByFields.map(e=>"`".concat(e,"`")).concat(n)),s="select ".concat(n.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," ").concat(r," as ").concat(a,";"),e.next=8,t.workshop.apply({tableName:a,sql:s});case 8:o=e.sent,t.ApplyOrSaveRef.exit(),200===o&&t.workshop.refreshOperateStation();case 11:case"end":return e.stop()}}),e)})))}};var ks=a(1141);ft.a.Option;class xs extends n.Component{constructor(e){super(e),this.show=e=>{this.setState({func:e})},this.funcValue=()=>n.createElement(ks.b.Item,{key:"Func"},n.createElement(ks.b.Item.Meta,{title:"Func",description:this.state.func.funcValue.extra.zhDoc})),this.returnValue=()=>n.createElement(ks.b.Item,{key:"Return value"},n.createElement(ks.b.Item.Meta,{title:"Return value",description:this.state.func.returnValue.extra.zhDoc})),this.parameters=()=>this.state.func.params.map(e=>n.createElement(ks.b.Item,{key:e.name},n.createElement(ks.b.Item.Meta,{title:e.name,description:e.extra.zhDoc}))),this.state=Object(y.a)({},e)}render(){return this.state.func?n.createElement(ks.b,{size:"large",header:n.createElement("div",null,"Function [".concat(this.state.func.value,"] Info")),footer:n.createElement("div",null),bordered:!0},this.funcValue(),this.returnValue(),this.parameters()):n.createElement("div",null)}}const Ss=ft.a.Option;class Os extends n.Component{constructor(e){var t;super(e),t=this,this.handleSearch=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return e.next=3,$e.showFunctions();case 3:n=e.sent,r=n.content.map(e=>({value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)})),t.setState({data:r}),e.next=9;break;case 8:t.setState({data:[]});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleChange=e=>{const t=this.state.data.filter(t=>t.value===e)[0];this.setState({currentFunc:t}),this.funcDescRef.show(t)},this.handleOperateInput=e=>{this.manuallyTransform=e.target.value},this.isAggChecked=e=>{this.manuallyIsAgg=e},this.handleNewName=e=>{this.newFuncName=e.target.value},this.handleField=e=>{const t=e.target.getAttribute("name");this.funcParams[t]=e.target.value},this.showColumn=e=>(this.funcParams[e.name]=this.operateField,"yes"===e.extra.column?this.operateField:""),this.getTransform=()=>{if(this.manuallyTransform)return{field:this.operateField,isAgg:this.manuallyIsAgg,transformCode:this.manuallyTransform,columnName:this.newFuncName};const e=[];this.state.currentFunc.params.forEach(t=>{const a=this.funcParams[t.name];a&&("yes"===t.extra.column?e.push(ra.getField(a)):"number"==t.dataType||"boolean"==t.dataType?e.push(a):e.push('"'.concat(a,'"')))});return{field:this.operateField,isAgg:"yes"===this.state.currentFunc.funcValue.extra.agg,transformCode:"".concat(this.state.currentFunc.value,"(").concat(e.join(","),")"),columnName:this.newFuncName}},this.reload=()=>{this.setState({key:Math.random(),data:[],value:void 0,funcPopUp:!1,currentFunc:void 0}),this.collect={}},this.parent=e.parent,this.operateField=e.operateField,this.funcParams={},this.state={data:[],value:void 0,funcPopUp:!1,func:{},key:Math.random()}}render(){const e=this.state.data.map(e=>n.createElement(Ss,{key:e.value},e.text));return n.createElement(H.a,{className:"login-form",key:this.state.key},n.createElement(H.a.Item,null,n.createElement(ft.a,{showSearch:!0,value:this.state.value,placeholder:"Search function",defaultActiveFirstOption:!1,showArrow:!1,style:{width:"200px"},filterOption:!1,onSearch:this.handleSearch,onChange:this.handleChange,notFoundContent:"type function name"},e)),n.createElement(H.a.Item,null,n.createElement(xs,{ref:e=>this.funcDescRef=e})),this.state.currentFunc?this.state.currentFunc.params.map(e=>n.createElement(H.a.Item,{key:e.name},n.createElement(K.a,{name:e.name,onChange:this.handleField,addonBefore:e.name,defaultValue:this.showColumn(e)}))):n.createElement("div",null),n.createElement(H.a.Item,null,n.createElement(K.a,{addonBefore:"Mannual Transform",onChange:this.handleOperateInput,placeholder:""})),n.createElement(H.a.Item,{label:"Is Agg Function"},n.createElement(rs.a,{onChange:this.isAggChecked})),n.createElement(H.a.Item,null,n.createElement(K.a,{addonBefore:"New fieldName",onChange:this.handleNewName,placeholder:""})))}}N.a.SubMenu;class js extends(Gn(n.Component).with(os,ws)){constructor(e){super(e),this.showAggFuncsAndApply=e=>{this.operateField=e.field,this.setState({funcPopUp:!0})},this.reload=()=>{const e=this.workshop.currentTable.schema.fields.map(e=>({field:e.name,groupby:"",agg:""})),t={render:{groupby:(e,t)=>n.createElement(rs.a,{key:t.field,defaultChecked:t._groupBy,onChange:e=>{this.enableGroupByField(e,t),t._groupBy=e},dataref:t}),agg:(e,t)=>n.createElement(n.Fragment,null,n.createElement(Q.a,{key:t.field,style:{marginRight:"30px"},dataref:t,onClick:()=>{this.showAggFuncsAndApply(t)}},"Choose function"),n.createElement("span",null,t._agg&&"(".concat(t._agg,")")||""))}};this.columnsRef.update(e,t)},this.handleFunc=()=>{this.applyFuncToFieldRef.operateField=this.operateField;const e=this.applyFuncToFieldRef.getTransform(),t=e.field,a=e.transformCode,n=e.columnName;this.columnsRef.state.data.filter(e=>e.field===t)[0]._agg="".concat(a," as ").concat(n),this.generateProjectField(a,n),this.setState({funcPopUp:!1}),this.applyFuncToFieldRef.reload()},this.workshop=e.parent.workshop,this.state={funcPopUp:!1},this.groupByFields=[],this.aggFields=[]}componentDidMount(){this.reload()}render(){return n.createElement("div",null,n.createElement("div",null,n.createElement(Ee.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:()=>{this.setState({funcPopUp:!1}),this.applyFuncToFieldRef.setState({key:Math.random()})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(Os,{parent:this,ref:e=>this.applyFuncToFieldRef=e,operateField:this.operateField})),n.createElement("div",{className:"station-menu"},n.createElement(ss,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}}))),n.createElement("div",null,n.createElement(vs,{parent:this,ref:e=>this.columnsRef=e})))}}a(456);class Cs extends n.Component{constructor(e){super(e),this.getSelectFields=()=>this.formRef.getFieldValue(),this.workshop=e.parent.workshop,this.state=this.wow(e)}wow(e){return{data:e.schemaFields.map(e=>({title:e.name,key:e.name})),targetKeys:[]}}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)))}render(){return n.createElement(H.a,{labelCol:{span:6},ref:e=>{this.formRef=e}},this.state.data.map(e=>n.createElement(H.a.Item,{key:e.key,name:e.key,label:e.key,value:e.key},n.createElement(K.a,{placeholder:"input the new name here"}))))}}class Ts extends n.Component{constructor(e){super(e),this.wow=e=>({funcPopUp:!1,data:e.schemaFields.map(e=>({field:e.name,func:"",transformCode:"",columnName:""})),config:{render:{func:(e,t)=>n.createElement(Q.a,{key:t.field,dataref:t,onClick:()=>{this.showAggFuncsAndApply(t)}},"Choose function"),transformCode:(e,t)=>e,columnName:(e,t)=>e}}}),this.showAggFuncsAndApply=e=>{this.operateField=e.field,this.setState({funcPopUp:!0})},this.reload=()=>{this.columnsRef.update(this.state.data,this.state.config)},this.handleFunc=()=>{this.applyFuncToFieldRef.operateField=this.operateField;const e=this.applyFuncToFieldRef.getTransform(),t=e.field,a=e.transformCode,n=e.columnName,r=e.isAgg;if(!n)return void this.setState({error:"New fieldName is required."});const s=this.state.data.map(e=>e.field===t?{field:t,func:"",transformCode:a,columnName:n,isAgg:r}:e);this.setState({funcPopUp:!1,data:s,error:void 0},()=>{this.reload()}),this.applyFuncToFieldRef.reload()},this.getSelectFields=()=>this.state.data,this.render=()=>n.createElement("div",null,n.createElement(Ee.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:()=>{this.applyFuncToFieldRef.reload(),this.setState({funcPopUp:!1,error:void 0})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},this.state.error&&n.createElement(ce,{message:this.state.error}),n.createElement(Os,{parent:this,ref:e=>this.applyFuncToFieldRef=e,operateField:this.operateField})),n.createElement(vs,{ref:e=>this.columnsRef=e})),this.workshop=e.parent.workshop,this.state=this.wow(e)}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)),()=>{this.reload()})}componentDidMount(){this.reload()}}const Ns=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.onSelectApply=Object(i.a)(l.a.mark((function e(){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),0!==(a=t.selectFieldsRef.getSelectFields().map(e=>"`".concat(e,"`"))).length){e.next=6;break}return t.workshop.showInfo("No fields are selected."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=ra.getTempTableName(),r="select ".concat(a.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(n,";"),e.next=10,t.workshop.apply({tableName:n,sql:r});case 10:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 12:case"end":return e.stop()}}),e)}))),this.onFuncApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),0!==(a=t.functionFieldRef.getSelectFields()).length){e.next=6;break}return t.workshop.toggleMessage("No fields are renamed."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=a.filter(e=>e.isAgg).length>0,r=[],r=n?a.filter(e=>e.isAgg).map(e=>"".concat(e.transformCode," as `").concat(e.columnName,"`")):a.map(e=>e.transformCode?"".concat(e.transformCode," as `").concat(e.columnName,"`"):"`".concat(e.field,"` as `").concat(e.field,"`")),s=ra.getTempTableName(),o="select ".concat(r.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(s,";"),e.next=13,t.workshop.apply({tableName:s,sql:o});case 13:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 15:case"end":return e.stop()}}),e)}))),this.onRenameApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),a=t.renameFieldsRef.getSelectFields(),n=t.workshop.currentTable.schema.fields.map(e=>"`".concat(e.name,"`")),0!==a.length){e.next=7;break}return t.workshop.toggleMessage("No fields are renamed."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 7:return r=Object.keys(a).filter(e=>e!==a[e]).map(e=>"`".concat(e,"` as `").concat(a[e],"`")),s=ra.getTempTableName(),o="select ".concat(n.concat(r).join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(s,";"),e.next=12,t.workshop.apply({tableName:s,sql:o});case 12:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 14:case"end":return e.stop()}}),e)})))}},_s=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields,n=t.__state.operateFileds.filter(e=>a!==e.field),e.abrupt("return",{data:{operateFileds:n}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Is=_s.handler,Ps=_s.action,As=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields.map(e=>({field:e})),e.abrupt("return",{data:{operateFileds:a}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ds=As.handler,Rs=As.action;var Ls=class{static apply(e,t,a){return Object(i.a)(l.a.mark((function n(){var r,s,o,c,i,u,p,m;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.data,s=r.workshop,o=r.values,c=e.__state.applySaveRollbackDispacher,!(i=t(o))){n.next=6;break}return c({type:"setState",data:{loading:!1}}),n.abrupt("return",{data:Object(y.a)(Object(y.a)({},e.data),{},{error:i,loading:!1})});case 6:return u=a(s,o),p=u.tableName,m=u.sql,n.next=9,s.apply({tableName:p,sql:m});case 9:return 200===n.sent&&s.refreshOperateStation(),c({type:"setState",data:{loading:!1}}),n.abrupt("return",{data:Object(y.a)(Object(y.a)({},e.data),{},{loading:!1})});case 13:case"end":return n.stop()}}),n)})))()}};const Fs=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ls.apply(t,e=>{if(0===Object.keys(e).length)return"Please configure cast fields then click apply"},(e,t)=>{const a=ra.getTempTableName(),n=Object.keys(t).map(e=>"cast(".concat(ra.getField(e)," as ").concat(t[e],") as ").concat(ra.getField(e))),r=Object.keys(t),s=e.currentTable.schema.fields.filter(e=>!r.includes(e.name)).map(e=>ra.getField(e.name)),o=n.concat(s).join(",");return{tableName:a,sql:"select ".concat(o," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ms=Fs.handler,qs=Fs.action;class Vs{}Vs.ADD_FIELD="addField",Vs.REMOVE_FIELD="removeField";const Bs=Object(y.a)(Object(y.a)({},en),{},{[Vs.ADD_FIELD]:Ds,[Vs.REMOVE_FIELD]:Is,apply:Ms}),Gs=Object(y.a)(Object(y.a)({},tn),{},{[Vs.ADD_FIELD]:Rs,[Vs.REMOVE_FIELD]:Ps,apply:qs});function Us(e,t){return Gs[t.type](e,t.data)}const Js=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.workshop,e.next=3,a.rollback();case 3:return e.abrupt("return",{data:t.data});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Hs=Js.handler,Ks=Js.action,Qs=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data.workshop,n=t.__state,r=n.saveTablePersisted,s=n.saveTableName){e.next=4;break}return e.abrupt("return",{data:{error:"table name is required"}});case 4:return e.next=6,a.save(s,r);case 6:return a.refreshTableWorkshop(),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{loading:!1})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ws=Qs.handler,zs=Qs.action;const Ys={setState:O.SetStateActionHandler,rollback:Hs,save:Ws};function Xs(e,t){switch(t.type){case"setState":return Object(O.SetStateAction)(e,t.data);case"rollback":return Ks(e,t.data);case"save":return zs(e,t.data);default:return e}}const $s={saveDiagram:!1,saveTablePersisted:!1,loading:!1,saveTableName:void 0,error:void 0},Zs=r.a.createContext();function eo(e){const t=e.workshop||Ul.workshop,a=Object(n.useContext)(e.context).dispacher,s=Object(p.useReducerAsync)(Xs,$s,Ys),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.saveDiagram,m=(c.saveTablePersisted,c.loading),d=c.error;return r.a.createElement(Zs.Provider,{value:{dispacher:l}},d&&r.a.createElement(ce,{message:d}),r.a.createElement(Ee.a,{title:"View",visible:i,onCancel:()=>{l({type:"setState",data:{saveDiagram:!1}})},onOk:()=>{l({type:"save",data:{saveDiagram:!1,workshop:t}})},cancelText:"Cancel",width:"50%",OkText:"Ok"},r.a.createElement(H.a,{className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(K.a,{addonBefore:"tableName",onChange:e=>{l({type:"setState",data:{saveTableName:e.target.value}})},placeholder:""})),r.a.createElement(H.a.Item,{label:"Persist table(take more space):"},r.a.createElement(rs.a,{onChange:e=>{l({type:"setState",data:{saveTablePersisted:e}})}})))),r.a.createElement(Q.a,{loading:m,type:"primary",onClick:()=>{l({type:"setState",data:{loading:!0}}),a({type:"setState",data:{applySaveRollbackDispacher:l,applyToken:ra.getJobName()}})}},"Apply"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{disabled:m,onClick:()=>{l({type:"setState",data:{saveDiagram:!0}})}},"Save As"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{disabled:m,onClick:()=>{l({type:"setState",data:{loading:!0}}),l({type:"rollback",data:{workshop:t,loading:!1}})}},"Rollback"))}const to=ft.a.Option,ao={error:void 0,applySaveRollbackDispacher:void 0,operateFileds:[]},no=r.a.createContext();function ro(e){const t=e.workshop,a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=t.currentTable.schema.fields,c=Object(p.useReducerAsync)(Us,ao,Bs),l=Object(u.a)(c,2),i=l[0],m=l[1],d=i.operateFileds,h=i.error,b=i.applySaveRollbackDispacher,f=o.map(e=>r.a.createElement(to,{key:e.name},e.name));return Object(n.useEffect)(()=>{b&&s.submit()},[b]),r.a.createElement(no.Provider,{value:{dispacher:m}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},h&&r.a.createElement(ce,{message:h}),r.a.createElement(H.a,{form:s,onFinish:e=>{m({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(eo,{context:no,workshop:t})),r.a.createElement(H.a.Item,{label:"Choose fields"},r.a.createElement(ft.a,{mode:"multiple",onDeselect:e=>{m({type:Vs.REMOVE_FIELD,data:{fields:e}})},onChange:e=>{m({type:Vs.ADD_FIELD,data:{fields:e}})}},f)),d.map(e=>r.a.createElement(H.a.Item,{key:e.field,label:"Cast ".concat(e.field," to"),name:e.field},r.a.createElement(ft.a,null,r.a.createElement(ft.a.Option,{value:"int"},"int"),r.a.createElement(ft.a.Option,{value:"long"},"long"),r.a.createElement(ft.a.Option,{value:"double"},"double"),r.a.createElement(ft.a.Option,{value:"string"},"string")))))))}class so{}so.ADD_FIELD="addField",so.REMOVE_FIELD="removeField",so.APPLY="apply",so.setState="setState";var oo=a(1140);const co=ft.a.Option;function lo(e){const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=e.context,o=e.keyPaths,c=Object(n.useContext)(s).dispacher;return Object(n.useEffect)(()=>{e.forms.push(a)},[]),r.a.createElement(H.a,{layout:"inline",form:a,style:{marginBottom:"30px"}},r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{danger:!0,icon:r.a.createElement(oo.a,null),onClick:()=>{c({type:so.REMOVE_FIELD,data:{form:a}})}})),r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"add"}),name:"path",style:{width:"300px"}},r.a.createElement(ft.a,null,o.map(e=>r.a.createElement(co,{key:e},e)))),r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"as"}),name:"column",style:{width:"100px"}},r.a.createElement(K.a,null)))}const io=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.__state,n=a.subFields,s=a.keyPaths,o=a.forms,n.push(r.a.createElement(lo,{key:ra.getJobName(),context:Oo,keyPaths:s,forms:o})),e.abrupt("return",{data:{subFields:n}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),uo=io.handler,po=io.action,mo=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.form,n=t.__state,r=n.forms,s=n.subFields,o=r.indexOf(a),r.splice(o,1),s.splice(o,1),e.abrupt("return",{data:{forms:r,subFields:s}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ho=mo.handler,bo=mo.action,fo=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ls.apply(t,e=>{const t=e.formValues;if(!e.operateFiled||0===t.length)return"Please configure fields then click apply"},(e,t)=>{const a=ra.getTempTableName(),n=t.formValues,r=t.operateFiled,s=n.map(e=>"get_json_object(".concat(ra.getField(r),',"').concat(e.path,'") as ').concat(ra.getField(e.column))).join(",");return{tableName:a,sql:"select *,".concat(s," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Eo=fo.handler,go=fo.action;const yo=Object(y.a)(Object(y.a)({},en),{},{[so.ADD_FIELD]:uo,[so.REMOVE_FIELD]:ho,[so.APPLY]:Eo}),vo=Object(y.a)(Object(y.a)({},tn),{},{[so.ADD_FIELD]:po,[so.REMOVE_FIELD]:bo,[so.APPLY]:go});function wo(e,t){return vo[t.type](e,t.data)}var ko=a(1139);const xo=ft.a.Option,So={error:void 0,applySaveRollbackDispacher:void 0,operateFiled:void 0,keyPaths:[],forms:[],subFields:[]},Oo=r.a.createContext();function jo(e){const t=Ul.workshop,a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=t.currentTable.schema.fields,c=t.currentTable.data.slice(0,10),l=Object(p.useReducerAsync)(wo,So,yo),i=Object(u.a)(l,2),m=i[0],d=i[1],h=m.operateFiled,b=(m.keyPaths,m.error),f=m.applySaveRollbackDispacher,E=m.forms,g=m.subFields,y=o.map(e=>r.a.createElement(xo,{key:e.name},e.name));Object(n.useEffect)(()=>{if(h){d({type:so.setState,data:{subFields:[],forms:[]}});const e=new Set,t=c.map(e=>{try{return JSON.parse(e[h])}catch(t){return}}).filter(e=>void 0!==e&&("object"===typeof e||"array"===typeof e));console.log(t),t.forEach(t=>{ra.keyPath("$",t,t=>{e.add(t)})}),d({type:so.setState,data:{keyPaths:[...e]}})}},[h]),Object(n.useEffect)(()=>{f&&s.submit()},[f]);Object(n.useCallback)(({workshop:e,values:t,forms:a})=>{console.log(t),console.log(a.map(e=>e.getFieldsValue())),f.dispacher({type:"setState",data:{loading:!1}})},[f]);return r.a.createElement(Oo.Provider,{value:{dispacher:d}},r.a.createElement("div",{style:{marginTop:"10px",width:"600px"}},b&&r.a.createElement(ce,{message:b}),r.a.createElement(H.a,{form:s,onFinish:e=>{const a=E.map(e=>e.getFieldsValue());d({type:"apply",data:{workshop:t,values:{formValues:a,operateFiled:h}}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(eo,{context:Oo,workshop:t})),r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"choose_json_field"}),style:{width:"300px"}},r.a.createElement(ft.a,{onChange:e=>{d({type:so.setState,data:{operateFiled:e}})}},y))),h&&r.a.createElement(J.a,{title:r.a.createElement(Q.a,{icon:r.a.createElement(ko.a,null),onClick:()=>{d({type:so.ADD_FIELD,data:{}})}})},g)))}const Co=we.a.TabPane;class To extends(Gn(n.Component).with(os,Ns)){constructor(e){super(e),this.workshop=e.parent.workshop}render(){return n.createElement("div",{className:"station-menu"},n.createElement(we.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(Co,{tab:n.createElement(V.a,{id:"select_columns"}),key:"1"},n.createElement(ss,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onSelectApply,style:{marginBottom:"30px"}}),n.createElement(us,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.selectFieldsRef=e,parent:this})),n.createElement(Co,{tab:n.createElement(V.a,{id:"rename_columns"}),key:"2"},n.createElement(ss,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onRenameApply,style:{marginBottom:"30px"}}),n.createElement(Cs,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.renameFieldsRef=e,parent:this})),n.createElement(Co,{tab:n.createElement(V.a,{id:"transform_columns"}),key:"3"},n.createElement(ss,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onFuncApply,style:{marginBottom:"30px"}}),n.createElement(Ts,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.functionFieldRef=e,parent:this})),n.createElement(Co,{tab:n.createElement(V.a,{id:"cast_columns_type"}),key:"4"},n.createElement(ro,{workshop:this.workshop})),n.createElement(Co,{tab:n.createElement(V.a,{id:"json_fields"}),key:"5"},n.createElement(jo,null))))}}const No={EQUAL:"=",NON_EQUAL:"!=",IN:"in",CONTAINS:"contains",STARTS_WITH:"startsWith",ENDS_WITH:"endsWith",LIKE:"like",IS_NULL:"is null",IS_NOT_NULL:"is not null",IS_EMPTY:"is empty",IS_NOT_EMPTY:"is not empty"};function _o(e){const t=e.record,a=e.workshop,s=Object(n.useState)(void 0),o=Object(u.a)(s,2),c=o[0],p=o[1],m=(t.dataType,t.field),d=Object(n.useState)([]),h=Object(u.a)(d,2),b=h[0],f=h[1],E=Object(n.useState)(!1),g=Object(u.a)(E,2),y=g[0],v=g[1],w=H.a.useForm(),k=Object(u.a)(w,1)[0];e.forms[m]=k;const x=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==b.length||"in"!==c){e.next=7;break}return v(!0),e.next=4,a.runSQLAtCurrentTable("select distinct(".concat(ra.getField(m),") as name \n            from ").concat(a.getLastApplyTable().tableName," \n            as ").concat(ra.getTempTableName(),";"),{outputSize:5e3,timeout:1e4});case 4:200===(t=e.sent).status&&f(t.content.data),v(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{x()},[c]);return r.a.createElement(H.a,{form:k,layout:"inline"},r.a.createElement(H.a.Item,{name:"compare",initialValue:t.compare},r.a.createElement(ft.a,{initialValue:"=",onChange:e=>{p(e),t.compare=e},placeholder:"compare",style:{width:"100px"}},r.a.createElement(ft.a.Option,{value:"="},"="),r.a.createElement(ft.a.Option,{value:"<"},"<"),r.a.createElement(ft.a.Option,{value:">"},">"),r.a.createElement(ft.a.Option,{value:">="},">="),r.a.createElement(ft.a.Option,{value:"<="},"<="),r.a.createElement(ft.a.Option,{value:"!="},"!="),r.a.createElement(ft.a.Option,{value:No.LIKE},"like"),r.a.createElement(ft.a.Option,{value:No.STARTS_WITH},"startsWith"),r.a.createElement(ft.a.Option,{value:No.ENDS_WITH},"endsWith"),r.a.createElement(ft.a.Option,{value:No.IN},"in"),r.a.createElement(ft.a.Option,{value:No.IS_NULL},"is null"),r.a.createElement(ft.a.Option,{value:No.IS_NOT_NULL},"is not null"),r.a.createElement(ft.a.Option,{value:No.IS_EMPTY},"is empty"),r.a.createElement(ft.a.Option,{value:No.IS_NOT_EMPTY},"is not empty"))),r.a.createElement(H.a.Item,{name:"condition",initialValue:t.condition,onChange:e=>{t.condition="string"!==typeof e?e.target.value:e}},(()=>{switch(c){case No.IS_NULL:case No.IS_NOT_NULL:return r.a.createElement(r.a.Fragment,null);case No.IN:return r.a.createElement(ft.a,{loading:y,mode:"tags",style:{width:"300px"}},b.map(e=>r.a.createElement(ft.a.Option,{key:e.name,value:e.name},e.name)));case No.LIKE:return r.a.createElement(r.a.Fragment,null,r.a.createElement(K.a,{style:{width:"100px"}}),r.a.createElement("span",null,"LIKE 'a%o' means Finds any values that start with 'a' and ends with 'o' "));default:return r.a.createElement(K.a,{style:{width:"100px"}})}})()))}class Io extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({funcPopUp:!1,data:e.map(e=>({key:e.name,field:e.name,dataType:e.type,compare:"=",condition:"",command:""})),columns:[{title:"field",dataIndex:"field"},{title:"dataType",dataIndex:"dataType",render:(e,t)=>{switch(typeof e){case"object":return n.createElement("span",null,e.type);default:return n.createElement("span",null,e)}}},{title:"",dataIndex:"compare",render:(e,t)=>n.createElement(_o,{forms:this.forms,record:t,workshop:this.workshop})}]}),this.buildSelectedRows=()=>{const e={};this.state.data.forEach(t=>{e[t.field]=t.dataType});const t=Object.entries(this.forms).map(([t,a])=>{const n=a.getFieldsValue(),r=n.compare,s=n.condition;return r?{field:t,compare:r,condition:s,dataType:e[t]}:{}});return this.selectedRowKeys?t.filter(e=>this.selectedRowKeys.includes(e.field)):[]},this.addGroup=e=>{const t=e.groupName,a=e.groupType;if(!t||!a)return void this.workshop.showInfo("Error: groupName and groupType is required.");if(!this.selectedRowKeys)return void this.workshop.showInfo("Please select fields");const n=this.buildSelectedRows();this.fitlerStation.conGroups[t]={groupName:t,groupType:a,tp:"basic",data:n},this.fitlerStation.applyGroup&&this.fitlerStation.applyGroup.reload({data:this.fitlerStation.conGroups}),this.fitlerStation.groupGroup&&this.fitlerStation.groupGroup.reload({data:this.fitlerStation.conGroups}),this.workshop.showInfo("Add successfully")},this.render=()=>{const e={onChange:(e,t)=>{this.selectedRowKeys=e},getCheckboxProps:e=>({name:e.field})};return n.createElement("div",{className:"common-one-hundred-percent-width common-column-layout"},n.createElement("div",{style:{marginRight:"30px",width:"80%"}},n.createElement(ss,{parent:this,onRollback:this.fitlerStation.onRollback,handlePersit:this.fitlerStation.handlePersit,handleTableInput:this.fitlerStation.handleTableInput,ref:e=>this.fitlerStation.ApplyOrSaveRef=e,onSave:this.fitlerStation.onSave,onApply:()=>{const e=this.buildSelectedRows();this.fitlerStation.onNonGroupFilterApply(e)},style:{marginBottom:"30px"}}),n.createElement(fe.a,{pagination:{pageSize:5,hideOnSinglePage:!0},rowSelection:Object(y.a)({type:"checkbox"},e),columns:this.state.columns,dataSource:this.state.data})),n.createElement(H.a,{onFinish:this.addGroup},n.createElement(H.a.Item,{name:"groupName",label:"Group Name"},n.createElement(K.a,null)),n.createElement(H.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(ft.a,null,n.createElement(ft.a.Option,{value:"and"},"and"),n.createElement(ft.a.Option,{value:"or"},"or"))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Add selected conditions to group"))))},this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e.schemaFields),this.forms={}}}class Po extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({funcPopUp:!1,data:Object.keys(e.data).map(e=>({groupName:e})).map(e=>({key:e.groupName,groupName:e.groupName})),columns:[{title:"groupName",dataIndex:"groupName"}]}),this.addGroup=e=>{const t=e.groupName,a=e.groupType;if(!t||!a)return void this.workshop.showInfo("Error: groupName and groupType is required.");const n=this.selectedRowKeys.map(e=>this.fitlerStation.conGroups[e]);this.fitlerStation.conGroups[t]={groupName:t,groupType:a,tp:"group",data:n},this.fitlerStation.applyGroup&&this.fitlerStation.applyGroup.reload({data:this.fitlerStation.conGroups}),this.fitlerStation.groupGroup&&this.fitlerStation.groupGroup.reload({data:this.fitlerStation.conGroups}),this.workshop.showInfo("Add successfully")},this.render=()=>{const e={onChange:(e,t)=>{this.selectedRowKeys=e},getCheckboxProps:e=>({name:e.title})};return n.createElement("div",null,n.createElement(H.a,{onFinish:this.addGroup},n.createElement(H.a.Item,{name:"groupName",label:"Group Name"},n.createElement(K.a,null)),n.createElement(H.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(ft.a,null,n.createElement(ft.a.Option,{value:"and"},"and"),n.createElement(ft.a.Option,{value:"or"},"or"))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Add selected"))),n.createElement(fe.a,{rowSelection:Object(y.a)({type:"checkbox"},e),columns:this.state.columns,dataSource:this.state.data}))},this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e)}}class Ao extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({data:Object.keys(e.data).map(e=>({groupName:e})).map(e=>({key:e.groupName,groupName:e.groupName})),refresh:Math.random()}),this.onChange=e=>{this.groupName=e},this.render=()=>n.createElement("div",null,n.createElement(H.a,{key:this.state.refresh},n.createElement(H.a.Item,{label:"Select group name to apply:"},n.createElement(ft.a,{onChange:this.onChange},this.state.data.map(e=>n.createElement(ft.a.Option,{key:e.key,value:e.groupName},e.groupName)))))),this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e)}}const Do=we.a.TabPane;class Ro extends(Gn(n.Component).with(os)){constructor(e){var t;super(e),t=this,this.onNonGroupFilterApply=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.length){e.next=3;break}return t.workshop.showInfo("Please select fields"),e.abrupt("return");case 3:return n=a.flatMap(e=>Ro.buildCondition([e])).join(" and "),t.ApplyOrSaveRef.enter(),r=ra.getTempTableName(),s="select * from ".concat(t.workshop.getLastApplyTable().tableName," \n        where ").concat(n,"\n        as ").concat(r,";"),e.next=9,t.workshop.apply({tableName:r,sql:s});case 9:t.ApplyOrSaveRef.exit();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onFilterApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){if("basic"===e.tp)return"and"===e.groupType?"(".concat(Ro.buildCondition(e.data).join(" and "),")"):"(".concat(Ro.buildCondition(e.data).join(" or "),")");if("and"===e.groupType){const t=e.data.flatMap(e=>r(e)).join(" and ");return"(".concat(t,")")}{const t=e.data.flatMap(e=>r(e));return"(".concat(t.join(" or "),")")}},a=t.applyGroup.groupName){e.next=5;break}return t.workshop.showInfo("Choose the group name to apply."),e.abrupt("return");case 5:return n=t.conGroups[a],s=r(n),t.ApplyOrSaveRef.enter(),o=ra.getTempTableName(),c="select * from ".concat(t.workshop.getLastApplyTable().tableName," \n        where ").concat(s,"\n        as ").concat(o,";"),e.next=12,t.workshop.apply({tableName:o,sql:c});case 12:t.ApplyOrSaveRef.exit();case 13:case"end":return e.stop()}}),e)}))),this.workshop=e.parent.workshop,this.conGroups={},this.currentConditions={}}render(){return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(we.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(Do,{tab:"Add Conditions to Group",key:"1"},n.createElement(Io,{ref:e=>this.compare=e,parent:this,schemaFields:this.workshop.currentTable.schema.fields})),n.createElement(Do,{tab:"Apply Group",key:"2"},n.createElement(ss,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onFilterApply,style:{marginBottom:"30px"}}),n.createElement(it.a,null),n.createElement(Ao,{ref:e=>this.applyGroup=e,parent:this,data:this.conGroups})),n.createElement(Do,{tab:"Add Groups to Group",key:"3"},n.createElement(Po,{ref:e=>this.groupGroup=e,parent:this,data:this.conGroups})))),n.createElement("div",null))}}Ro.buildCondition=e=>e.map(e=>(e=>{const t=e.field,a=e.dataType,n=e.compare,r=e.condition;if(n===No.IN){let e="";switch(a){case"integer":case"long":case"float":case"double":e=r.map(e=>e).join(",");break;default:e=r.map(e=>'"'.concat(ra.escapeQuote(e),'"')).join(",")}const s="(".concat(e,")");return"".concat(ra.getField(t)," ").concat(n," ").concat(s)}if(n===No.IS_NOT_NULL||n===No.IS_NULL)return"".concat(ra.getField(t)," ").concat(n);if(n===No.IS_EMPTY)return"".concat(ra.getField(t),' = ""');if(n===No.IS_NOT_EMPT)return"".concat(ra.getField(t),' != ""');if(n===No.LIKE)return"".concat(ra.getField(t),' like "').concat(ra.escapeQuote(r),'"');if(n===No.STARTS_WITH)return"".concat(ra.getField(t),' like "').concat(ra.escapeQuote(r),'%"');if(n===No.ENDS_WITH)return"".concat(ra.getField(t),' like "%').concat(ra.escapeQuote(r),'"');let s="";switch(a){case"string":s='"'.concat(ra.escapeQuote(r),'"');break;default:s=r}return"".concat(ra.getField(t)," ").concat(n," ").concat(s)})(e));const Lo=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ls.apply(t,e=>{if(0===Object.keys(e).length)return"Please configure order fields then click apply"},(e,t)=>{const a=ra.getTempTableName(),n=Object.keys(t).map(e=>" ".concat(ra.getField(e)," ").concat(t[e]," ")).join(",");return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            order by  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Fo=Lo.handler,Mo=Lo.action;class qo{}qo.ADD_FIELD="addField",qo.REMOVE_FIELD="removeField";const Vo={[qo.ADD_FIELD]:Ds,[qo.REMOVE_FIELD]:Is,setState:O.SetStateActionHandler,apply:Fo},Bo={[qo.ADD_FIELD]:Rs,[qo.REMOVE_FIELD]:Ps,setState:O.SetStateAction,apply:Mo};function Go(e,t){return Bo[t.type](e,t.data)}const Uo={operateFileds:[],error:void 0,applySaveRollbackDispacher:void 0},Jo=r.a.createContext(),Ho=ft.a.Option;function Ko(e){const t=e.parent.workshop,a=t.currentTable.schema.fields,s=Object(p.useReducerAsync)(Go,Uo,Vo),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.operateFileds,m=c.error,d=c.applySaveRollbackDispacher,h=H.a.useForm(),b=Object(u.a)(h,1)[0],f=a.map(e=>r.a.createElement(Ho,{key:e.name},e.name));return Object(n.useEffect)(()=>{d&&b.submit()},[d]),r.a.createElement(Jo.Provider,{value:{dispacher:l}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},m&&r.a.createElement(ce,{message:m}),r.a.createElement(H.a,{form:b,onFinish:e=>{l({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(eo,{context:Jo,workshop:t})),r.a.createElement(H.a.Item,{label:"Choose fields"},r.a.createElement(ft.a,{mode:"multiple",onDeselect:e=>{l({type:qo.REMOVE_FIELD,data:{fields:e}})},onChange:e=>{l({type:qo.ADD_FIELD,data:{fields:e}})}},f)),i.map(e=>r.a.createElement(H.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(ft.a,null,r.a.createElement(ft.a.Option,{value:"desc"},"desc"),r.a.createElement(ft.a.Option,{value:"asc"},"asc")))))))}const Qo=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ls.apply(t,e=>0==Object.keys(e).length?"Please configure limit size then click apply.":e.limitSize?void 0:"Please configure limit size then click apply.",(e,t)=>{const a=ra.getTempTableName(),n=t.limitSize;return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            limit  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Wo=Qo.handler,zo=Qo.action;const Yo=Object(y.a)(Object(y.a)({},en),{},{apply:Wo}),Xo=Object(y.a)(Object(y.a)({},tn),{},{apply:zo});function $o(e,t){return Xo[t.type](e,t.data)}const Zo={limitSize:void 0,error:void 0,applySaveRollbackDispacher:void 0},ec=r.a.createContext();function tc(e){const t=e.parent.workshop,a=Object(p.useReducerAsync)($o,Zo,Yo),s=Object(u.a)(a,2),o=s[0],c=s[1],l=(o.limitSize,o.error),i=o.applySaveRollbackDispacher,m=H.a.useForm(),d=Object(u.a)(m,1)[0];return Object(n.useEffect)(()=>{i&&d.submit()},[i]),r.a.createElement(ec.Provider,{value:{dispacher:c}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},l&&r.a.createElement(ce,{message:l}),r.a.createElement(H.a,{form:d,onFinish:e=>{c({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(eo,{context:ec,workshop:t})),r.a.createElement(H.a.Item,{name:"limitSize"},r.a.createElement(K.a,null)))))}const ac=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).groupFields=t.data.groupFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),nc=ac.handler,rc=ac.action,sc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).orderFields=t.data.orderFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),oc=sc.handler,cc=sc.action,lc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).rowWindows=t.data.rowWindows,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ic=lc.handler,uc=lc.action,pc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,u,p,m,d,h,b,f,E,g,y,v,w,k;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.result,n=a.groupFields,r=a.orderFields,s=a.rowWindows,o=t.data,c=o.workshop,i=o.functions,u=n.map(e=>ra.getField(e.field)).join(","),p=r.map(e=>"".concat(ra.getField(e.field)," ").concat(e.value)),m="",p.length>0&&(m="order by ".concat(p.join(","))),d=s.windowType,h=s.preceding,b=s.following,f="",E=h&&"".concat(h," PRECEDING")||"UNBOUNDED PRECEDING",g=b&&"".concat(b," FOLLOWING")||"UNBOUNDED FOLLOWING","UNBOUNDED PRECEDING"===E&&"UNBOUNDED FOLLOWING"===g&&(g="CURRENT ROW"),!d){e.next=19;break}e.t0=d,e.next="row window"===e.t0?15:"range window"===e.t0?17:19;break;case 15:return f="ROWS BETWEEN ".concat(E,"  and ").concat(g," "),e.abrupt("break",19);case 17:return f="RANGE BETWEEN ".concat(E,"  and ").concat(g," "),e.abrupt("break",19);case 19:return y=i.map(e=>{e.field,e.isAgg;const t=e.transformCode,a=e.columnName;return"".concat(t," over w as ").concat(a)}).join(","),v=c.currentTable.schema.fields.map(e=>ra.getField(e.name)).join(","),w=ra.getTempTableName(),k="\n     select ".concat(v,",").concat(y,"\n     from ").concat(c.getLastApplyTable().tableName," \n     window w as (\n         partition by ").concat(u," ").concat(m," ").concat(f,"\n     ) as ").concat(w,";\n    "),e.next=25,c.apply({tableName:w,sql:k});case 25:return c.refreshOperateStation(),e.abrupt("return",{data:{}});case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),mc=pc.handler,dc=pc.action;class hc{}hc.buildGroup="buildGroup",hc.buildOrder="buildOrder",hc.buildRowWindows="buildRowWindows",hc.apply="apply";const bc=Object(y.a)(Object(y.a)({},en),{},{[hc.buildGroup]:nc,[hc.buildOrder]:oc,[hc.buildRowWindows]:ic,apply:mc}),fc=Object(y.a)(Object(y.a)({},tn),{},{[hc.buildGroup]:rc,[hc.buildOrder]:cc,[hc.buildRowWindows]:uc,apply:dc});function Ec(e,t){return fc[t.type](e,t.data)}const gc=ft.a.Option;var yc=function(e){const t=e.workshop,a=(e.dispacher,e.context),s=e.enableApply,o=void 0!==s&&s,c=e.fieldWrapper,l=e.submit,i=e.selectFields,p=e.selectFieldsLabel,m=void 0===p?"Choose fields":p,d=e.selectFieldsMode,h=void 0===d?"multiple":d,b=i||t.currentTable.schema.fields,f=Object(n.useState)([]),E=Object(u.a)(f,2),g=E[0],y=E[1],v=Object(n.useState)(void 0),w=Object(u.a)(v,2),k=w[0],x=w[1],S=H.a.useForm(),O=Object(u.a)(S,1)[0],j=b.map(e=>r.a.createElement(gc,{key:e.name},e.name));return{ui:e=>r.a.createElement(H.a,{form:O,className:"login-form",onFinish:l},k&&r.a.createElement(ce,{onClose:()=>{x(void 0)},message:k}),o&&r.a.createElement(H.a.Item,null,r.a.createElement(eo,{context:a,workshop:t})),r.a.createElement(H.a.Item,{label:m,name:"selectFieldsName"},r.a.createElement(ft.a,{style:{minWidth:"200px"},mode:h,onDeselect:e=>{y(g.filter(t=>e!==t.field))},onChange:e=>{y("multiple"===h?e.map(e=>({field:e})):[{field:e}])}},j)),g.map(e=>c(e)),e),operateFields:g,form:O,setError:x}};function vc(e){const t=Object(n.useContext)(Nc).dispacher,a=yc({workshop:e.workshop,fieldWrapper:e=>r.a.createElement(r.a.Fragment,null)}),s=a.ui,o=a.operateFields,c=a.setError;return s([r.a.createElement(H.a.Item,{key:"button"},r.a.createElement(Q.a,{type:"primary",onClick:()=>{0!==o.length?t({type:hc.buildGroup,data:{groupFields:o}}):c("Fields are required.")}},"Next"))])}function wc(e){const t=Object(n.useContext)(Nc).dispacher,a=yc({workshop:e.workshop,fieldWrapper:e=>r.a.createElement(H.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(ft.a,null,r.a.createElement(ft.a.Option,{value:"desc"},"desc"),r.a.createElement(ft.a.Option,{value:"asc"},"asc")))}),s=a.ui,o=a.operateFields,c=(a.setError,a.form);return s([r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",onClick:()=>{const e=c.getFieldValue(),a=o.map(t=>({field:t.field,value:e[t.field]}));t({type:hc.buildOrder,data:{orderFields:a}})}},"Next"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{t({type:"setState",data:{current:0}})}},"Previous"))])}function kc(e){const t=Object(n.useContext)(Nc).dispacher,a=yc({workshop:e.workshop,fieldWrapper:e=>{switch(e.field){case"row window":case"range window":return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:"Preceding",name:"preceding"},r.a.createElement(K.a,{placeholder:"number"})),r.a.createElement(H.a.Item,{label:"Following",name:"following"},r.a.createElement(K.a,{placeholder:"number"})))}},selectFields:[{name:"row window"},{name:"range window"}],selectFieldsLabel:"Window Type",selectFieldsMode:"single"}),s=a.ui,o=(a.operateFields,a.setError,a.form);return s([r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",onClick:()=>{const e=o.getFieldValue().selectFieldsName,a=Object(y.a)(Object(y.a)({},o.getFieldValue()),{},{windowType:e});t({type:hc.buildRowWindows,data:{rowWindows:a}})}},"Next"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{t({type:"setState",data:{current:1}})}},"Previous"))])}const xc=ve.a.Panel;var Sc=a(1121);ve.a.Panel;function Oc(e){const t=e.workshop,a=Object(n.useContext)(Nc).dispacher,s=function(e){const t=e.operateField,a=Object(n.useState)([]),s=Object(u.a)(a,2),o=s[0],c=s[1],p=Object(n.useState)(void 0),m=Object(u.a)(p,2),d=m[0],h=m[1],b=H.a.useForm(),f=Object(u.a)(b,1)[0],E=Object(n.useState)(void 0),g=Object(u.a)(E,2),y=g[0],v=g[1],w=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e.showFunctions();case 2:t=e.sent,a=t.content.map(e=>({value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)})),c(a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{w()},[]);const k=Object(n.useCallback)(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=o.filter(e=>e.value===t)[0],h(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o]),x=e=>"yes"===e.extra.column?t:"";return{ui:(e,t)=>r.a.createElement(H.a,{form:f,className:"login-form"},y&&r.a.createElement(ce,{onClose:()=>{v(void 0)},message:y}),r.a.createElement(H.a.Item,{label:"Search function"},r.a.createElement(ft.a,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!0,style:{width:"200px"},filterOption:!0,onChange:k,notFoundContent:"type function name"},o.map(e=>r.a.createElement(ft.a.Option,{key:e.value},e.text)))),d&&r.a.createElement(H.a.Item,{key:d.value},r.a.createElement(xs,{func:d})),d&&d.params.map(e=>r.a.createElement(H.a.Item,{initialValue:x(e),key:e.name,name:e.name,label:e.name},r.a.createElement(K.a,null))),r.a.createElement(H.a.Item,null,r.a.createElement(ve.a,null,r.a.createElement(xc,{header:"Mannually Apply Function"},r.a.createElement(it.a,{type:"horizontal"}),r.a.createElement(H.a.Item,{name:"mannualTransform",label:"Mannual Transform"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"isMannualAgg",label:"Is Agg Function"},r.a.createElement(rs.a,null))))),t,r.a.createElement(H.a.Item,{name:"newFieldName",label:"New Field Name",required:!0},r.a.createElement(K.a,null)),e),form:f,getTransform:()=>{const e=f.getFieldValue(),a=e.mannualTransform,n=e.isMannualAgg,r=e.newFieldName;if(a)return{field:t,isAgg:n||!1,transformCode:a,columnName:r};if(!d)return v("Operate is required."),{};const s=[];d.params.forEach(e=>{let a=f.getFieldValue()[e.name];a||"yes"!==e.extra.column||(a=t),a&&("yes"===e.extra.column?s.push(ra.getField(a)):"number"==e.dataType||"boolean"==e.dataType?s.push(a):s.push('"'.concat(a,'"')))});return{field:t,isAgg:"yes"===d.funcValue.extra.agg,transformCode:"".concat(d.value,"(").concat(s.join(","),")"),columnName:r}},setError:v}}({operateField:""}),o=s.ui,c=s.form,p=s.getTransform,m=s.setError,d=Object(n.useState)(!1),h=Object(u.a)(d,2),b=h[0],f=h[1],E=Object(n.useState)([]),g=Object(u.a)(E,2),y=g[0],v=g[1];return r.a.createElement(r.a.Fragment,null,o([r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",loading:b,onClick:()=>{let e=[];if(0===y.length){const t=p(),a=t.field,n=t.isAgg,r=t.transformCode,s=t.columnName;if(e.push({field:a,isAgg:n,transformCode:r,columnName:s}),!s)return void m("New Field Name is required.")}else e=y;f(!0),a({type:hc.apply,data:{setLoading:f,workshop:t,functions:e}})}},"Apply"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{loading:b,onClick:()=>{const e=p(),t=e.field,a=e.isAgg,n=e.transformCode,r=e.columnName;r?(v(y.concat([{field:t,isAgg:a,transformCode:n,columnName:r}])),c.resetFields()):m("New Field Name is required.")}},"Add"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{a({type:"setState",data:{current:2}})}},"Previous"))]),y.length>0&&r.a.createElement(ks.b,{style:{width:"500px"},header:r.a.createElement("div",null,"Added Functions"),bordered:!0,dataSource:y.map(e=>"".concat(e.transformCode," as ").concat(e.columnName)),renderItem:e=>r.a.createElement(ks.b.Item,null,r.a.createElement(Sc.a.Text,{mark:!0},"Func")," ",e)}))}function jc(){const e=Object(ne.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\npadding: 30px 30px;\nwidth: 100%;\ndisplay:flex;\nalign-items:center;\njustify-content:center;\nflex-direction: column;\n"]);return jc=function(){return e},e}const Cc=ns.a.Step,Tc=re.a.div(jc()),Nc=r.a.createContext();function _c(e){const t=e.parent.workshop,a={steps:[r.a.createElement(vc,{workshop:t}),r.a.createElement(wc,{workshop:t}),r.a.createElement(kc,{workshop:t}),r.a.createElement(Oc,{workshop:t})],current:0,result:{groupFields:[],orderFields:[],rowWindows:[]}},n=Object(p.useReducerAsync)(Ec,a,bc),s=Object(u.a)(n,2),o=s[0],c=s[1],l=o.steps,i=o.current;return r.a.createElement(Nc.Provider,{value:{dispacher:c}},r.a.createElement("div",{className:"join-app"},r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ns.a,{current:i},r.a.createElement(Cc,{key:0,title:"Build Group",description:"Choose fields to group data"}),r.a.createElement(Cc,{key:1,title:"Setup Group Row Order",description:"Choose fields to order the data in group"}),r.a.createElement(Cc,{key:2,title:"Build Window",description:"Build window on every row of every group"}),r.a.createElement(Cc,{key:3,title:"Apply Function",description:"Apply functions to all windows we have created"}))),r.a.createElement("div",{className:"join-app-form"},r.a.createElement(Tc,null,l[i]," "))))}const Ic=Object(y.a)({},en),Pc=Object(y.a)({},tn);function Ac(e,t){return Pc[t.type](e,t.data)}a(1049);var Dc=a(514),Rc=a.n(Dc);a(1053);const Lc={applySaveRollbackDispacher:void 0,scriptContent:void 0,applyToken:ra.getJobName()},Fc=r.a.createContext();function Mc(e){const t=e.parent.workshop,a=Object(p.useReducerAsync)(Ac,Lc,Ic),s=Object(u.a)(a,2),o=s[0],c=s[1],m=function(e){const t=e.parent.workshop.currentTable.schema.fields.map(e=>e.name),a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=Object(n.useState)(),c=Object(u.a)(o,2),l=c[0],i=c[1],p=Object(n.useState)([]),m=Object(u.a)(p,2),d=m[0],h=m[1],b=t.map(e=>r.a.createElement(ft.a.Option,{value:e},e)),f=Object(n.useCallback)(e=>{e.forEach(e=>{"vType"===e.name[0]&&i(e.value)})},[]);return{ui:()=>r.a.createElement(J.a,{title:"Generic"},r.a.createElement(H.a,{form:s,onFieldsChange:f},r.a.createElement(H.a.Item,{label:"Visulizaiton Plugin",name:"vType"},r.a.createElement(ft.a,null,d.map(e=>r.a.createElement(ft.a.Option,{value:e},e)))),r.a.createElement(H.a.Item,{label:"X Column",name:"xColumn"},r.a.createElement(ft.a,null,b)),r.a.createElement(H.a.Item,{label:"Y Column",name:"yColumn"},r.a.createElement(ft.a,null,b)))),form:s,vType:l,setPlugins:h}}(e),b=m.ui,f=m.form,E=m.vType,g=m.setPlugins,y=function(e){const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),c=o[0],l=o[1],i=Object(n.useState)(),p=Object(u.a)(i,2),m=p[0],d=p[1];return{ui:()=>r.a.createElement(J.a,{title:"Plugin Parameters"},m&&r.a.createElement("div",{className:"image-wrapper",style:{width:"400px"}},r.a.createElement(Rc.a,{src:m})),r.a.createElement(H.a,{form:a},c.map(e=>r.a.createElement(H.a.Item,{key:e.key,name:e.key,label:e.option.label||e.key,initialValue:ra.unQuote(e.command)},r.a.createElement(K.a,null))))),form:a,setPluginConfigs:l,pluginConfigs:c,setImagePreview:d}}(),v=y.ui,w=y.form,k=y.setPluginConfigs,x=y.setImagePreview,S=new d.ActionProxy,O=o.applySaveRollbackDispacher,j=o.scriptContent,C=o.applyToken,T=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get(h.default.PLUGIN_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=t.content.map(e=>e.name),g(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E){e.next=14;break}return e.next=3,S.get(h.default.PLUGIN_GET,{pluginName:E});case 3:return t=e.sent,a=t.content.content,e.next=7,S.runScript(a,ra.getJobName(),{executeMode:"analyze"});case 7:if(200===(n=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:r=n.content.filter(e=>e.mode&&"defaultParam"===e.mode),c({type:"setState",data:{scriptContent:a}}),x(t.content.image),k(r);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{N()},[E]),Object(n.useEffect)(()=>{T()},[]);const _=function(){var e=Object(i.a)(l.a.mark((function e(){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O){e.next=8;break}return a=f.getFieldValue(),n=w.getFieldValue(),r=n.tableName||ra.getTempTableName(),s="\n             select ".concat(ra.getField(a.xColumn)," as x,").concat(ra.getField(a.yColumn)," as y \n             from ").concat(t.getLastApplyTable().tableName," as ").concat(r,";\n             ").concat(j,"\n            "),e.next=7,t.apply({tableName:r,sql:s});case 7:O({type:"setState",data:{loading:!1}});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{_()},[C]),r.a.createElement(Fc.Provider,{value:{dispacher:c}},r.a.createElement(eo,{workshop:t,context:Fc}),r.a.createElement("div",{className:"dash-station"},r.a.createElement("div",{className:"dash-station-data-page"},b()),r.a.createElement(it.a,{type:"vertical",style:{height:"300px"}}),r.a.createElement("div",{className:"dash-station-dash-page"},v())))}const qc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.data.apply)&&a(t.data),e.abrupt("return",{data:Object(y.a)({},t.data)});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Vc=qc.handler,Bc=qc.action,Gc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ls.apply(t,e=>{if(!e.unionTable)return"UnionTable is required."},(e,t)=>{const a=ra.getTempTableName();let n="union";t.duplicate&&(n="UNION ALL");return{tableName:a,sql:"\n            select * from ".concat(e.getLastApplyTable().tableName,"\n            ").concat(n,"\n            select * from ").concat(ra.getField(t.unionTable),"\n            as ").concat(a,";                         \n            ")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Uc=Gc.handler,Jc=Gc.action;class Hc{}Hc.UnionApply="UnionApply";const Kc=Object(y.a)(Object(y.a)({},en),{},{[so.APPLY]:Vc,[Hc.UnionApply]:Uc}),Qc=Object(y.a)(Object(y.a)({},tn),{},{[so.APPLY]:Bc,[Hc.UnionApply]:Jc});function Wc(e,t){return Qc[t.type](e,t.data)}const zc=ft.a.Option,Yc=()=>{const e=n.useState(Array()),t=Object(u.a)(e,2),a=t[0],r=t[1],s=H.a.useForm(),o=Object(u.a)(s,1)[0];n.useEffect(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e.tablesInWorkshop();case 2:200===(t=e.sent).status&&(a=t.content,r(a));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const c=a.map(e=>n.createElement(zc,{value:e.tableName},e.tableName));return{ui:()=>n.createElement(H.a,{form:o,className:"login-form"},n.createElement(H.a.Item,{label:n.createElement(V.a,{id:"union_table"}),name:"unionTable",rules:[{required:!0,message:"Please select union table!"}]},n.createElement(ft.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children"},c)),n.createElement(H.a.Item,{label:n.createElement(V.a,{id:"allow_duplicate"}),name:"duplicate",rules:[{required:!0,message:"Please select!"}]},n.createElement(ft.a,{style:{width:200}},n.createElement(zc,{value:"true"},"true"),n.createElement(zc,{value:"false"},"false")))),form:o}},Xc={applySaveRollbackDispacher:void 0,error:void 0},$c=r.a.createContext(null),Zc=e=>{const t=Object(p.useReducerAsync)(Wc,Xc,Kc),a=Object(u.a)(t,2),s=a[0],o=a[1],c=s.applySaveRollbackDispacher,l=(s.error,Yc()),i=l.ui,m=l.form;return Object(n.useEffect)(()=>{if(c){const e=m.getFieldsValue(),t=e.unionTable,a=e.duplicate;o({type:so.setState,data:{error:void 0}});const n={unionTable:t,duplicate:a};o({type:Hc.UnionApply,data:{workshop:Ul.workshop,values:n}})}},[c]),r.a.createElement($c.Provider,{value:{state:s,dispacher:o}},r.a.createElement("div",{style:{marginBottom:"30px"}},r.a.createElement(eo,{context:$c,workshop:Ul.workshop})),r.a.createElement(i,null))},el=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ls.apply(t,e=>{var t;return e.columnHeader&&e.columnLeft&&e.columnSum?(null===(t=e.sunFunc)||void 0===t?void 0:t.length)>0?void 0:"Agg funcs are required.":"Three columns are required."},(e,t)=>{const a=ra.getTempTableName();return{tableName:a,sql:"\n            run ".concat(e.getLastApplyTable().tableName,' as Pivot.`` where \n            columnLeft="').concat(t.columnLeft,'"\n            and columnHeader="').concat(t.columnHeader,'"\n            and columnSum="').concat(t.columnSum,'"\n            and sunFunc="').concat(t.sunFunc.map(e=>"".concat(e,"(").concat(ra.getField(t.columnSum),")")).join(","),'"\n            as ').concat(a,";                         \n            ")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),tl=el.handler,al=el.action;class nl{}nl.PivotApply="PivotApply";const rl=Object(y.a)(Object(y.a)({},en),{},{[so.APPLY]:Vc,[nl.PivotApply]:tl}),sl=Object(y.a)(Object(y.a)({},tn),{},{[so.APPLY]:Bc,[nl.PivotApply]:al});function ol(e,t){return sl[t.type](e,t.data)}a(1054);var cl=a(150),ll=a(114);const il=["avg","max","min","sum","count"],ul=ll.a.Group,pl={columnLeft:null,columnHeader:null,columnSum:null,applySaveRollbackDispacher:void 0,error:void 0},ml=r.a.createContext(null),dl=e=>{const t=Ul.workshop,a=t.currentTable.schema.fields.map(e=>e.name),s=Object(p.useReducerAsync)(ol,pl,rl),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.columnLeft,m=c.columnHeader,d=c.columnSum,h=c.applySaveRollbackDispacher,b=c.error,f=Object(n.useState)(null),E=Object(u.a)(f,2),g=(E[0],E[1]),y=Object(cl.c)({onDragStart:e=>{g(e)},onDragEnd:()=>{g(null)}}),v=Object(cl.d)({onDom:(e,t)=>{l({type:so.setState,data:{columnHeader:e}})}}),w=Object(u.a)(v,2),k=w[0],x=w[1].isHovering,S=Object(cl.d)({onDom:(e,t)=>{l({type:so.setState,data:{columnLeft:e}})}}),O=Object(u.a)(S,2),j=O[0],C=O[1].isHovering,T=Object(cl.d)({onDom:(e,t)=>{l({type:so.setState,data:{columnSum:e}})}}),N=Object(u.a)(T,2),_=N[0],I=N[1].isHovering,P=(e,t)=>e?r.a.createElement(V.a,{id:"drop_column"}):t||r.a.createElement(V.a,{id:"drag_column"});Object(n.useEffect)(()=>{if(h){l({type:so.setState,data:{error:void 0}});const e=R.getFieldsValue().aggs,a={columnHeader:m,columnSum:d,columnLeft:i,sunFunc:e};l({type:nl.PivotApply,data:{workshop:t,values:a}})}},[h]);const A=(()=>{const e=H.a.useForm(),t=Object(u.a)(e,1)[0];return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:t},r.a.createElement(H.a.Item,{name:"aggs"},r.a.createElement(ul,{options:il})))),form:t}})(),D=A.ui,R=A.form;return r.a.createElement(ml.Provider,{value:{state:c,dispacher:l}},b&&r.a.createElement(ce,{message:b}),r.a.createElement("div",{className:"pivot-station-commands"},r.a.createElement(eo,{context:ml,workshop:t})),r.a.createElement("div",{className:"pivot-station-app"},r.a.createElement("div",{className:"pivot-station-fields"},r.a.createElement(ks.b,{className:"pivot-station-fields-list",header:r.a.createElement(r.a.Fragment,null,r.a.createElement(K.a,{placeholder:"search"})),bordered:!0,dataSource:a,renderItem:e=>r.a.createElement(ks.b.Item,null,r.a.createElement("div",y(e),e))})),r.a.createElement("div",{className:"pivot-station-bigbox"},r.a.createElement("div",Object.assign({className:"pivot-station-left"},j),r.a.createElement("span",{className:"pivot-common-font"},r.a.createElement(V.a,{id:"column_left"})," "),r.a.createElement("br",null)," ",P(C,i)),r.a.createElement("div",{className:"pivot-station-body"},r.a.createElement("div",Object.assign({className:"pivot-station-header"},k),r.a.createElement("span",{className:"pivot-common-font"},r.a.createElement(V.a,{id:"column_header"}))," ",r.a.createElement("br",null),P(x,m)),r.a.createElement("div",Object.assign({className:"pivot-station-content"},_),r.a.createElement("span",{className:"pivot-common-font"},r.a.createElement(V.a,{id:"column_sum"}))," ",r.a.createElement("br",null)," ",P(I,d),r.a.createElement(it.a,null),D())))))};const hl=Object(y.a)(Object(y.a)({},en),{},{[so.APPLY]:Vc}),bl=Object(y.a)(Object(y.a)({},tn),{},{[so.APPLY]:Bc});function fl(e,t){return bl[t.type](e,t.data)}const El="input",gl="select";class yl{constructor(e){var t=this;this._sql=void 0,this.sqls=[],this.build=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.runScript(t._sql,ra.getJobName(),{executeMode:"analyze"});case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",t);case 6:return t.sqls=n.content,e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)}))),this.userInputs=()=>this.sqls.filter(e=>"defaultParam"===e.mode).map(e=>e),this.toSql=e=>{const t=Object.keys(e).map(t=>{const a=t,n=e[t];let r="'''".concat(n,"'''");return n||(r='""'),"set ".concat(a,"=").concat(r,";")});return"\n          ".concat(t.join("\n"),"\n          ").concat(this._sql,"\n        ")},this._sql=e}}const vl=e=>{const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)({}),b=Object(u.a)(m,2),f=b[0],E=(b[1],Object(n.useState)({})),g=Object(u.a)(E,2),v=g[0],w=g[1],k=Object(n.useRef)(null),x=new d.ActionProxy;Object(n.useEffect)(()=>{(function(){var t=Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.get(h.default.ANALYSIS_PLUGIN_GET,{name:e});case 2:if(200!==(a=t.sent).status){t.next=9;break}return r=a.content,t.next=7,new yl(r.content).build();case 7:k.current=t.sent,p(null===(n=k.current)||void 0===n?void 0:n.userInputs());case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},[]);const S=Object(n.useCallback)(e=>{(function(){var t=Object(i.a)(l.a.mark((function t(){var a,n,r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(v[e.name]&&Object.keys(v[e.name]).length>0)){t.next=2;break}return t.abrupt("return");case 2:if(!e.optionStr){t.next=5;break}return w({[e.name]:null===(a=e.optionSql)||void 0===a?void 0:a.split(",").map(e=>({name:e,value:e}))}),t.abrupt("return");case 5:if(n=ra.getTempTableName(),!e.optionTable){t.next=18;break}if("__current_table_fields__"!==e.optionTable){t.next=11;break}return r=Ul.workshop.currentTable.schema.fields.map(e=>({name:e.name,value:e.name})),w({[e.name]:r}),t.abrupt("return");case 11:return t.next=13,x.runScript("select * from ".concat(e.optionTable," as ").concat(n),ra.getJobName(),ra.robotFetchParam());case 13:return s=t.sent,r=[],200===s.status&&(r=s.content.data),w({[e.name]:r}),t.abrupt("return");case 18:if(!e.optionSql){t.next=26;break}return t.next=21,x.runScript("".concat(e.optionSql),ra.getJobName(),ra.robotFetchParam());case 21:return s=t.sent,r=[],200===s.status&&(r=s.content.data),w({[e.name]:r}),t.abrupt("return");case 26:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},[]),O=Object(n.useCallback)(e=>{let t=Object(y.a)(Object(y.a)({},e.option),{},{name:e.key});return{[El]:()=>r.a.createElement(H.a.Item,{required:t.required,name:t.name,key:t.name,initialValue:ra.unQuote(e.comamnd),label:t.label||t.name},r.a.createElement(K.a,null)),[gl]:()=>{var a;return r.a.createElement(H.a.Item,{required:t.required,name:t.name,key:t.name,initialValue:ra.unQuote(e.comamnd),label:t.label||t.name},r.a.createElement(ft.a,{showSearch:!0,onFocus:()=>{S(t)},loading:f[t.name]||!1,mode:t.selectMode},console.log(v),null===(a=v[t.name])||void 0===a?void 0:a.map(e=>r.a.createElement(ft.a.Option,{key:e.value,value:e.value},e.name))))}}[t.formType]()},[v]);return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:a},c.map(e=>O(e)))),form:a,analysisUtils:k}},wl=e=>{const t=vl(e.pluginName),a=t.ui,s=t.form,o=t.analysisUtils;return e.form.current=s,e.analysisUtils.current=o.current,Object(n.useEffect)(()=>{},[]),r.a.createElement(r.a.Fragment,null,a())};a(1056);const kl={plugins:[],pluginName:"",applySaveRollbackDispacher:void 0,applyToken:ra.getJobName()},xl=r.a.createContext(null),Sl=e=>{const t=Object(p.useReducerAsync)(fl,kl,hl),a=Object(u.a)(t,2),s=a[0],o=a[1],c=new d.ActionProxy,m=Object(n.useRef)(null),b=Object(n.useRef)(null),f=s.applySaveRollbackDispacher,E=s.pluginName,g=s.plugins,y=s.applyToken;Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(h.default.ANALYSIS_PLUGIN_LIST,{});case 2:200===(t=e.sent).status&&o({type:so.setState,data:{plugins:t.content}});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const v=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r,s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=13;break}return a=null===(t=m.current)||void 0===t?void 0:t.getFieldsValue(),n=b.current,r=null===n||void 0===n?void 0:n.toSql(a),s=Ul.workshop,o=s.getLastApplyTable().tableName,c=ra.getTempTableName(),i='\n      set __current_table__="'.concat(o,'";\n      set __new_table__="').concat(c,'";\n      ').concat(r,"\n      "),e.next=10,s.apply({tableName:c,sql:i});case 10:200===e.sent&&s.refreshOperateStation(),f({type:"setState",data:{loading:!1}});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{v()},[y]),r.a.createElement(xl.Provider,{value:{state:s,dispacher:o}},r.a.createElement(eo,{context:xl}),r.a.createElement("div",{className:"analysis-plugin-select"},r.a.createElement(ft.a,{showSearch:!0,onChange:e=>{o({type:so.setState,data:{pluginName:e}})},filterOption:!0,style:{width:"200px"}},g.map(e=>r.a.createElement(ft.a.Option,{key:e.name,value:e.name},e.name)))),r.a.createElement("div",{className:"analysis-plugin-form"},E&&r.a.createElement(wl,{analysisUtils:b,pluginName:E,form:m})))},Ol=we.a.TabPane;class jl extends n.Component{constructor(e){super(e),this.reload=()=>{this.setState({key:ra.getJobName()})},this.workshop=Ul.workshop,this.state={key:ra.getJobName()}}render(){return n.createElement("div",{className:"os-pane",style:{backgroundColor:"white"}},n.createElement("div",{className:"os-tabs"},n.createElement(Ke.Resizable,{style:{borderBottom:"solid",width:"100%",overflow:"scroll"}},n.createElement(we.a,{defaultActiveKey:"1",tabPosition:"left",key:this.state.key},n.createElement(Ol,{tab:n.createElement(V.a,{id:"project"}),key:1},n.createElement(To,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"filter"}),key:2},n.createElement(Ro,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"agg"}),key:4},n.createElement(js,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"order"}),key:5},n.createElement(Ko,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"pivot"}),key:10},n.createElement(dl,null)),n.createElement(Ol,{tab:n.createElement(V.a,{id:"more"}),key:100},n.createElement(we.a,{tabPosition:"left"},n.createElement(Ol,{tab:n.createElement(V.a,{id:"join"}),key:3},n.createElement(gs,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"limit"}),key:6},n.createElement(tc,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"window"}),key:7},n.createElement(_c,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"union"}),key:9},n.createElement(Zc,null)),n.createElement(Ol,{tab:n.createElement(V.a,{id:"dash"}),key:8},n.createElement(Mc,{parent:this})),n.createElement(Ol,{tab:n.createElement(V.a,{id:"plugin"}),key:11},n.createElement(Sl,null))))))))}}const Cl=e=>class extends e{constructor(...e){super(...e),this.toggleMessage=e=>{this.state.showMessage?this.setState({showMessage:!this.state.showMessage}):this.setState({showMessage:!this.state.showMessage,consoleMessage:e})},this.showInfo=e=>{this.setState({showInfoMessage:!0,infoMessage:e})}}},Tl=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.updateDisplay=function(){var e=Object(i.a)(l.a.mark((function e(a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({tableLoading:!0}),t.displayRef.update(a,n.fields),t.setState({tableLoading:!1});case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.refreshOperateStation=()=>{this.stationRef.setState({key:Math.random()})},this.refreshTableWorkshop=()=>{this.leftTreePaneRef.setState({reloaWorkshop:ra.getJobName()})}}};var Nl=a(516),_l=a.n(Nl),Il=a(1135);const Pl=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.getColumnSearchProps=e=>({filterDropdown:({setSelectedKeys:t,selectedKeys:a,confirm:r,clearFilters:s})=>n.createElement("div",{style:{padding:8}},n.createElement(K.a,{ref:e=>{this.searchInput=e},placeholder:"Search ".concat(e),value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>this.handleSearch(a,r,e),style:{width:188,marginBottom:8,display:"block"}}),n.createElement(_t.a,null,n.createElement(Q.a,{type:"primary",onClick:()=>this.handleSearch(a,r,e),icon:n.createElement(Il.a,null),size:"small",style:{width:90}},"Search"),n.createElement(Q.a,{onClick:()=>this.handleReset(s),size:"small",style:{width:90}},"Reset"))),filterIcon:e=>n.createElement(Il.a,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>!0,onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>this.searchInput.select())},render:t=>this.state.searchedColumn===e?n.createElement(_l.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[this.state.searchText],autoEscape:!0,textToHighlight:t?t.toString():""}):this.wrapper(t)}),this.handleSearch=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r){var s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=ra.getTempTableName(),o=a[0],c=ra.getField(r),i={tableName:s,sql:"select * from ".concat(t.workshop.getLastApplyTable().tableName," \n            where ").concat(c," like '%").concat(o,"%' as ").concat(s,";")},n(),t.setState({loading:!0}),e.next=8,t.workshop.apply(i);case 8:t.setState({loading:!1,searchText:a[0],searchedColumn:r});case 9:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.handleReset=e=>{e(),this.setState({searchText:""})}}};var Al=a(168),Dl=a(1155);const Rl=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.dropdownStat=function(){var e=Object(i.a)(l.a.mark((function e(a,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({loading:!0}),r=ra.getTempTableName(),e.t0=a,e.next="count"===e.t0?5:"count(distinct)"===e.t0?9:13;break;case 5:return e.next=7,t.workshop.apply({tableName:r,sql:"select count(".concat(ra.getField(n),") \n                    from ").concat(t.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 7:return t.setState({loading:!1}),e.abrupt("return");case 9:return e.next=11,t.workshop.apply({tableName:r,sql:"select count(distinct ".concat(ra.getField(n),") \n                    from ").concat(t.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 11:return t.setState({loading:!1}),e.abrupt("return");case 13:t.setState({loading:!1});case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.dropdown=e=>{const t=n.createElement(N.a,{onClick:t=>{this.dropdownStat(t.key,e.name)}},n.createElement(N.a.Item,{key:"count",icon:n.createElement(Dl.a,null)},"Count"),n.createElement(N.a.Item,{key:"count(distinct)",icon:n.createElement(Dl.a,null)},"Count&distinct"));return n.createElement(Al.a,{overlay:t},n.createElement("span",null,e.name,n.createElement(it.a,{type:"vertical"}),n.createElement($a.a,null)))}}};a(212);class Ll extends(Gn(n.Component).with(Pl,Rl)){constructor(e){super(e),this.wrapper=e=>n.createElement("div",{onDoubleClick:t=>{t.preventDefault(),t.stopPropagation(),this.setState({view:{enabled:!0,content:e}})}},e),this.getDefaultRender=e=>{e.name;const t=e.type;if("object"===typeof t||"array"===typeof t)return(e,t)=>{const a=JSON.stringify(e);return this.wrapper(a)};switch(t){case"string":return(e,t)=>this.wrapper(e);default:return(e,t)=>String(e)}},this.getDefaultSearch=e=>{const t=e.name;switch(e.type){case"string":return this.getColumnSearchProps(t);case"array":case"map":default:return{}}},this.getDefaultTitleRender=e=>this.dropdown(e),this.update=(e,t)=>{let a=!1;t[0]&&"html"===t[0].name&&t[1]&&"dash"===t[1].name&&(a=!0);const n=t.map(e=>Object(y.a)(Object(y.a)({},e),{},{dataIndex:e.name,title:this.getDefaultTitleRender(e),render:this.getDefaultRender(e),width:200,textWrap:"word-break",ellipsis:{showTitle:!0}},this.getDefaultSearch(e)));this.setState({columns:n,data:e,isDash:a})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1},searchText:"",searchedColumn:"",loading:!1,isDash:!1},this.config={},this.workshop=Ul.workshop}render(){return this.state.isDash?Qe.render(this.state.data):n.createElement("div",{style:this.tableStyle},n.createElement(fe.a,{loading:this.state.loading,size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:"max-content"}}),n.createElement(Ee.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(be.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.view.content||""})))}}var Fl=a(184),Ml=a(1160);function ql(){const e=Object(ne.a)(["\n      display:flex;\n      align-items:right;    \n    "]);return ql=function(){return e},e}function Vl(e){re.a.div(ql());const t=Object(Fl.b)();return r.a.createElement("div",{className:"common-one-hundred-percent-width"},r.a.createElement(ve.a,{style:{marginBottom:"10px"}},r.a.createElement(ve.a.Panel,{header:r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{icon:r.a.createElement(Ml.a,null),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.enter(e)}}),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(V.a,{id:"operate_panel"}))},r.a.createElement(Fl.a,{handle:t},r.a.createElement(jl,{ref:e=>Ul.workshop.stationRef=e})))))}function Bl(e){const t=Object(Fl.b)();return r.a.createElement(ve.a,{defaultActiveKey:"1",style:{marginBottom:"30px",width:"100%"}},r.a.createElement(ve.a.Panel,{key:"1",header:r.a.createElement(r.a.Fragment,null,Ul.workshop.sessionId&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{icon:r.a.createElement(Ml.a,null),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.enter(e)}}),r.a.createElement(it.a,{type:"vertical"})),r.a.createElement(V.a,{id:"data_panel"}))},r.a.createElement(Fl.a,{handle:t},r.a.createElement(Ll,{tableStyle:{width:"90%"},ref:e=>Ul.workshop.displayRef=e}))))}class Gl extends(Gn(n.Component).with(ts,as,Cl,Tl)){constructor(e){super(e),this.client=new d.ActionProxy,this.state={tableLoading:!1},this.sqls=[],Gl.workshop=this}componentDidMount(){}operateStationView(){return this.state.loadingTable?n.createElement(_n,null):this.sessionId?n.createElement(Vl,null):n.createElement(Vn.a,{style:{width:"100%"},title:"No Aanalysis Session Is Opened",subTitle:"Right click the table in the left panel(DeltaLake/FileSystem) to begin your analysis"})}render(){return n.createElement("div",{className:"ws-app"},n.createElement("div",{className:"ws-left-pane"},n.createElement(Ke.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},n.createElement(es,{ref:e=>this.leftTreePaneRef=e,parent:this}))),n.createElement("div",{className:"ws-right-pane"},n.createElement(Ee.a,{title:"Message",visible:this.state.showMessage||!1,onCancel:this.toggleMessage,onOk:this.toggleMessage,cancelText:"Cancel",width:"60%",OkText:"Ok"},n.createElement(be.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.consoleMessage||""})),n.createElement(Ee.a,{title:"Message",visible:this.state.showInfoMessage||!1,onCancel:()=>{this.setState({showInfoMessage:!1})},onOk:()=>{this.setState({showInfoMessage:!1})},cancelText:"Cancel",OkText:"Ok"},this.state.infoMessage),n.createElement("div",{className:"ws-operate-pane"},this.operateStationView()),n.createElement("div",{className:"ws-table-pane"},n.createElement(Bl,null))))}}Gl.workshop=void 0;var Ul=Gl;const Jl=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.enableRegister,r=a.enableLogin,s=a.enableConsole,o={},void 0!==n&&(o.register=n),void 0!==r&&(o.login=r),void 0!==s&&(o.console=s),c=new d.ActionProxy,e.next=8,c.post(h.default.APP_SAVE,o);case 8:if(200!==(i=e.sent).status){e.next=11;break}return e.abrupt("return",{data:{applySuccess:!0}});case 11:return e.abrupt("return",{data:{error:i.content}});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Hl=Jl.handler,Kl=Jl.action,Ql=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Wl=Ql.handler,zl=Ql.action;class Yl{}Yl.LR_CONTROL="lrControl",Yl.SET_STATE="setState";const Xl={[Yl.LR_CONTROL]:Hl,[Yl.SET_STATE]:Wl};function $l(e,t){switch(t.type){case Yl.LR_CONTROL:return Kl(e,t.data);case Yl.SET_STATE:return zl(e,t.data);default:return e}}a(457);var Zl=a(1146);const ei={enableLogin:!1,enableRegister:!1,enableConsole:!1,applySuccess:!1,error:void 0,loading:!0},ti=r.a.createContext();function ai(){const e=Object(p.useReducerAsync)($l,ei,Xl),t=Object(u.a)(e,2),a=t[0],s=t[1],o=w.formLayout1(),c=o.formItemLayout,b=o.tailLayout,f=a.enableLogin,E=a.enableRegister,g=a.enableConsole,y=a.applySuccess,v=a.error,k=a.loading;function x(){return(x=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.APP_INFO,{});case 3:200===(a=e.sent).status&&s({type:Yl.SET_STATE,data:{enableLogin:Boolean(a.content.login),enableRegister:Boolean(a.content.register),enableConsole:Boolean(a.content.console),loading:!1}});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(()=>{!function(){x.apply(this,arguments)}()},[y,v]),r.a.createElement(ti.Provider,{value:{dispacher:s}},y&&r.a.createElement(_.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),v&&r.a.createElement(_.a,{closable:!0,message:"Fail",description:v,type:"error",showIcon:!0}),k&&r.a.createElement(_n,null),!k&&r.a.createElement(J.a,{title:"Control Website Register/Login"},r.a.createElement(H.a,Object.assign({},c,{className:"login-form",onFinish:e=>{s(m.a.buildEvent(Yl.LR_CONTROL,e))}}),r.a.createElement(H.a.Item,{label:"Allow Register New User",name:"enableRegister"},r.a.createElement(rs.a,{defaultChecked:E,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,{label:"Allow User Login",name:"enableLogin"},r.a.createElement(rs.a,{defaultChecked:f,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,{label:"Enable Console(SQL)",name:"enableConsole"},r.a.createElement(rs.a,{defaultChecked:g,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,b,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Apply")))))}var ni=a(525);function ri(e){const t=e.renderConfig,a=e.createInitRow,s=e.submit,o=e.remove,c=H.a.useForm(),p=Object(u.a)(c,1)[0],m=Object(n.useState)([]),d=Object(u.a)(m,2),h=d[0],b=d[1],f=Object(n.useState)([]),E=Object(u.a)(f,2),g=E[0],y=E[1],v=Object(n.useState)({}),w=Object(u.a)(v,2),k=w[0],x=w[1],S=Object(n.useState)(!1),O=Object(u.a)(S,2),j=O[0],C=O[1],T=Object(n.useState)(!1),N=Object(u.a)(T,2),_=N[0],I=N[1],P=Object(n.useState)(void 0),A=Object(u.a)(P,2),D=A[0],R=A[1],L=Object(cl.e)(g),F=L.list,M=L.remove,q=L.getKey,V=L.move,B=L.push,G=(L.sortForm,L.resetList),U=p.getFieldsValue;Object(n.useEffect)(()=>{G(g)},[g]);const J=h.filter(e=>"id"!==e).map(e=>t&&t[e]?t[e]({getKey:q}):{title:e,dataIndex:e,key:e,render:(t,a,n)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(q(n),"].").concat(e),initialValue:t},r.a.createElement(K.a,{style:{width:120,marginRight:16}})))}).concat([{key:"operate",title:"",dataIndex:"operate",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(q(a),"].operate")},r.a.createElement(Q.a.Group,null,r.a.createElement(Q.a,{type:"danger",onClick:()=>{o&&o({row:t,setLoading:C}),M(a)}},"Delete"))))}]),W=Object(n.useCallback)(e=>{x(e);var t=/params\[(\d+)\]\.(\D+)/;(function(){var a=Object(i.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=[],Object.entries(e).map(([e,a])=>{const r=t.exec(e),s=Number(r[1]),o=r[2];n[s]||(n[s]={}),a&&(n[s][o]=a)}),s&&s({params:n,setLoading:C});case 3:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}})()()},[C]);return{ui:()=>{if(!_){const e=J.map(e=>(e.render=(e,t,a)=>r.a.createElement("span",null,e),e));return r.a.createElement(fe.a,{columns:e,dataSource:g,pagination:!1})}return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:p},r.a.createElement(ni.a,{onDragEnd:(e,t)=>V(e,t),handleSelector:'i[aria-label="icon: drag"]'},D&&r.a.createElement(ce,{message:D}),r.a.createElement(fe.a,{columns:J,dataSource:F,rowKey:(e,t)=>q(t).toString(),pagination:!1})),r.a.createElement(Q.a,{style:{marginTop:8},block:!0,type:"dashed",onClick:()=>B((()=>{if(a)return a(J);const e={};return J.map(t=>{e[t]=""}),e})())},"+ Add Row"),r.a.createElement(Q.a,{type:"primary",style:{marginTop:16},loading:j,onClick:()=>{W(U())}},"Submit"),e.debug&&r.a.createElement("div",{style:{whiteSpace:"pre"}},k&&"content: ".concat(JSON.stringify(k,null,2)))))},data:g,schema:h,setData:y,setSchema:b,setLoading:C,setEditorMode:I,setError:R}}function si(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],c=new d.ActionProxy,p=ri({remove:function(){var e=Object(i.a)(l.a.mark((function e({row:t,setLoading:a}){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),g(void 0),e.next=4,c.post(h.default.ENGINE_REMOVE,{id:t.id});case 4:if(200===(n=e.sent).status){e.next=9;break}return a(!1),g(n.content),e.abrupt("return");case 9:o(ra.getJobName()),a(!1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),submit:function(){var e=Object(i.a)(l.a.mark((function e({params:t,setLoading:a}){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(!0),g(void 0),n=0;case 3:if(!(n<t.length)){e.next=14;break}return e.next=6,c.post(h.default.ENGINE_ADD,t[n]);case 6:if(200===(r=e.sent).status){e.next=11;break}return a(!1),g(r.content),e.abrupt("return");case 11:n++,e.next=3;break;case 14:o(ra.getJobName()),a(!1);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{skipAuth:({getKey:e})=>({title:"skipAuth",dataIndex:"skipAuth",key:"skipAuth",render:(t,a,n)=>{let s=!0;return 2===t&&(s=!1),r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(e(n),"].skipAuth"),initialValue:String(s)},r.a.createElement(ft.a,null,r.a.createElement(ft.a.Option,{value:"true"},"true"),r.a.createElement(ft.a.Option,{value:"false"},"false"))))}})}}),m=p.ui,b=p.setData,f=p.setSchema,E=p.setEditorMode,g=p.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(h.default.ENGINE_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),b(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[s]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(rs.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{E(e)}}),r.a.createElement(it.a,{type:"horizontal"}),m())}var oi=function(){const e=Object(n.useState)(void 0),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(void 0),c=Object(u.a)(o,2),p=c[0],m=c[1],b=Object(n.useCallback)(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.password,a=t.newPassword,n=t._newPassword,a===n){e.next=4;break}return s("Two new passwords are not the same"),e.abrupt("return");case 4:r=new d.ActionProxy,r.post(h.default.USER_CHANGE_PASSWORD,t),m("Update password successfully.");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return r.a.createElement(J.a,{className:"common-child-center"},p&&r.a.createElement(_.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),a&&r.a.createElement(_.a,{closable:!0,message:"Fail",description:a,type:"error",showIcon:!0}),r.a.createElement(H.a,{className:"login-form",onFinish:e=>{b(e)}},r.a.createElement(H.a.Item,{label:"Oringinal Password",name:"password",rules:[{required:!0,message:"Please input your oringinal password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,{label:"New Password",name:"newPassword",rules:[{required:!0,message:"Please input your new password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,{label:"New Password",name:"_newPassword",rules:[{required:!0,message:"Please input your new password again!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Submit"))))};const ci=N.a.SubMenu,li={currentPage:"website-settings"},ii=r.a.createContext();function ui(){const e=Object(p.useReducerAsync)($l,li,Xl),t=Object(u.a)(e,2),a=t[0],n=t[1],s=a.currentPage;return r.a.createElement(ii.Provider,{value:{dispacher:n}},r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(N.a,{style:{width:256},defaultSelectedKeys:["website-settings"],defaultOpenKeys:["console-settings"],mode:"inline"},r.a.createElement(ci,{key:"console-settings",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,"Console Settings"))},r.a.createElement(N.a.Item,{key:"website-settings",onClick:()=>{n({type:"setState",data:{currentPage:"website-settings"}})}},"Website Settings")),r.a.createElement(ci,{key:"engine-settings",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,"Engine Settings"))},r.a.createElement(N.a.Item,{onClick:()=>{n({type:"setState",data:{currentPage:"engines"}})},key:"engines"},"Engines")))),r.a.createElement("div",{className:"app-admin-main"},"website-settings"===s&&r.a.createElement(ai,null),"engines"===s&&r.a.createElement(si,null))))}function pi(e){const t=Object(n.useState)(""),a=Object(u.a)(t,2),s=a[0],o=a[1],c=Object(n.useState)(""),l=Object(u.a)(c,2),i=l[0],p=l[1],m=Object(n.useState)(""),d=Object(u.a)(m,2),h=d[0],b=d[1],f=Object(n.useState)(!1),E=Object(u.a)(f,2),g=E[0],y=E[1],v=H.a.useForm(),w=Object(u.a)(v,1)[0],k={labelCol:{span:6},wrapperCol:{span:14}};return{ui:({formItems:t,title:a,submit:n})=>r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},k),r.a.createElement(J.a,{title:a,style:{width:(null===e||void 0===e?void 0:e.width)||"50%"}},r.a.createElement(H.a,{form:w},s&&r.a.createElement(ce,{message:r.a.createElement(V.a,{id:s})}),i&&r.a.createElement(ce,{title:r.a.createElement(V.a,{id:"congratulation"}),type:"success",message:r.a.createElement(V.a,{id:i})}),t),r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",loading:g,onClick:n},r.a.createElement(V.a,{id:"apply"}))))),form:w,setError:o,setLoading:y,getParams:()=>w.getFieldsValue(),setCurrent:b,current:h,setSuccess:p}}function mi(e){const t=pi(),a=t.ui,s=t.setError,o=t.setSuccess,c=Object(n.useState)(void 0),p=Object(u.a)(c,2),m=p[0],b=p[1],f=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=3;break}return s("set_default_backend_error"),e.abrupt("return");case 3:return t=new d.ActionProxy,e.next=6,t.post(h.default.USER_EXTRA,{backend:m});case 6:if(200!==(a=e.sent).status){e.next=11;break}return w.updateUser(a),o("done"),e.abrupt("return");case 11:s(a.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(V.a,{id:"set_default_backend"}),submit:f,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"curent_value"})},w.extraOption().backend||"Not Set Yet"),r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"choose"})},r.a.createElement(kt,{useEngine:e=>{b(e)}})))})}function di(e){const t=pi(),a=t.ui,n=t.setError,s=t.setSuccess,o=Qr({initialValue:w.extraOption().apply_timeout||10}),c=o.ui,u=o.value,p=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=3;break}return n("set_default_backend_error"),e.abrupt("return");case 3:return t=new d.ActionProxy,e.next=6,t.post(h.default.USER_EXTRA,{apply_timeout:u});case 6:if(200!==(a=e.sent).status){e.next=11;break}return w.updateUser(a),s("done"),e.abrupt("return");case 11:n(a.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(V.a,{id:"set_apply_timeout"}),submit:p,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"curent_value"})},u),r.a.createElement(H.a.Item,{label:r.a.createElement(V.a,{id:"choose"})},c()))})}function hi(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],c=new d.ActionProxy,p=ri({submit:function(){var e=Object(i.a)(l.a.mark((function e({params:t,setLoading:a}){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a(!0),g(void 0),n=0;n<t.length;n++);o(ra.getJobName()),a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{}}),m=p.ui,b=p.setData,f=p.setSchema,E=p.setEditorMode,g=p.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(h.default.TEMA_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),b(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[s]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(rs.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{E(e)}}),r.a.createElement(it.a,{type:"horizontal"}),m())}function bi(){const e=pi(),t=e.ui,a=e.setError,n=e.setSuccess,s=e.form,o=function(){var e=Object(i.a)(l.a.mark((function e(){var t,r,o,c,i,u,p,m,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.getFieldsValue(),r=t.host,o=t.port,c=t.db,i=t.user,u=t.password,(p=t.name)||(p=c),o||(o="3306"),m=new d.ActionProxy,e.next=6,m.post(h.default.DS_ADD,{host:r,port:o,db:c,user:i,password:u,name:p,format:"jdbc",jType:"mysql"});case 6:200===(b=e.sent).status?n("Create Connect Success"):a(b.content);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t({title:r.a.createElement(V.a,{id:"connect_mysql"}),submit:o,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"host",required:!0,label:r.a.createElement(V.a,{id:"host"})},r.a.createElement(K.a,{placeholder:"127.0.0.1"})),r.a.createElement(H.a.Item,{name:"port",initialValue:"3306",label:r.a.createElement(V.a,{id:"port"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"db",required:!0,label:r.a.createElement(V.a,{id:"db"})},r.a.createElement(K.a,null)),r.a.createElement(it.a,null),r.a.createElement(H.a.Item,{name:"user",required:!0,label:r.a.createElement(V.a,{id:"user"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"password",required:!0,label:r.a.createElement(V.a,{id:"password"})},r.a.createElement(K.a,null)),r.a.createElement(it.a,null),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(V.a,{id:"alias"})},r.a.createElement(K.a,null)))})}function fi(){const e=Object(n.useState)(void 0),t=Object(u.a)(e,2),a=t[0],s=t[1],o=new d.ActionProxy,c=ri({submit:function(){var e=Object(i.a)(l.a.mark((function e({params:t,setLoading:a}){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a(!0),E(void 0),n=0;n<t.length;n++);s(ra.getJobName()),a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.DS_REMOVE,{id:t.id});case 2:200===(a=e.sent).status&&(b(a.content.schema),m(a.content.data));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{}}),p=c.ui,m=c.setData,b=c.setSchema,f=c.setEditorMode,E=c.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.get(h.default.DS_LIST,{});case 2:200===(t=e.sent).status&&(b(t.content.schema),m(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[a]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(rs.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{f(e)}}),r.a.createElement(it.a,{type:"horizontal"}),p())}const Ei=Object(y.a)(Object(y.a)({},en),{},{[so.APPLY]:Vc}),gi=Object(y.a)(Object(y.a)({},tn),{},{[so.APPLY]:Bc});function yi(e,t){return gi[t.type](e,t.data)}const vi=e=>{const t=Object(n.useState)(null),a=Object(u.a)(t,2),s=a[0],o=a[1],c=Object(n.useState)(null),p=Object(u.a)(c,2),m=p[0],b=p[1];return Object(n.useEffect)(()=>{const t=setInterval(function(){var t=Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new d.ActionProxy,t.next=3,a.get(h.default.CLOUD_ENGINE_STATUS,{owner:e.name});case 3:200===(n=t.sent).status&&(r=n.content,o(r));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),3e3);return b(t),()=>{clearInterval(m)}},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(it.a,{orientation:"left"},r.a.createElement(V.a,{id:"a_4"})),r.a.createElement(ks.b,{bordered:!0,dataSource:null===s||void 0===s?void 0:s.message,renderItem:e=>r.a.createElement(ks.b.Item,null,e)}))},wi={loadingPage:!1,engineName:""},ki=r.a.createContext(null),xi=e=>{const t=Object(p.useReducerAsync)(yi,wi,Ei),a=Object(u.a)(t,2),s=a[0],o=a[1],c=s.loadingPage,m=s.engineName,b=pi({width:"70%"}),f=b.ui,E=b.setError,g=b.getParams,y=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,a=g(),e.next=4,t.post(h.default.CLOUD_CREATE_ENGINE,a);case 4:if(200===(n=e.sent).status)E(""),o({type:so.setState,data:{loadingPage:!0,engineName:a.owner}});else try{E((null===(r=JSON.parse(n.content))||void 0===r?void 0:r.message)||"Unknown Error")}catch(s){E(s.description)}case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{},[]),r.a.createElement(ki.Provider,{value:{state:s,dispacher:o}},r.a.createElement("div",null,c?r.a.createElement(vi,{name:m}):f({title:r.a.createElement(V.a,{id:"input_message"}),submit:y,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(Vn.a,{status:"warning",title:r.a.createElement(V.a,{id:"a_1"}),extra:r.a.createElement(V.a,{id:"a_2"})}),r.a.createElement(it.a,{orientation:"left"},r.a.createElement(V.a,{id:"aliyun_related"})),r.a.createElement(H.a.Item,{name:"owner",label:r.a.createElement(V.a,{id:"engine_name"}),help:"\u5fc5\u586b"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"OSSBucket",label:r.a.createElement(V.a,{id:"OSSBucket"}),help:"\u9ed8\u8ba4bucket\u540d\u79f0,\u6bd4\u5982\uff1amlsql-release-repo"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"AccessKeyID",label:r.a.createElement(V.a,{id:"access_key_id"}),help:"\u5fc5\u586b"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"AccessKeySecret",label:r.a.createElement(V.a,{id:"access_key_secret"}),help:"\u5fc5\u586b"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"OSSAccessKeyID",label:r.a.createElement(V.a,{id:"oss_access_key_id"}),help:"\u9ed8\u8ba4\u540c AccessKeySecret"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"OSSAccessKeySecret",label:r.a.createElement(V.a,{id:"oss_access_key_secret"}),help:"\u9ed8\u8ba4\u540c AccessKeySecret"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"ReginID",label:r.a.createElement(V.a,{id:"regin_id"}),initialValue:"cn-hangzhou"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{valuePropName:"checked",initialValue:!0,name:"EndpointPublicAccess",label:r.a.createElement(V.a,{id:"endpoint_public_access"})},r.a.createElement(rs.a,null)),r.a.createElement(it.a,{orientation:"left"},r.a.createElement(V.a,{id:"cluster_related"})),r.a.createElement(H.a.Item,{name:"DriverCoreNum",label:r.a.createElement(V.a,{id:"driver_core_num"}),initialValue:1},r.a.createElement(Hr.a,{min:0,max:8,marks:{1:"1c",2:"2c",4:"4c",8:"8c"}})),r.a.createElement(H.a.Item,{name:"DriverMemory",label:r.a.createElement(V.a,{id:"driver_memory"}),initialValue:2},r.a.createElement(Hr.a,{min:0,max:8,marks:{2:"2g",4:"4g",8:"8g"}})),r.a.createElement(H.a.Item,{name:"ExecutorCoreNum",label:r.a.createElement(V.a,{id:"executor_core_num"}),initialValue:1},r.a.createElement(Hr.a,{min:0,max:8,marks:{1:"1c",2:"2c",4:"4c",8:"8c"}})),r.a.createElement(H.a.Item,{name:"ExecutorMemory",label:r.a.createElement(V.a,{id:"executor_memory"}),initialValue:2},r.a.createElement(Hr.a,{min:0,max:8,marks:{2:"2g",4:"4g",8:"8g"}})),r.a.createElement(H.a.Item,{name:"ExecutorNum",label:r.a.createElement(V.a,{id:"executor_num"}),initialValue:1},r.a.createElement(Hr.a,{min:0,max:8,marks:{1:"1",4:"4",8:"8"}})),r.a.createElement(H.a.Item,{name:"EngineVersion",label:r.a.createElement(V.a,{id:"engine_version"}),initialValue:"2.1.0"},r.a.createElement(ft.a,null,r.a.createElement(ft.a.Option,{value:"2.1.0"},"2.1.0"))),r.a.createElement(H.a.Item,{name:"JarEngineVersion",label:r.a.createElement(V.a,{id:"jar_engine_version"}),initialValue:"2.1.0-SNAPSHOT"},r.a.createElement(ft.a,null,r.a.createElement(ft.a.Option,{value:"2.1.0-SNAPSHOT"},"2.1.0-SNAPSHOT"))))})))},Si=e=>{const t=Object(n.useState)(""),a=Object(u.a)(t,2),s=a[0],o=a[1],c=Object(n.useState)([]),p=Object(u.a)(c,2),m=p[0],b=p[1],f=Object(n.useState)(""),E=Object(u.a)(f,2),g=E[0],y=E[1];Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.CLOUD_ENGINE_LIST,{});case 3:200===(a=e.sent).status&&(n=a.content,b(n.data));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const v=pi(),w=v.ui,k=v.setError,x=v.setSuccess,S=(v.getParams,v.setLoading),O=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k(""),y(""),S(!0),s){e.next=6;break}return k("a_5"),e.abrupt("return");case 6:return t=new d.ActionProxy,e.next=9,t.post(h.default.CLOUD_DELETE_ENGINE,{owner:s});case 9:200===(a=e.sent).status?x("delete_success"):(k("delete_fail"),y(a.content)),S(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return w({title:r.a.createElement(V.a,{id:"delete_cloud_engine"}),submit:O,formItems:r.a.createElement(r.a.Fragment,null,g&&r.a.createElement(Vn.a,{status:"warning",extra:g}),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(V.a,{id:"a_6"})},r.a.createElement(ft.a,{onChange:j},m.map(e=>r.a.createElement(ft.a.Option,{value:e,key:e},e)))))})},Oi=e=>{const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)([]),b=Object(u.a)(m,2),f=b[0],E=b[1],g={labelCol:{span:6},wrapperCol:{span:14}};Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.CLOUD_ENGINE_LIST,{});case 3:200===(a=e.sent).status&&(n=a.content,p(n.data));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const y=function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.get(h.default.CLOUD_ENGINE_STATUS,{owner:t});case 3:200===(n=e.sent).status&&(r=n.content,E(r.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},g),r.a.createElement(J.a,{title:r.a.createElement(V.a,{id:"cloud_engine_log"}),style:{width:"70%"}},r.a.createElement(H.a,{form:a},r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(V.a,{id:"a_3"})},r.a.createElement(ft.a,{onChange:y},c.map(e=>r.a.createElement(ft.a.Option,{value:e,key:e},e)))),r.a.createElement(it.a,{orientation:"left"},r.a.createElement(V.a,{id:"a_6"})),r.a.createElement(ks.b,{bordered:!0,dataSource:f,renderItem:e=>r.a.createElement(ks.b.Item,null,e)})))))},ji=e=>{const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)(""),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)(""),b=Object(u.a)(m,2),f=b[0],E=b[1],g=Object(n.useState)(!1),y=Object(u.a)(g,2),v=y[0];y[1];Object(n.useEffect)(()=>{},[]);const w=function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(""),E(""),t=new d.ActionProxy,n=a.getFieldsValue(),e.next=6,t.post(h.default.ENGINE_REGISTER,n);case 6:200===(r=e.sent).status?E("success"):p(r.content);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},{labelCol:{span:6},wrapperCol:{span:14}}),r.a.createElement(J.a,{title:r.a.createElement(V.a,{id:"a_8"}),style:{width:"70%"}},r.a.createElement(H.a,{form:a},c&&r.a.createElement(ce,{message:r.a.createElement(V.a,{id:c})}),f&&r.a.createElement(ce,{title:r.a.createElement(V.a,{id:"congratulation"}),type:"success",message:r.a.createElement(V.a,{id:f})}),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(V.a,{id:"name"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"url",label:r.a.createElement(V.a,{id:"url"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"home",label:r.a.createElement(V.a,{id:"home"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"consoleUrl",label:r.a.createElement(V.a,{id:"consoleUrl"}),initialValue:"http://analysis.mlsql.tech"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"fileServerUrl",label:r.a.createElement(V.a,{id:"fileServerUrl"}),initialValue:"http://analysis.mlsql.tech"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"authServerUrl",label:r.a.createElement(V.a,{id:"authServerUrl"}),initialValue:"http://analysis.mlsql.tech"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{valuePropName:"checked",initialValue:!0,name:"skipAuth",label:r.a.createElement(V.a,{id:"skipAuth"})},r.a.createElement(rs.a,null)),r.a.createElement(H.a.Item,{name:"extraOpts",label:r.a.createElement(V.a,{id:"extraOpts"}),initialValue:"{}"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"accessToken",label:r.a.createElement(V.a,{id:"accessToken"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",loading:v,onClick:w},r.a.createElement(V.a,{id:"apply"})))))))},Ci=N.a.SubMenu;function Ti(){const e=Object(n.useState)("default-backend"),t=Object(u.a)(e,2),a=t[0],s=t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(N.a,{style:{width:256},defaultSelectedKeys:["default-backend"],defaultOpenKeys:["analysis-workshop"],mode:"inline"},r.a.createElement(Ci,{key:"analysis-workshop",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"analysis_workshop"})))},r.a.createElement(N.a.Item,{key:"default-backend",onClick:()=>{s("default-backend")}},r.a.createElement(V.a,{id:"set_engine"})),r.a.createElement(N.a.Item,{key:"set-timeout",onClick:()=>{s("set-timeout")}},r.a.createElement(V.a,{id:"set_timeout"}))),r.a.createElement(Ci,{key:"user",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"user_settings"})))},r.a.createElement(N.a.Item,{key:"change-admin-password",onClick:()=>{s("change-admin-password")}},r.a.createElement(V.a,{id:"change_password"}))),r.a.createElement(Ci,{key:"team",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"team"})))},r.a.createElement(N.a.Item,{key:"team_manager",onClick:()=>{s("team_manager")}},r.a.createElement(V.a,{id:"team_manager"}))),r.a.createElement(Ci,{key:"datasource",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"datasource"})))},r.a.createElement(N.a.Item,{key:"mysql",onClick:()=>{s("mysql")}},r.a.createElement(V.a,{id:"connect_mysql"})),r.a.createElement(N.a.Item,{key:"list_mysql",onClick:()=>{s("list_mysql")}},r.a.createElement(V.a,{id:"list_mysql"}))),r.a.createElement(Ci,{key:"aliyun_cloud_engine",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"aliyun_cloud_engine"})))},r.a.createElement(N.a.Item,{key:"create_cloud_engine",onClick:()=>{s("create_cloud_engine")}},r.a.createElement(V.a,{id:"create_cloud_engine"})),r.a.createElement(N.a.Item,{key:"delete_cloud_engine",onClick:()=>{s("delete_cloud_engine")}},r.a.createElement(V.a,{id:"delete_cloud_engine"})),r.a.createElement(N.a.Item,{key:"cloud_engine_log",onClick:()=>{s("cloud_engine_log")}},r.a.createElement(V.a,{id:"cloud_engine_log"}))),r.a.createElement(Ci,{key:"a_7",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"a_7"})))},r.a.createElement(N.a.Item,{key:"a_8",onClick:()=>{s("a_8")}},r.a.createElement(V.a,{id:"a_8"}))))),r.a.createElement("div",{className:"app-admin-main"},"default-backend"===a&&r.a.createElement(mi,null),"set-timeout"===a&&r.a.createElement(di,null),"change-admin-password"===a&&r.a.createElement(oi,null),"team_manager"===a&&r.a.createElement(hi,null),"mysql"===a&&r.a.createElement(bi,null),"list_mysql"===a&&r.a.createElement(fi,null),"create_cloud_engine"===a&&r.a.createElement(xi,null),"delete_cloud_engine"===a&&r.a.createElement(Si,null),"cloud_engine_log"===a&&r.a.createElement(Oi,null),"a_8"===a&&r.a.createElement(ji,null)))}const Ni=e=>r.a.createElement(r.a.Fragment,null,r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"600px"},src:"http://docs.mlsql.tech/mlsql-console/",frameBorder:"0",scrolling:"yes"})),_i=e=>{const t=Object(n.useState)(""),a=Object(u.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.extraOption().backend,a=new d.ActionProxy,e.next=4,a.get(h.default.ENGINE_LIST,{});case 4:n=e.sent,t&&(r=n.content.data,s=r.filter(e=>e.name===t)[0].url,o(s.split(":")[0]+":"+s.split(":")[1]+":4040"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),r.a.createElement(r.a.Fragment,null,s&&r.a.createElement("iframe",{sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",style:{width:"100%",height:"600px"},src:s,frameBorder:"0",scrolling:"yes"}))};var Ii=a(1137);function Pi(){const e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],s=t[1],o=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.post(h.default.INDEXER_LIST,{});case 3:200===(a=e.sent).status&&(n=a.content,s(n));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.post(h.default.INDEXER_REMOVE,{name:t});case 3:o();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{o()},[]),r.a.createElement("div",{className:"common-margin common-child-center"},r.a.createElement(fe.a,{dataSource:a},r.a.createElement(fe.a.Column,{title:"\u7d22\u5f15\u540d\u79f0",dataIndex:"name",key:"name"}),r.a.createElement(fe.a.Column,{title:"\u7d22\u5f15\u6a21\u5f0f",dataIndex:"syncInterval",key:"syncInterval",render:(e,t,a)=>-1===e?r.a.createElement(r.a.Fragment,null,"\u6d41\u5f0f"):e>0?r.a.createElement(r.a.Fragment,null,"\u6279\u5f0f"):0===e?r.a.createElement(r.a.Fragment,null,"\u4e00\u6b21\u6027"):r.a.createElement(r.a.Fragment,null)}),r.a.createElement(fe.a.Column,{title:"\u4e0a\u4e00\u6b21\u7d22\u5f15\u65f6\u95f4",dataIndex:"lastExecuteTime",key:"lastExecuteTime",render:(e,t,a)=>{let n=((new Date).getTime()-e)/1e3,s="("+n+"\u79d2)";n>60&&(s="("+Math.round(n/60)+"\u5206\u524d)"),n>3600&&(s="("+Math.round(n/3600)+"\u65f6\u524d)"),n>86400&&(s="("+Math.round(n/86400)+"\u5929\u524d)");const o=new Date(e);return r.a.createElement(r.a.Fragment,null,Je()(o).format("YYYY-MM-DD hh:mm:ss")+s)}}),r.a.createElement(fe.a.Column,{title:"\u4e0a\u4e00\u6b21\u7d22\u5f15\u72b6\u6001",dataIndex:"lastStatus",key:"lastStatus",render:(e,t,a)=>0===e?r.a.createElement(r.a.Fragment,null,"\u7d22\u5f15\u5b8c\u6210"):1===e?r.a.createElement(r.a.Fragment,null,"\u7d22\u5f15\u5931\u8d25"):r.a.createElement(r.a.Fragment,null)}),r.a.createElement(fe.a.Column,{title:"\u4e0a\u4e00\u6b21\u7d22\u5f15\u4fe1\u606f",width:"200",ellipsis:{showTitle:!0},dataIndex:"lastFailMsg",key:"lastFailMsg",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,e)}),r.a.createElement(fe.a.Column,{title:"\u64cd\u4f5c",dataIndex:"operate",key:"operate",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(Ii.a,{title:"\u786e\u8ba4\u8981\u5220\u9664\u8be5\u7d22\u5f15\u4e48\uff1f",okText:"Yes",cancelText:"No",onConfirm:()=>{c(t.name)}},r.a.createElement(Q.a,null,"\u5220\u9664")))})))}const Ai=qa.a.DirectoryTree;function Di(){const e=H.a.useForm(),t=Object(u.a)(e,1)[0],a=Object(n.useState)(""),s=Object(u.a)(a,2),o=s[0],c=s[1],p=Object(n.useState)(""),m=Object(u.a)(p,2),b=m[0],f=m[1],E=Object(n.useState)(!1),g=Object(u.a)(E,2),y=g[0],v=(g[1],Object(n.useState)(!1)),w=Object(u.a)(v,2),k=w[0],x=w[1],S=Object(n.useState)([]),O=Object(u.a)(S,2),j=O[0],C=O[1],T=Object(n.useState)(null),N=Object(u.a)(T,2),_=N[0],I=N[1],P=Object(n.useState)(null),A=Object(u.a)(P,2),D=A[0],R=A[1],L=Object(n.useState)([]),F=Object(u.a)(L,2),M=F[0],q=F[1],B=Wr(),G=B.ui,U=B.form,W=B.setOpenTable,z=B.setError,Y=B.partitionNumValue,X=Object(n.useState)(!1),$=Object(u.a)(X,2),Z=$[0],ee=$[1],te=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.DS_MYSQL_DBS,{});case 3:return a=e.sent,n=a.content.data.map(e=>(e.key=e.name,e.title=e.name,e.isLeaf=!1,e.children=e.tables.map(t=>({id:"".concat(e.name,".").concat(t.name),key:"".concat(e.name,".").concat(t.name),title:t.name,isLeaf:!0,icon:r.a.createElement(Ba.a,null)})),e)),e.next=7,t.get(h.default.ENGINE_LIST,{});case 7:200==(s=e.sent).status&&(o=s.content.data,q(o)),C(n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{te()},[]);const ae=function(){var e=Object(i.a)(l.a.mark((function e(){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(""),c(""),a=new d.ActionProxy,"mysql"!==(n=t.getFieldsValue()).syncInterval||n.idCols){e.next=7;break}return c("idCols is required"),e.abrupt("return");case 7:return r=Object.assign(n,D),e.next=10,a.post(h.default.MYSQL_INDEXER_CREATE,r);case 10:200===(s=e.sent).status?f("success"):c(s.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},{labelCol:{span:6},wrapperCol:{span:14}}),r.a.createElement(J.a,{title:r.a.createElement(V.a,{id:"create_indexer"}),style:{width:"70%"}},r.a.createElement(H.a,{form:t},r.a.createElement(Ee.a,{title:r.a.createElement(V.a,{id:"mysql_parallel"}),visible:k,onCancel:()=>{U.resetFields(),x(!1)},onOk:()=>{const e=U.getFieldsValue(),t=e.partitionColumn,a=e.lowerBound,n=e.upperBound;!t||a&&(n||!Y)?(R({partitionColumn:t,lowerBound:a,upperBound:n,partitionNumValue:Y,dbName:(null===_||void 0===_?void 0:_.dbName)||"",tableName:(null===_||void 0===_?void 0:_.tableName)||""}),U.resetFields(),x(!1)):z("lowerBound/upperBound/partitionNumValue should not be empty.")},cancelText:"Cancel",okText:"Ok"},r.a.createElement(G,null)),o&&r.a.createElement(ce,{message:r.a.createElement(V.a,{id:o})}),b&&r.a.createElement(ce,{title:r.a.createElement(V.a,{id:"congratulation"}),type:"success",message:r.a.createElement(V.a,{id:b})}),r.a.createElement(H.a.Item,{name:"_name"},r.a.createElement(Va.a,{tip:"Loading...",spinning:y},r.a.createElement(Ai,{height:700,treeData:j,expandAction:"click",onDoubleClick:(e,t)=>{if(!t.isLeaf)return;const a=t.key.split("."),n=Object(u.a)(a,2),r=n[0],s=n[1];I({dbName:r,tableName:s}),W(t.key),x(!0)},onRightClick:({event:e,node:t})=>{}}))),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(V.a,{id:"\u6570\u636e\u5e93\u8868"})},r.a.createElement("span",null,_?_.dbName+"."+_.tableName:"\u672a\u9009\u62e9")),r.a.createElement(H.a.Item,{name:"indexerType",label:r.a.createElement(V.a,{id:"\u7d22\u5f15\u7c7b\u578b"})},r.a.createElement(ft.a,{onChange:(e,t)=>{"parquet"===e&&ee(!0),"mysql"===e&&ee(!1)}},r.a.createElement(ft.a.Option,{value:"mysql"},"\u5b9e\u65f6"),r.a.createElement(ft.a.Option,{value:"parquet"},"\u5b9a\u65f6"))),Z?r.a.createElement(H.a.Item,{name:"syncInterval",label:r.a.createElement(V.a,{id:"\u540c\u6b65\u5468\u671f(d/h/m)"})},r.a.createElement(K.a,null)):r.a.createElement(r.a.Fragment,null),Z?r.a.createElement(r.a.Fragment,null):r.a.createElement(H.a.Item,{name:"idCols",label:r.a.createElement(V.a,{id:"\u6807\u8bc6\u552f\u4e00\u7ec4\u5408\u952e"})},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{name:"engineName",label:r.a.createElement(V.a,{id:"\u9009\u62e9\u6784\u5efa\u7d22\u5f15\u7684\u5f15\u64ce"})},r.a.createElement(ft.a,null,M.map(e=>r.a.createElement(ft.a.Option,{value:e.name},e.name)))),r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",loading:y,onClick:ae},r.a.createElement(V.a,{id:"apply"})))))))}const Ri=N.a.SubMenu;function Li(){const e=Object(n.useState)("indexer_list"),t=Object(u.a)(e,2),a=t[0],s=t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(N.a,{style:{width:256},defaultSelectedKeys:["indexer_list"],defaultOpenKeys:["mysql_indexer_manager"],mode:"inline"},r.a.createElement(Ri,{key:"mysql_indexer_manager",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"mysql_indexer_manager"})))},r.a.createElement(N.a.Item,{key:"indexer_list",onClick:()=>{s("indexer_list")}},r.a.createElement(V.a,{id:"indexer_list"})),r.a.createElement(N.a.Item,{key:"create_indexer",onClick:()=>{s("create_indexer")}},r.a.createElement(V.a,{id:"create_indexer"}))),r.a.createElement(Ri,{key:"other_indexer_manager",title:r.a.createElement("span",null,r.a.createElement(Zl.a,null),r.a.createElement("span",null,r.a.createElement(V.a,{id:"other_indexer_manager"})))}))),r.a.createElement("div",{className:"app-admin-main"},"indexer_list"===a&&r.a.createElement(Pi,null),"create_indexer"===a&&r.a.createElement(Di,null)))}var Fi=a(1114),Mi=a(513);class qi extends n.Component{constructor(e){super(e),this.nav=e.nav,this.state={content:""}}componentDidMount(){this.setState({content:Object.entries(this.nav.collected_params).filter(e=>e[1]).map(e=>"set ".concat(e[0],"='''").concat(e[1],"''';")).join("\n")+"\ninclude plugin.`".concat(this.nav.current_plugin_name,"`;")})}render(){return n.createElement("div",{className:"steps-content",style:{"margin-top":"30px"}},n.createElement("pre",null,this.state.content))}}const Vi=ns.a.Step,Bi={labelCol:{span:4},wrapperCol:{span:8}},Gi={labelCol:{span:4},wrapperCol:{span:8,offset:4}};class Ui extends n.Component{constructor(e){super(e),this.buildForm=e=>{if(e.hasOwnProperty("final"))return n.createElement(qi,{nav:this.nav});return e.params.map(e=>n.createElement(H.a.Item,Object.assign({},Bi,{name:e.name,label:e.name,rules:[{required:!0}]}),n.createElement(K.a,{type:"input",placeholder:e.desc})))},this.state={current:0,steps:e.steps.concat([{desc:"MLSQL Script",final:!0}])},this.nav=e.parent,this.formRef=n.createRef()}next(){this.formRef.current.validateFields().then(e=>{console.log("Received values of form: ",e);const t=this.state.current+1;this.setState({current:t}),this.nav.pushParam(e)})}prev(){const e=this.state.current-1;this.setState({current:e})}render(){const e=this.state.current;return n.createElement("div",null,n.createElement(ns.a,{current:e},this.state.steps.map(e=>n.createElement(Vi,{key:e.desc,title:e.desc}))),n.createElement("div",{className:"steps-content",style:{"margin-top":"30px"}},n.createElement(J.a,{bordered:!0},n.createElement(H.a,Object.assign({ref:this.formRef},Gi,{style:{width:"600px"}}),this.buildForm(this.state.steps[e])))),n.createElement("div",{className:"steps-action",style:{marginTop:"30px"}},e<this.state.steps.length-1&&n.createElement(Q.a,{type:"primary",onClick:()=>this.next()},"Next Step"),e===this.state.steps.length-1&&n.createElement(Q.a,{type:"primary",onClick:()=>Mi.a.success("Processing complete!")},"Done"),e>0&&n.createElement(Q.a,{style:{marginLeft:8},onClick:()=>this.prev()},"Previous Step")))}}const Ji=Ui,Hi=Fi.a.Header,Ki=Fi.a.Content,Qi=Fi.a.Footer,Wi=Fi.a.Sider;class zi extends n.Component{constructor(e){super(e),this.pushParam=e=>{Object.assign(this.collected_params,e)},this.showTut=e=>{this.current_plugin_name=e;new ht(je).newRunScript({},"!plugin script show ".concat(e,"/plugin.json;"),e=>{this.setState({data_plugin:e.map(e=>JSON.parse(e.value)[this.current_plugin_name].compositor)})},e=>{})},this.state={data_menu:[],data_plugin:[]},this.collected_params={}}componentDidMount(){new ht(je).newRunScript({},'!plugin list "script";',e=>{this.setState({data_menu:e},()=>{e.length>0&&this.showTut(e[0].pluginName)})},e=>{})}render(){return n.createElement(Fi.a,{style:{minHeight:"100vh"}},n.createElement(Wi,null,n.createElement("div",{className:"logo"}),n.createElement(N.a,{theme:"dark",defaultSelectedKeys:["0"],mode:"inline"},this.state.data_menu.map(e=>n.createElement(N.a.Item,{key:"0",onClick:()=>{this.showTut(e.pluginName)}},e.pluginName)))),n.createElement(Fi.a,null,n.createElement(Hi,{style:{background:"#fff",padding:0}}),n.createElement(Ki,{style:{margin:"0 16px"}},n.createElement("div",{style:{padding:24,background:"#fff",minHeight:360}},this.state.data_plugin.map(e=>n.createElement(Ji,{parent:this,steps:e})))),n.createElement(Qi,{style:{textAlign:"center"}})))}}class Yi extends n.Component{constructor(e){super(e)}render(){return n.createElement("div",{style:{width:"100%"}},n.createElement(zi,null))}}const Xi={currentPage:"login",logined:!1},$i=r.a.createContext();function Zi(e){const t=e.appInfo,a=Object(p.useReducerAsync)(T,Xi,C),s=Object(u.a)(a,2),o=s[0],c=s[1],l=o.currentPage,i=o.logined;return Object(n.useEffect)(()=>{c(m.a.buildEvent(j.CHECK_LOGINED,{}))},[]),r.a.createElement($i.Provider,{value:{dispacher:c}},r.a.createElement("div",{className:"app-console"},r.a.createElement("div",{className:"app-console-header"},r.a.createElement(U,{appInfo:t,userLogined:i,isUserAdmin:w.isAdmin(),currentPage:l})),r.a.createElement("div",{className:"app-console-main"},"register"===l&&r.a.createElement(ue,null),"register"!==l&&!i&&r.a.createElement(de,null),"console"===l&&i&&r.a.createElement(qn,null),"indexer_manager"===l&&i&&r.a.createElement(Li,null),"workshop"===l&&i&&r.a.createElement(Ul,null),"admin"===l&&i&&w.isAdmin()&&r.a.createElement(ui,null),"settings"===l&&i&&r.a.createElement(Ti,null),"doc"===l&&r.a.createElement(Ni,null),"engine"===l&&i&&r.a.createElement(_i,null),"scriptPlugin"===l&&i&&r.a.createElement(Yi,null)),r.a.createElement("div",{className:"app-console-footer"},r.a.createElement("div",{style:{bottom:"100px",textAlign:"center",width:"100%"}},"MLSQL Licensed under the Apache License, Version 2.0. @",r.a.createElement("a",{className:"copyright",href:"http://www.miitbeian.gov.cn/"},"\u6d59ICP\u590718052520\u53f7"),r.a.createElement("div",null,"@",r.a.createElement("a",{target:"_blank",href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802009683"},r.a.createElement("img",{src:""}),"\u6d59\u516c\u7f51\u5b89\u5907 33010802009683\u53f7"))))))}const eu=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,n=t.data,r=n.name,s=n.url,e.next=4,a.post(h.default.ENGINE_ADD,{name:r,url:s});case 4:if(200===(o=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:JSON.parse(o.content).msg}});case 7:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),tu=eu.handler,au=eu.action,nu=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ru=nu.handler,su=nu.action;class ou{}ou.registerAdmin="registerAdmin",ou.addEngine="addEngine",ou.skipAddEngine="skipAddEngine";const cu={[ou.registerAdmin]:z,[ou.addEngine]:tu,[ou.skipAddEngine]:ru};function lu(e,t){switch(t.type){case ou.registerAdmin:return Y(e,t.data);case ou.addEngine:return au(e,t.data);case ou.skipAddEngine:return su(e,t.data);default:return e}}var iu=a(1126);var uu=function(){const e=Object(n.useContext)(Au).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout;return r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:t=>{e({type:ou.registerAdmin,data:t})}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(K.a.Password,null)),r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go")))};var pu=function(){const e=Object(n.useContext)(Au).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout,o={required:!0,message:"required"};return r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:t=>{e({type:ou.addEngine,data:t})}}),r.a.createElement(H.a.Item,{label:"Engine Name",name:"name",rules:[o]},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{label:"Engine Url",name:"url",rules:[o]},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,{label:"Access Token",name:"accessToken"},r.a.createElement(K.a,null)),r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:t=>{t.preventDefault(),e({type:ou.skipAddEngine,data:{}})},htmlType:"submit"},"Skip")))};const mu=m.a.buildHandler(e=>({data:e.data})),du=mu.handler,hu=mu.action,bu=m.a.buildHandler(e=>({data:{appConfigured:!0}})),fu=bu.handler,Eu=bu.action,gu=m.a.buildHandler(e=>({data:{appConfigured:!0}})),yu=gu.handler,vu=gu.action;class wu{}wu.GO_CONSOLE="goConsole",wu.GO_ADMIN="goAdmin",wu.appConfigured="appConfigured";const ku={[wu.GO_ADMIN]:fu,[wu.GO_CONSOLE]:yu,[wu.appConfigured]:du};function xu(e,t){switch(t.type){case wu.GO_ADMIN:return Eu(e,t.data);case wu.GO_CONSOLE:return vu(e,t.data);case wu.appConfigured:return hu(e,t.data);default:return e}}var Su=function(){const e=Object(n.useContext)(Bu).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout;return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{message:"Congratuation!",description:"You have finished the setup of MLSQL Console.",type:"success"}),r.a.createElement(it.a,null),r.a.createElement(H.a,a,r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",onClick:()=>{e({type:wu.GO_ADMIN,data:{}})}},"Go to Admin Page"),r.a.createElement(it.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{e({type:wu.GO_CONSOLE,data:{}})}},"Go to Console Page"))))};function Ou(){const e=Object(ne.a)(["\n width:100%;\n display:flex;\n max-width: 800px;\n flex-direction: column;\n"]);return Ou=function(){return e},e}function ju(){const e=Object(ne.a)(["\n  width:100%;\n  margin-top:6px;\n"]);return ju=function(){return e},e}function Cu(){const e=Object(ne.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth:100%;\njustify-content:center;\n align-items:  center;\n"]);return Cu=function(){return e},e}const Tu=ns.a.Step,Nu=re.a.div(Cu()),_u=re.a.div(ju()),Iu=re.a.div(Ou()),Pu={error:void 0,current:0},Au=r.a.createContext();var Du=function(){const e=Object(p.useReducerAsync)(lu,Pu,cu),t=Object(u.a)(e,2),a=t[0],n=t[1],s=a.error,o=a.current;return r.a.createElement(Au.Provider,{value:{dispacher:n}},r.a.createElement(Nu,null,r.a.createElement(_u,null,r.a.createElement(iu.a,{title:"Setup MLSQL Console in 2 Steps"})),r.a.createElement(it.a,null),r.a.createElement(Iu,null,r.a.createElement(ns.a,{current:o},r.a.createElement(Tu,{title:"Admin User/Password",description:"Setup Admin accout"}),r.a.createElement(Tu,{title:"Add Engines",description:"Add default MLSQL Engine"}),r.a.createElement(Tu,{title:"Done",description:"Congratuation"})),r.a.createElement(it.a,null),s&&r.a.createElement(_.a,{message:"Message",description:s,type:"error",closable:!0}),0===o&&r.a.createElement(J.a,null,r.a.createElement(uu,null)),1===o&&r.a.createElement(J.a,null,r.a.createElement(pu,null)),2===o&&r.a.createElement(J.a,null,r.a.createElement(Su,null)))))},Ru=a(18),Lu=a(1123);var Fu={login:"Login",register:"Register",console:"Console",analysis_workshop:"Analysis Workshop",settings:"Settings",admin:"Admin",more:"More",apply:"Apply",set_default_backend:"Set Default Backend",set_default_backend_error:"Please select at least one engine",set_engine:"Set Engine",curent_value:"Current Value",choose:"Choose",done:"Done",congratulation:"Congratulation",set_timeout:"Set Timout",set_apply_timeout:"Set  [Apply] Timeout\uff08Unit: Second\uff09",table_workshop:"Table Workshop",delta_lake:"DeltaLake",file_system:"FileSystem",project:"Project",filter:"Filter",join:"Join",order:"Order",window:"Window",dash:"Dash",agg:"Agg",limit:"Limit",select_columns:"Select Columns",rename_columns:"Rename Columns",transform_columns:"Transform Columns",cast_columns_type:"Cast Column Type",hive:"Hive",operate_panel:"Operate Panel",data_panel:"Data Panel",user_settings:"User Settings",change_password:"Change Password",team:"Team",team_manager:"Team Control",datasource:"Data Source",analysis_range:"Select Table Range",table_start:"Select start value",table_end:"Select end value",table_random:"Select values",or:"Or",no_partition_msg:"This table have no partition message. Please click Ok.",ds_mysql:"MySQL",host:"Host",port:"Port",db:"Database Name",user:"User Name",password:"Password",alias:"Alias",connect_mysql:"Connect MySQL",list_mysql:"MySQL List",mysql:"MySQL",partitionColumn:"partitionColumn",lowerBound:"lowerBound",upperBound:"upperBound",numPartitions:"numPartitions",mysql_parallel:"MySQL Parallel",no_mysql_parallel:"No number columns in this table, Please click [Ok]",add:"\u6dfb\u52a0",as:"\u4e3a",choose_json_field:"Choose Json Field",json_fields:"Expand Json",union:"Union",aliyun_message:"Aliyun Message",submit_task_success:"\u4efb\u52a1\u63d0\u4ea4\u6210\u529f"},Mu=a(521),qu=a.n(Mu);const Vu={appConfigured:!1,loading:!0,lang:"en",enableConsole:!1},Bu=r.a.createContext();var Gu=function(){const e=Object(p.useReducerAsync)(xu,Vu,ku),t=Object(u.a)(e,2),a=t[0],s=t[1],o=a.appConfigured,c=a.loading,m=a.lang,b=a.enableConsole;function f(){return(f=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.APP_INFO,{});case 3:200===(a=e.sent).status&&s({type:wu.appConfigured,data:{appConfigured:a.content.configured,enableConsole:a.content.console||!1,loading:!1}});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(()=>{!function(){f.apply(this,arguments)}()},[]),r.a.createElement(Lu.a,{locale:m,messages:Fu},r.a.createElement(Ru.b,{locale:qu.a},r.a.createElement(Bu.Provider,{value:{dispacher:s}},c&&r.a.createElement(_n,null),!c&&!o&&r.a.createElement(Du,null),!c&&o&&r.a.createElement(Zi,{appInfo:{enableConsole:b}}))))};o.a.render(r.a.createElement(Gu,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},12:function(e,t,a){"use strict";var n=a(2),r=a.n(n),s=a(8),o=a(6);t.a=class{static buildHandler(e){return{handler:({dispatch:t,getState:a,signal:n})=>{const c=t;return function(){var t=Object(o.a)(r.a.mark((function t(n){var o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Object(s.a)(Object(s.a)({},n),{},{__state:a()}));case 2:o=t.sent,c(Object(s.a)({type:n.type},o));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},action:(e,t)=>Object(s.a)(Object(s.a)({},e),t)}}static buildEvent(e,t){return{type:e,data:t}}}},382:function(e,t,a){},450:function(e,t,a){},453:function(e,t,a){},454:function(e,t,a){},455:function(e,t,a){},456:function(e,t,a){},457:function(e,t,a){},550:function(e,t,a){e.exports=a(1106)},556:function(e,t,a){},557:function(e,t,a){},559:function(e,t,a){},560:function(e,t,a){},728:function(e,t,a){},83:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return s}));const n="";class r{}r.GET="get",r.POST="post",r.PUT="put",r.DELETE="delete";const s={name:"access-token"}}},[[550,1,2]]]);
//# sourceMappingURL=main.fa3cbce3.chunk.js.map